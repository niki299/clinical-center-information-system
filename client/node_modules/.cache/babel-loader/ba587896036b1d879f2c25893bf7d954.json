{"remainingRequest":"C:\\FAKS\\6 semestar\\VueApp\\real_vue1\\node_modules\\babel-loader\\lib\\index.js!C:\\FAKS\\6 semestar\\VueApp\\real_vue1\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\FAKS\\6 semestar\\VueApp\\real_vue1\\src\\js_util\\vue-router.js","dependencies":[{"path":"C:\\FAKS\\6 semestar\\VueApp\\real_vue1\\src\\js_util\\vue-router.js","mtime":1578600053337},{"path":"C:\\FAKS\\6 semestar\\VueApp\\real_vue1\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\FAKS\\6 semestar\\VueApp\\real_vue1\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\FAKS\\6 semestar\\VueApp\\real_vue1\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5kZXNjcmlwdGlvbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZXZlcnkiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29tZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5qc29uLnRvLXN0cmluZy10YWciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5tYXRoLnRvLXN0cmluZy10YWciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIudG8tZml4ZWQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZnJlZXplIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLm1hdGNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGVhdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiKTsKCnZhciBfdHlwZW9mID0gcmVxdWlyZSgiQzpcXEZBS1NcXDYgc2VtZXN0YXJcXFZ1ZUFwcFxccmVhbF92dWUxXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL3R5cGVvZiIpOwoKLyoqDQogICogdnVlLXJvdXRlciB2My4wLjENCiAgKiAoYykgMjAxNyBFdmFuIFlvdQ0KICAqIEBsaWNlbnNlIE1JVA0KICAqLwooZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgewogICh0eXBlb2YgZXhwb3J0cyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZXhwb3J0cykpID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpIDogdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDogZ2xvYmFsLlZ1ZVJvdXRlciA9IGZhY3RvcnkoKTsKfSkodGhpcywgZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKICAvKiAgKi8KCiAgZnVuY3Rpb24gYXNzZXJ0KGNvbmRpdGlvbiwgbWVzc2FnZSkgewogICAgaWYgKCFjb25kaXRpb24pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJbdnVlLXJvdXRlcl0gIiArIG1lc3NhZ2UpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gd2Fybihjb25kaXRpb24sIG1lc3NhZ2UpIHsKICAgIGlmICgiZGV2ZWxvcG1lbnQiICE9PSAncHJvZHVjdGlvbicgJiYgIWNvbmRpdGlvbikgewogICAgICB0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29uc29sZS53YXJuKCJbdnVlLXJvdXRlcl0gIiArIG1lc3NhZ2UpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaXNFcnJvcihlcnIpIHsKICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZXJyKS5pbmRleE9mKCdFcnJvcicpID4gLTE7CiAgfQoKICB2YXIgVmlldyA9IHsKICAgIG5hbWU6ICdyb3V0ZXItdmlldycsCiAgICBmdW5jdGlvbmFsOiB0cnVlLAogICAgcHJvcHM6IHsKICAgICAgbmFtZTogewogICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICBkZWZhdWx0OiAnZGVmYXVsdCcKICAgICAgfQogICAgfSwKICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKF8sIHJlZikgewogICAgICB2YXIgcHJvcHMgPSByZWYucHJvcHM7CiAgICAgIHZhciBjaGlsZHJlbiA9IHJlZi5jaGlsZHJlbjsKICAgICAgdmFyIHBhcmVudCA9IHJlZi5wYXJlbnQ7CiAgICAgIHZhciBkYXRhID0gcmVmLmRhdGE7CiAgICAgIGRhdGEucm91dGVyVmlldyA9IHRydWU7IC8vIGRpcmVjdGx5IHVzZSBwYXJlbnQgY29udGV4dCdzIGNyZWF0ZUVsZW1lbnQoKSBmdW5jdGlvbgogICAgICAvLyBzbyB0aGF0IGNvbXBvbmVudHMgcmVuZGVyZWQgYnkgcm91dGVyLXZpZXcgY2FuIHJlc29sdmUgbmFtZWQgc2xvdHMKCiAgICAgIHZhciBoID0gcGFyZW50LiRjcmVhdGVFbGVtZW50OwogICAgICB2YXIgbmFtZSA9IHByb3BzLm5hbWU7CiAgICAgIHZhciByb3V0ZSA9IHBhcmVudC4kcm91dGU7CiAgICAgIHZhciBjYWNoZSA9IHBhcmVudC5fcm91dGVyVmlld0NhY2hlIHx8IChwYXJlbnQuX3JvdXRlclZpZXdDYWNoZSA9IHt9KTsgLy8gZGV0ZXJtaW5lIGN1cnJlbnQgdmlldyBkZXB0aCwgYWxzbyBjaGVjayB0byBzZWUgaWYgdGhlIHRyZWUKICAgICAgLy8gaGFzIGJlZW4gdG9nZ2xlZCBpbmFjdGl2ZSBidXQga2VwdC1hbGl2ZS4KCiAgICAgIHZhciBkZXB0aCA9IDA7CiAgICAgIHZhciBpbmFjdGl2ZSA9IGZhbHNlOwoKICAgICAgd2hpbGUgKHBhcmVudCAmJiBwYXJlbnQuX3JvdXRlclJvb3QgIT09IHBhcmVudCkgewogICAgICAgIGlmIChwYXJlbnQuJHZub2RlICYmIHBhcmVudC4kdm5vZGUuZGF0YS5yb3V0ZXJWaWV3KSB7CiAgICAgICAgICBkZXB0aCsrOwogICAgICAgIH0KCiAgICAgICAgaWYgKHBhcmVudC5faW5hY3RpdmUpIHsKICAgICAgICAgIGluYWN0aXZlID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHBhcmVudCA9IHBhcmVudC4kcGFyZW50OwogICAgICB9CgogICAgICBkYXRhLnJvdXRlclZpZXdEZXB0aCA9IGRlcHRoOyAvLyByZW5kZXIgcHJldmlvdXMgdmlldyBpZiB0aGUgdHJlZSBpcyBpbmFjdGl2ZSBhbmQga2VwdC1hbGl2ZQoKICAgICAgaWYgKGluYWN0aXZlKSB7CiAgICAgICAgcmV0dXJuIGgoY2FjaGVbbmFtZV0sIGRhdGEsIGNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgdmFyIG1hdGNoZWQgPSByb3V0ZS5tYXRjaGVkW2RlcHRoXTsgLy8gcmVuZGVyIGVtcHR5IG5vZGUgaWYgbm8gbWF0Y2hlZCByb3V0ZQoKICAgICAgaWYgKCFtYXRjaGVkKSB7CiAgICAgICAgY2FjaGVbbmFtZV0gPSBudWxsOwogICAgICAgIHJldHVybiBoKCk7CiAgICAgIH0KCiAgICAgIHZhciBjb21wb25lbnQgPSBjYWNoZVtuYW1lXSA9IG1hdGNoZWQuY29tcG9uZW50c1tuYW1lXTsgLy8gYXR0YWNoIGluc3RhbmNlIHJlZ2lzdHJhdGlvbiBob29rCiAgICAgIC8vIHRoaXMgd2lsbCBiZSBjYWxsZWQgaW4gdGhlIGluc3RhbmNlJ3MgaW5qZWN0ZWQgbGlmZWN5Y2xlIGhvb2tzCgogICAgICBkYXRhLnJlZ2lzdGVyUm91dGVJbnN0YW5jZSA9IGZ1bmN0aW9uICh2bSwgdmFsKSB7CiAgICAgICAgLy8gdmFsIGNvdWxkIGJlIHVuZGVmaW5lZCBmb3IgdW5yZWdpc3RyYXRpb24KICAgICAgICB2YXIgY3VycmVudCA9IG1hdGNoZWQuaW5zdGFuY2VzW25hbWVdOwoKICAgICAgICBpZiAodmFsICYmIGN1cnJlbnQgIT09IHZtIHx8ICF2YWwgJiYgY3VycmVudCA9PT0gdm0pIHsKICAgICAgICAgIG1hdGNoZWQuaW5zdGFuY2VzW25hbWVdID0gdmFsOwogICAgICAgIH0KICAgICAgfSAvLyBhbHNvIHJlZ2lzdGVyIGluc3RhbmNlIGluIHByZXBhdGNoIGhvb2sKICAgICAgLy8gaW4gY2FzZSB0aGUgc2FtZSBjb21wb25lbnQgaW5zdGFuY2UgaXMgcmV1c2VkIGFjcm9zcyBkaWZmZXJlbnQgcm91dGVzCiAgICAgIDsKCiAgICAgIChkYXRhLmhvb2sgfHwgKGRhdGEuaG9vayA9IHt9KSkucHJlcGF0Y2ggPSBmdW5jdGlvbiAoXywgdm5vZGUpIHsKICAgICAgICBtYXRjaGVkLmluc3RhbmNlc1tuYW1lXSA9IHZub2RlLmNvbXBvbmVudEluc3RhbmNlOwogICAgICB9OyAvLyByZXNvbHZlIHByb3BzCgoKICAgICAgdmFyIHByb3BzVG9QYXNzID0gZGF0YS5wcm9wcyA9IHJlc29sdmVQcm9wcyhyb3V0ZSwgbWF0Y2hlZC5wcm9wcyAmJiBtYXRjaGVkLnByb3BzW25hbWVdKTsKCiAgICAgIGlmIChwcm9wc1RvUGFzcykgewogICAgICAgIC8vIGNsb25lIHRvIHByZXZlbnQgbXV0YXRpb24KICAgICAgICBwcm9wc1RvUGFzcyA9IGRhdGEucHJvcHMgPSBleHRlbmQoe30sIHByb3BzVG9QYXNzKTsgLy8gcGFzcyBub24tZGVjbGFyZWQgcHJvcHMgYXMgYXR0cnMKCiAgICAgICAgdmFyIGF0dHJzID0gZGF0YS5hdHRycyA9IGRhdGEuYXR0cnMgfHwge307CgogICAgICAgIGZvciAodmFyIGtleSBpbiBwcm9wc1RvUGFzcykgewogICAgICAgICAgaWYgKCFjb21wb25lbnQucHJvcHMgfHwgIShrZXkgaW4gY29tcG9uZW50LnByb3BzKSkgewogICAgICAgICAgICBhdHRyc1trZXldID0gcHJvcHNUb1Bhc3Nba2V5XTsKICAgICAgICAgICAgZGVsZXRlIHByb3BzVG9QYXNzW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaChjb21wb25lbnQsIGRhdGEsIGNoaWxkcmVuKTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiByZXNvbHZlUHJvcHMocm91dGUsIGNvbmZpZykgewogICAgc3dpdGNoIChfdHlwZW9mKGNvbmZpZykpIHsKICAgICAgY2FzZSAndW5kZWZpbmVkJzoKICAgICAgICByZXR1cm47CgogICAgICBjYXNlICdvYmplY3QnOgogICAgICAgIHJldHVybiBjb25maWc7CgogICAgICBjYXNlICdmdW5jdGlvbic6CiAgICAgICAgcmV0dXJuIGNvbmZpZyhyb3V0ZSk7CgogICAgICBjYXNlICdib29sZWFuJzoKICAgICAgICByZXR1cm4gY29uZmlnID8gcm91dGUucGFyYW1zIDogdW5kZWZpbmVkOwoKICAgICAgZGVmYXVsdDoKICAgICAgICB7CiAgICAgICAgICB3YXJuKGZhbHNlLCAicHJvcHMgaW4gXCIiICsgcm91dGUucGF0aCArICJcIiBpcyBhICIgKyBfdHlwZW9mKGNvbmZpZykgKyAiLCAiICsgImV4cGVjdGluZyBhbiBvYmplY3QsIGZ1bmN0aW9uIG9yIGJvb2xlYW4uIik7CiAgICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gZXh0ZW5kKHRvLCBmcm9tKSB7CiAgICBmb3IgKHZhciBrZXkgaW4gZnJvbSkgewogICAgICB0b1trZXldID0gZnJvbVtrZXldOwogICAgfQoKICAgIHJldHVybiB0bzsKICB9CiAgLyogICovCgoKICB2YXIgZW5jb2RlUmVzZXJ2ZVJFID0gL1shJygpKl0vZzsKCiAgdmFyIGVuY29kZVJlc2VydmVSZXBsYWNlciA9IGZ1bmN0aW9uIGVuY29kZVJlc2VydmVSZXBsYWNlcihjKSB7CiAgICByZXR1cm4gJyUnICsgYy5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KTsKICB9OwoKICB2YXIgY29tbWFSRSA9IC8lMkMvZzsgLy8gZml4ZWQgZW5jb2RlVVJJQ29tcG9uZW50IHdoaWNoIGlzIG1vcmUgY29uZm9ybWFudCB0byBSRkMzOTg2OgogIC8vIC0gZXNjYXBlcyBbIScoKSpdCiAgLy8gLSBwcmVzZXJ2ZSBjb21tYXMKCiAgdmFyIGVuY29kZSA9IGZ1bmN0aW9uIGVuY29kZShzdHIpIHsKICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQoc3RyKS5yZXBsYWNlKGVuY29kZVJlc2VydmVSRSwgZW5jb2RlUmVzZXJ2ZVJlcGxhY2VyKS5yZXBsYWNlKGNvbW1hUkUsICcsJyk7CiAgfTsKCiAgdmFyIGRlY29kZSA9IGRlY29kZVVSSUNvbXBvbmVudDsKCiAgZnVuY3Rpb24gcmVzb2x2ZVF1ZXJ5KHF1ZXJ5LCBleHRyYVF1ZXJ5LCBfcGFyc2VRdWVyeSkgewogICAgaWYgKGV4dHJhUXVlcnkgPT09IHZvaWQgMCkgZXh0cmFRdWVyeSA9IHt9OwogICAgdmFyIHBhcnNlID0gX3BhcnNlUXVlcnkgfHwgcGFyc2VRdWVyeTsKICAgIHZhciBwYXJzZWRRdWVyeTsKCiAgICB0cnkgewogICAgICBwYXJzZWRRdWVyeSA9IHBhcnNlKHF1ZXJ5IHx8ICcnKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgImRldmVsb3BtZW50IiAhPT0gJ3Byb2R1Y3Rpb24nICYmIHdhcm4oZmFsc2UsIGUubWVzc2FnZSk7CiAgICAgIHBhcnNlZFF1ZXJ5ID0ge307CiAgICB9CgogICAgZm9yICh2YXIga2V5IGluIGV4dHJhUXVlcnkpIHsKICAgICAgcGFyc2VkUXVlcnlba2V5XSA9IGV4dHJhUXVlcnlba2V5XTsKICAgIH0KCiAgICByZXR1cm4gcGFyc2VkUXVlcnk7CiAgfQoKICBmdW5jdGlvbiBwYXJzZVF1ZXJ5KHF1ZXJ5KSB7CiAgICB2YXIgcmVzID0ge307CiAgICBxdWVyeSA9IHF1ZXJ5LnRyaW0oKS5yZXBsYWNlKC9eKFw/fCN8JikvLCAnJyk7CgogICAgaWYgKCFxdWVyeSkgewogICAgICByZXR1cm4gcmVzOwogICAgfQoKICAgIHF1ZXJ5LnNwbGl0KCcmJykuZm9yRWFjaChmdW5jdGlvbiAocGFyYW0pIHsKICAgICAgdmFyIHBhcnRzID0gcGFyYW0ucmVwbGFjZSgvXCsvZywgJyAnKS5zcGxpdCgnPScpOwogICAgICB2YXIga2V5ID0gZGVjb2RlKHBhcnRzLnNoaWZ0KCkpOwogICAgICB2YXIgdmFsID0gcGFydHMubGVuZ3RoID4gMCA/IGRlY29kZShwYXJ0cy5qb2luKCc9JykpIDogbnVsbDsKCiAgICAgIGlmIChyZXNba2V5XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmVzW2tleV0gPSB2YWw7CiAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShyZXNba2V5XSkpIHsKICAgICAgICByZXNba2V5XS5wdXNoKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzW2tleV0gPSBbcmVzW2tleV0sIHZhbF07CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlczsKICB9CgogIGZ1bmN0aW9uIHN0cmluZ2lmeVF1ZXJ5KG9iaikgewogICAgdmFyIHJlcyA9IG9iaiA/IE9iamVjdC5rZXlzKG9iaikubWFwKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgdmFyIHZhbCA9IG9ialtrZXldOwoKICAgICAgaWYgKHZhbCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CgogICAgICBpZiAodmFsID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIGVuY29kZShrZXkpOwogICAgICB9CgogICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWwpKSB7CiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgIHZhbC5mb3JFYWNoKGZ1bmN0aW9uICh2YWwyKSB7CiAgICAgICAgICBpZiAodmFsMiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodmFsMiA9PT0gbnVsbCkgewogICAgICAgICAgICByZXN1bHQucHVzaChlbmNvZGUoa2V5KSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQucHVzaChlbmNvZGUoa2V5KSArICc9JyArIGVuY29kZSh2YWwyKSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKCcmJyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBlbmNvZGUoa2V5KSArICc9JyArIGVuY29kZSh2YWwpOwogICAgfSkuZmlsdGVyKGZ1bmN0aW9uICh4KSB7CiAgICAgIHJldHVybiB4Lmxlbmd0aCA+IDA7CiAgICB9KS5qb2luKCcmJykgOiBudWxsOwogICAgcmV0dXJuIHJlcyA/ICI/IiArIHJlcyA6ICcnOwogIH0KICAvKiAgKi8KCgogIHZhciB0cmFpbGluZ1NsYXNoUkUgPSAvXC8/JC87CgogIGZ1bmN0aW9uIGNyZWF0ZVJvdXRlKHJlY29yZCwgbG9jYXRpb24sIHJlZGlyZWN0ZWRGcm9tLCByb3V0ZXIpIHsKICAgIHZhciBzdHJpbmdpZnlRdWVyeSQkMSA9IHJvdXRlciAmJiByb3V0ZXIub3B0aW9ucy5zdHJpbmdpZnlRdWVyeTsKICAgIHZhciBxdWVyeSA9IGxvY2F0aW9uLnF1ZXJ5IHx8IHt9OwoKICAgIHRyeSB7CiAgICAgIHF1ZXJ5ID0gY2xvbmUocXVlcnkpOwogICAgfSBjYXRjaCAoZSkge30KCiAgICB2YXIgcm91dGUgPSB7CiAgICAgIG5hbWU6IGxvY2F0aW9uLm5hbWUgfHwgcmVjb3JkICYmIHJlY29yZC5uYW1lLAogICAgICBtZXRhOiByZWNvcmQgJiYgcmVjb3JkLm1ldGEgfHwge30sCiAgICAgIHBhdGg6IGxvY2F0aW9uLnBhdGggfHwgJy8nLAogICAgICBoYXNoOiBsb2NhdGlvbi5oYXNoIHx8ICcnLAogICAgICBxdWVyeTogcXVlcnksCiAgICAgIHBhcmFtczogbG9jYXRpb24ucGFyYW1zIHx8IHt9LAogICAgICBmdWxsUGF0aDogZ2V0RnVsbFBhdGgobG9jYXRpb24sIHN0cmluZ2lmeVF1ZXJ5JCQxKSwKICAgICAgbWF0Y2hlZDogcmVjb3JkID8gZm9ybWF0TWF0Y2gocmVjb3JkKSA6IFtdCiAgICB9OwoKICAgIGlmIChyZWRpcmVjdGVkRnJvbSkgewogICAgICByb3V0ZS5yZWRpcmVjdGVkRnJvbSA9IGdldEZ1bGxQYXRoKHJlZGlyZWN0ZWRGcm9tLCBzdHJpbmdpZnlRdWVyeSQkMSk7CiAgICB9CgogICAgcmV0dXJuIE9iamVjdC5mcmVlemUocm91dGUpOwogIH0KCiAgZnVuY3Rpb24gY2xvbmUodmFsdWUpIHsKICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICByZXR1cm4gdmFsdWUubWFwKGNsb25lKTsKICAgIH0gZWxzZSBpZiAodmFsdWUgJiYgX3R5cGVvZih2YWx1ZSkgPT09ICdvYmplY3QnKSB7CiAgICAgIHZhciByZXMgPSB7fTsKCiAgICAgIGZvciAodmFyIGtleSBpbiB2YWx1ZSkgewogICAgICAgIHJlc1trZXldID0gY2xvbmUodmFsdWVba2V5XSk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXM7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgfSAvLyB0aGUgc3RhcnRpbmcgcm91dGUgdGhhdCByZXByZXNlbnRzIHRoZSBpbml0aWFsIHN0YXRlCgoKICB2YXIgU1RBUlQgPSBjcmVhdGVSb3V0ZShudWxsLCB7CiAgICBwYXRoOiAnLycKICB9KTsKCiAgZnVuY3Rpb24gZm9ybWF0TWF0Y2gocmVjb3JkKSB7CiAgICB2YXIgcmVzID0gW107CgogICAgd2hpbGUgKHJlY29yZCkgewogICAgICByZXMudW5zaGlmdChyZWNvcmQpOwogICAgICByZWNvcmQgPSByZWNvcmQucGFyZW50OwogICAgfQoKICAgIHJldHVybiByZXM7CiAgfQoKICBmdW5jdGlvbiBnZXRGdWxsUGF0aChyZWYsIF9zdHJpbmdpZnlRdWVyeSkgewogICAgdmFyIHBhdGggPSByZWYucGF0aDsKICAgIHZhciBxdWVyeSA9IHJlZi5xdWVyeTsKICAgIGlmIChxdWVyeSA9PT0gdm9pZCAwKSBxdWVyeSA9IHt9OwogICAgdmFyIGhhc2ggPSByZWYuaGFzaDsKICAgIGlmIChoYXNoID09PSB2b2lkIDApIGhhc2ggPSAnJzsKICAgIHZhciBzdHJpbmdpZnkgPSBfc3RyaW5naWZ5UXVlcnkgfHwgc3RyaW5naWZ5UXVlcnk7CiAgICByZXR1cm4gKHBhdGggfHwgJy8nKSArIHN0cmluZ2lmeShxdWVyeSkgKyBoYXNoOwogIH0KCiAgZnVuY3Rpb24gaXNTYW1lUm91dGUoYSwgYikgewogICAgaWYgKGIgPT09IFNUQVJUKSB7CiAgICAgIHJldHVybiBhID09PSBiOwogICAgfSBlbHNlIGlmICghYikgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9IGVsc2UgaWYgKGEucGF0aCAmJiBiLnBhdGgpIHsKICAgICAgcmV0dXJuIGEucGF0aC5yZXBsYWNlKHRyYWlsaW5nU2xhc2hSRSwgJycpID09PSBiLnBhdGgucmVwbGFjZSh0cmFpbGluZ1NsYXNoUkUsICcnKSAmJiBhLmhhc2ggPT09IGIuaGFzaCAmJiBpc09iamVjdEVxdWFsKGEucXVlcnksIGIucXVlcnkpOwogICAgfSBlbHNlIGlmIChhLm5hbWUgJiYgYi5uYW1lKSB7CiAgICAgIHJldHVybiBhLm5hbWUgPT09IGIubmFtZSAmJiBhLmhhc2ggPT09IGIuaGFzaCAmJiBpc09iamVjdEVxdWFsKGEucXVlcnksIGIucXVlcnkpICYmIGlzT2JqZWN0RXF1YWwoYS5wYXJhbXMsIGIucGFyYW1zKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzT2JqZWN0RXF1YWwoYSwgYikgewogICAgaWYgKGEgPT09IHZvaWQgMCkgYSA9IHt9OwogICAgaWYgKGIgPT09IHZvaWQgMCkgYiA9IHt9OyAvLyBoYW5kbGUgbnVsbCB2YWx1ZSAjMTU2NgoKICAgIGlmICghYSB8fCAhYikgewogICAgICByZXR1cm4gYSA9PT0gYjsKICAgIH0KCiAgICB2YXIgYUtleXMgPSBPYmplY3Qua2V5cyhhKTsKICAgIHZhciBiS2V5cyA9IE9iamVjdC5rZXlzKGIpOwoKICAgIGlmIChhS2V5cy5sZW5ndGggIT09IGJLZXlzLmxlbmd0aCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIGFLZXlzLmV2ZXJ5KGZ1bmN0aW9uIChrZXkpIHsKICAgICAgdmFyIGFWYWwgPSBhW2tleV07CiAgICAgIHZhciBiVmFsID0gYltrZXldOyAvLyBjaGVjayBuZXN0ZWQgZXF1YWxpdHkKCiAgICAgIGlmIChfdHlwZW9mKGFWYWwpID09PSAnb2JqZWN0JyAmJiBfdHlwZW9mKGJWYWwpID09PSAnb2JqZWN0JykgewogICAgICAgIHJldHVybiBpc09iamVjdEVxdWFsKGFWYWwsIGJWYWwpOwogICAgICB9CgogICAgICByZXR1cm4gU3RyaW5nKGFWYWwpID09PSBTdHJpbmcoYlZhbCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGlzSW5jbHVkZWRSb3V0ZShjdXJyZW50LCB0YXJnZXQpIHsKICAgIHJldHVybiBjdXJyZW50LnBhdGgucmVwbGFjZSh0cmFpbGluZ1NsYXNoUkUsICcvJykuaW5kZXhPZih0YXJnZXQucGF0aC5yZXBsYWNlKHRyYWlsaW5nU2xhc2hSRSwgJy8nKSkgPT09IDAgJiYgKCF0YXJnZXQuaGFzaCB8fCBjdXJyZW50Lmhhc2ggPT09IHRhcmdldC5oYXNoKSAmJiBxdWVyeUluY2x1ZGVzKGN1cnJlbnQucXVlcnksIHRhcmdldC5xdWVyeSk7CiAgfQoKICBmdW5jdGlvbiBxdWVyeUluY2x1ZGVzKGN1cnJlbnQsIHRhcmdldCkgewogICAgZm9yICh2YXIga2V5IGluIHRhcmdldCkgewogICAgICBpZiAoIShrZXkgaW4gY3VycmVudCkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgLyogICovCiAgLy8gd29yayBhcm91bmQgd2VpcmQgZmxvdyBidWcKCgogIHZhciB0b1R5cGVzID0gW1N0cmluZywgT2JqZWN0XTsKICB2YXIgZXZlbnRUeXBlcyA9IFtTdHJpbmcsIEFycmF5XTsKICB2YXIgTGluayA9IHsKICAgIG5hbWU6ICdyb3V0ZXItbGluaycsCiAgICBwcm9wczogewogICAgICB0bzogewogICAgICAgIHR5cGU6IHRvVHlwZXMsCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgfSwKICAgICAgdGFnOiB7CiAgICAgICAgdHlwZTogU3RyaW5nLAogICAgICAgIGRlZmF1bHQ6ICdhJwogICAgICB9LAogICAgICBleGFjdDogQm9vbGVhbiwKICAgICAgYXBwZW5kOiBCb29sZWFuLAogICAgICByZXBsYWNlOiBCb29sZWFuLAogICAgICBhY3RpdmVDbGFzczogU3RyaW5nLAogICAgICBleGFjdEFjdGl2ZUNsYXNzOiBTdHJpbmcsCiAgICAgIGV2ZW50OiB7CiAgICAgICAgdHlwZTogZXZlbnRUeXBlcywKICAgICAgICBkZWZhdWx0OiAnY2xpY2snCiAgICAgIH0KICAgIH0sCiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihoKSB7CiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOwogICAgICB2YXIgcm91dGVyID0gdGhpcy4kcm91dGVyOwogICAgICB2YXIgY3VycmVudCA9IHRoaXMuJHJvdXRlOwogICAgICB2YXIgcmVmID0gcm91dGVyLnJlc29sdmUodGhpcy50bywgY3VycmVudCwgdGhpcy5hcHBlbmQpOwogICAgICB2YXIgbG9jYXRpb24gPSByZWYubG9jYXRpb247CiAgICAgIHZhciByb3V0ZSA9IHJlZi5yb3V0ZTsKICAgICAgdmFyIGhyZWYgPSByZWYuaHJlZjsKICAgICAgdmFyIGNsYXNzZXMgPSB7fTsKICAgICAgdmFyIGdsb2JhbEFjdGl2ZUNsYXNzID0gcm91dGVyLm9wdGlvbnMubGlua0FjdGl2ZUNsYXNzOwogICAgICB2YXIgZ2xvYmFsRXhhY3RBY3RpdmVDbGFzcyA9IHJvdXRlci5vcHRpb25zLmxpbmtFeGFjdEFjdGl2ZUNsYXNzOyAvLyBTdXBwb3J0IGdsb2JhbCBlbXB0eSBhY3RpdmUgY2xhc3MKCiAgICAgIHZhciBhY3RpdmVDbGFzc0ZhbGxiYWNrID0gZ2xvYmFsQWN0aXZlQ2xhc3MgPT0gbnVsbCA/ICdyb3V0ZXItbGluay1hY3RpdmUnIDogZ2xvYmFsQWN0aXZlQ2xhc3M7CiAgICAgIHZhciBleGFjdEFjdGl2ZUNsYXNzRmFsbGJhY2sgPSBnbG9iYWxFeGFjdEFjdGl2ZUNsYXNzID09IG51bGwgPyAncm91dGVyLWxpbmstZXhhY3QtYWN0aXZlJyA6IGdsb2JhbEV4YWN0QWN0aXZlQ2xhc3M7CiAgICAgIHZhciBhY3RpdmVDbGFzcyA9IHRoaXMuYWN0aXZlQ2xhc3MgPT0gbnVsbCA/IGFjdGl2ZUNsYXNzRmFsbGJhY2sgOiB0aGlzLmFjdGl2ZUNsYXNzOwogICAgICB2YXIgZXhhY3RBY3RpdmVDbGFzcyA9IHRoaXMuZXhhY3RBY3RpdmVDbGFzcyA9PSBudWxsID8gZXhhY3RBY3RpdmVDbGFzc0ZhbGxiYWNrIDogdGhpcy5leGFjdEFjdGl2ZUNsYXNzOwogICAgICB2YXIgY29tcGFyZVRhcmdldCA9IGxvY2F0aW9uLnBhdGggPyBjcmVhdGVSb3V0ZShudWxsLCBsb2NhdGlvbiwgbnVsbCwgcm91dGVyKSA6IHJvdXRlOwogICAgICBjbGFzc2VzW2V4YWN0QWN0aXZlQ2xhc3NdID0gaXNTYW1lUm91dGUoY3VycmVudCwgY29tcGFyZVRhcmdldCk7CiAgICAgIGNsYXNzZXNbYWN0aXZlQ2xhc3NdID0gdGhpcy5leGFjdCA/IGNsYXNzZXNbZXhhY3RBY3RpdmVDbGFzc10gOiBpc0luY2x1ZGVkUm91dGUoY3VycmVudCwgY29tcGFyZVRhcmdldCk7CgogICAgICB2YXIgaGFuZGxlciA9IGZ1bmN0aW9uIGhhbmRsZXIoZSkgewogICAgICAgIGlmIChndWFyZEV2ZW50KGUpKSB7CiAgICAgICAgICBpZiAodGhpcyQxLnJlcGxhY2UpIHsKICAgICAgICAgICAgcm91dGVyLnJlcGxhY2UobG9jYXRpb24pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcm91dGVyLnB1c2gobG9jYXRpb24pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHZhciBvbiA9IHsKICAgICAgICBjbGljazogZ3VhcmRFdmVudAogICAgICB9OwoKICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5ldmVudCkpIHsKICAgICAgICB0aGlzLmV2ZW50LmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIG9uW2VdID0gaGFuZGxlcjsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvblt0aGlzLmV2ZW50XSA9IGhhbmRsZXI7CiAgICAgIH0KCiAgICAgIHZhciBkYXRhID0gewogICAgICAgIGNsYXNzOiBjbGFzc2VzCiAgICAgIH07CgogICAgICBpZiAodGhpcy50YWcgPT09ICdhJykgewogICAgICAgIGRhdGEub24gPSBvbjsKICAgICAgICBkYXRhLmF0dHJzID0gewogICAgICAgICAgaHJlZjogaHJlZgogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gZmluZCB0aGUgZmlyc3QgPGE+IGNoaWxkIGFuZCBhcHBseSBsaXN0ZW5lciBhbmQgaHJlZgogICAgICAgIHZhciBhID0gZmluZEFuY2hvcih0aGlzLiRzbG90cy5kZWZhdWx0KTsKCiAgICAgICAgaWYgKGEpIHsKICAgICAgICAgIC8vIGluIGNhc2UgdGhlIDxhPiBpcyBhIHN0YXRpYyBub2RlCiAgICAgICAgICBhLmlzU3RhdGljID0gZmFsc2U7CiAgICAgICAgICB2YXIgZXh0ZW5kID0gX1Z1ZS51dGlsLmV4dGVuZDsKICAgICAgICAgIHZhciBhRGF0YSA9IGEuZGF0YSA9IGV4dGVuZCh7fSwgYS5kYXRhKTsKICAgICAgICAgIGFEYXRhLm9uID0gb247CiAgICAgICAgICB2YXIgYUF0dHJzID0gYS5kYXRhLmF0dHJzID0gZXh0ZW5kKHt9LCBhLmRhdGEuYXR0cnMpOwogICAgICAgICAgYUF0dHJzLmhyZWYgPSBocmVmOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBkb2Vzbid0IGhhdmUgPGE+IGNoaWxkLCBhcHBseSBsaXN0ZW5lciB0byBzZWxmCiAgICAgICAgICBkYXRhLm9uID0gb247CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaCh0aGlzLnRhZywgZGF0YSwgdGhpcy4kc2xvdHMuZGVmYXVsdCk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gZ3VhcmRFdmVudChlKSB7CiAgICAvLyBkb24ndCByZWRpcmVjdCB3aXRoIGNvbnRyb2wga2V5cwogICAgaWYgKGUubWV0YUtleSB8fCBlLmFsdEtleSB8fCBlLmN0cmxLZXkgfHwgZS5zaGlmdEtleSkgewogICAgICByZXR1cm47CiAgICB9IC8vIGRvbid0IHJlZGlyZWN0IHdoZW4gcHJldmVudERlZmF1bHQgY2FsbGVkCgoKICAgIGlmIChlLmRlZmF1bHRQcmV2ZW50ZWQpIHsKICAgICAgcmV0dXJuOwogICAgfSAvLyBkb24ndCByZWRpcmVjdCBvbiByaWdodCBjbGljawoKCiAgICBpZiAoZS5idXR0b24gIT09IHVuZGVmaW5lZCAmJiBlLmJ1dHRvbiAhPT0gMCkgewogICAgICByZXR1cm47CiAgICB9IC8vIGRvbid0IHJlZGlyZWN0IGlmIGB0YXJnZXQ9Il9ibGFuayJgCgoKICAgIGlmIChlLmN1cnJlbnRUYXJnZXQgJiYgZS5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSkgewogICAgICB2YXIgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgndGFyZ2V0Jyk7CgogICAgICBpZiAoL1xiX2JsYW5rXGIvaS50ZXN0KHRhcmdldCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0gLy8gdGhpcyBtYXkgYmUgYSBXZWV4IGV2ZW50IHdoaWNoIGRvZXNuJ3QgaGF2ZSB0aGlzIG1ldGhvZAoKCiAgICBpZiAoZS5wcmV2ZW50RGVmYXVsdCkgewogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBmaW5kQW5jaG9yKGNoaWxkcmVuKSB7CiAgICBpZiAoY2hpbGRyZW4pIHsKICAgICAgdmFyIGNoaWxkOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgIGNoaWxkID0gY2hpbGRyZW5baV07CgogICAgICAgIGlmIChjaGlsZC50YWcgPT09ICdhJykgewogICAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNoaWxkLmNoaWxkcmVuICYmIChjaGlsZCA9IGZpbmRBbmNob3IoY2hpbGQuY2hpbGRyZW4pKSkgewogICAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgdmFyIF9WdWU7CgogIGZ1bmN0aW9uIGluc3RhbGwoVnVlKSB7CiAgICBpZiAoaW5zdGFsbC5pbnN0YWxsZWQgJiYgX1Z1ZSA9PT0gVnVlKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpbnN0YWxsLmluc3RhbGxlZCA9IHRydWU7CiAgICBfVnVlID0gVnVlOwoKICAgIHZhciBpc0RlZiA9IGZ1bmN0aW9uIGlzRGVmKHYpIHsKICAgICAgcmV0dXJuIHYgIT09IHVuZGVmaW5lZDsKICAgIH07CgogICAgdmFyIHJlZ2lzdGVySW5zdGFuY2UgPSBmdW5jdGlvbiByZWdpc3Rlckluc3RhbmNlKHZtLCBjYWxsVmFsKSB7CiAgICAgIHZhciBpID0gdm0uJG9wdGlvbnMuX3BhcmVudFZub2RlOwoKICAgICAgaWYgKGlzRGVmKGkpICYmIGlzRGVmKGkgPSBpLmRhdGEpICYmIGlzRGVmKGkgPSBpLnJlZ2lzdGVyUm91dGVJbnN0YW5jZSkpIHsKICAgICAgICBpKHZtLCBjYWxsVmFsKTsKICAgICAgfQogICAgfTsKCiAgICBWdWUubWl4aW4oewogICAgICBiZWZvcmVDcmVhdGU6IGZ1bmN0aW9uIGJlZm9yZUNyZWF0ZSgpIHsKICAgICAgICBpZiAoaXNEZWYodGhpcy4kb3B0aW9ucy5yb3V0ZXIpKSB7CiAgICAgICAgICB0aGlzLl9yb3V0ZXJSb290ID0gdGhpczsKICAgICAgICAgIHRoaXMuX3JvdXRlciA9IHRoaXMuJG9wdGlvbnMucm91dGVyOwoKICAgICAgICAgIHRoaXMuX3JvdXRlci5pbml0KHRoaXMpOwoKICAgICAgICAgIFZ1ZS51dGlsLmRlZmluZVJlYWN0aXZlKHRoaXMsICdfcm91dGUnLCB0aGlzLl9yb3V0ZXIuaGlzdG9yeS5jdXJyZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5fcm91dGVyUm9vdCA9IHRoaXMuJHBhcmVudCAmJiB0aGlzLiRwYXJlbnQuX3JvdXRlclJvb3QgfHwgdGhpczsKICAgICAgICB9CgogICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgdGhpcyk7CiAgICAgIH0sCiAgICAgIGRlc3Ryb3llZDogZnVuY3Rpb24gZGVzdHJveWVkKCkgewogICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcyk7CiAgICAgIH0KICAgIH0pOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZS5wcm90b3R5cGUsICckcm91dGVyJywgewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcm91dGVyUm9vdC5fcm91dGVyOwogICAgICB9CiAgICB9KTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShWdWUucHJvdG90eXBlLCAnJHJvdXRlJywgewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcm91dGVyUm9vdC5fcm91dGU7CiAgICAgIH0KICAgIH0pOwogICAgVnVlLmNvbXBvbmVudCgncm91dGVyLXZpZXcnLCBWaWV3KTsKICAgIFZ1ZS5jb21wb25lbnQoJ3JvdXRlci1saW5rJywgTGluayk7CiAgICB2YXIgc3RyYXRzID0gVnVlLmNvbmZpZy5vcHRpb25NZXJnZVN0cmF0ZWdpZXM7IC8vIHVzZSB0aGUgc2FtZSBob29rIG1lcmdpbmcgc3RyYXRlZ3kgZm9yIHJvdXRlIGhvb2tzCgogICAgc3RyYXRzLmJlZm9yZVJvdXRlRW50ZXIgPSBzdHJhdHMuYmVmb3JlUm91dGVMZWF2ZSA9IHN0cmF0cy5iZWZvcmVSb3V0ZVVwZGF0ZSA9IHN0cmF0cy5jcmVhdGVkOwogIH0KICAvKiAgKi8KCgogIHZhciBpbkJyb3dzZXIgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJzsKICAvKiAgKi8KCiAgZnVuY3Rpb24gcmVzb2x2ZVBhdGgocmVsYXRpdmUsIGJhc2UsIGFwcGVuZCkgewogICAgdmFyIGZpcnN0Q2hhciA9IHJlbGF0aXZlLmNoYXJBdCgwKTsKCiAgICBpZiAoZmlyc3RDaGFyID09PSAnLycpIHsKICAgICAgcmV0dXJuIHJlbGF0aXZlOwogICAgfQoKICAgIGlmIChmaXJzdENoYXIgPT09ICc/JyB8fCBmaXJzdENoYXIgPT09ICcjJykgewogICAgICByZXR1cm4gYmFzZSArIHJlbGF0aXZlOwogICAgfQoKICAgIHZhciBzdGFjayA9IGJhc2Uuc3BsaXQoJy8nKTsgLy8gcmVtb3ZlIHRyYWlsaW5nIHNlZ21lbnQgaWY6CiAgICAvLyAtIG5vdCBhcHBlbmRpbmcKICAgIC8vIC0gYXBwZW5kaW5nIHRvIHRyYWlsaW5nIHNsYXNoIChsYXN0IHNlZ21lbnQgaXMgZW1wdHkpCgogICAgaWYgKCFhcHBlbmQgfHwgIXN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdKSB7CiAgICAgIHN0YWNrLnBvcCgpOwogICAgfSAvLyByZXNvbHZlIHJlbGF0aXZlIHBhdGgKCgogICAgdmFyIHNlZ21lbnRzID0gcmVsYXRpdmUucmVwbGFjZSgvXlwvLywgJycpLnNwbGl0KCcvJyk7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWdtZW50cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgc2VnbWVudCA9IHNlZ21lbnRzW2ldOwoKICAgICAgaWYgKHNlZ21lbnQgPT09ICcuLicpIHsKICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgfSBlbHNlIGlmIChzZWdtZW50ICE9PSAnLicpIHsKICAgICAgICBzdGFjay5wdXNoKHNlZ21lbnQpOwogICAgICB9CiAgICB9IC8vIGVuc3VyZSBsZWFkaW5nIHNsYXNoCgoKICAgIGlmIChzdGFja1swXSAhPT0gJycpIHsKICAgICAgc3RhY2sudW5zaGlmdCgnJyk7CiAgICB9CgogICAgcmV0dXJuIHN0YWNrLmpvaW4oJy8nKTsKICB9CgogIGZ1bmN0aW9uIHBhcnNlUGF0aChwYXRoKSB7CiAgICB2YXIgaGFzaCA9ICcnOwogICAgdmFyIHF1ZXJ5ID0gJyc7CiAgICB2YXIgaGFzaEluZGV4ID0gcGF0aC5pbmRleE9mKCcjJyk7CgogICAgaWYgKGhhc2hJbmRleCA+PSAwKSB7CiAgICAgIGhhc2ggPSBwYXRoLnNsaWNlKGhhc2hJbmRleCk7CiAgICAgIHBhdGggPSBwYXRoLnNsaWNlKDAsIGhhc2hJbmRleCk7CiAgICB9CgogICAgdmFyIHF1ZXJ5SW5kZXggPSBwYXRoLmluZGV4T2YoJz8nKTsKCiAgICBpZiAocXVlcnlJbmRleCA+PSAwKSB7CiAgICAgIHF1ZXJ5ID0gcGF0aC5zbGljZShxdWVyeUluZGV4ICsgMSk7CiAgICAgIHBhdGggPSBwYXRoLnNsaWNlKDAsIHF1ZXJ5SW5kZXgpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIHBhdGg6IHBhdGgsCiAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgaGFzaDogaGFzaAogICAgfTsKICB9CgogIGZ1bmN0aW9uIGNsZWFuUGF0aChwYXRoKSB7CiAgICByZXR1cm4gcGF0aC5yZXBsYWNlKC9cL1wvL2csICcvJyk7CiAgfQoKICB2YXIgaXNhcnJheSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKGFycikgewogICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhcnIpID09ICdbb2JqZWN0IEFycmF5XSc7CiAgfTsKICAvKioNCiAgICogRXhwb3NlIGBwYXRoVG9SZWdleHBgLg0KICAgKi8KCgogIHZhciBwYXRoVG9SZWdleHBfMSA9IHBhdGhUb1JlZ2V4cDsKICB2YXIgcGFyc2VfMSA9IHBhcnNlOwogIHZhciBjb21waWxlXzEgPSBjb21waWxlOwogIHZhciB0b2tlbnNUb0Z1bmN0aW9uXzEgPSB0b2tlbnNUb0Z1bmN0aW9uOwogIHZhciB0b2tlbnNUb1JlZ0V4cF8xID0gdG9rZW5zVG9SZWdFeHA7CiAgLyoqDQogICAqIFRoZSBtYWluIHBhdGggbWF0Y2hpbmcgcmVnZXhwIHV0aWxpdHkuDQogICAqDQogICAqIEB0eXBlIHtSZWdFeHB9DQogICAqLwoKICB2YXIgUEFUSF9SRUdFWFAgPSBuZXcgUmVnRXhwKFsvLyBNYXRjaCBlc2NhcGVkIGNoYXJhY3RlcnMgdGhhdCB3b3VsZCBvdGhlcndpc2UgYXBwZWFyIGluIGZ1dHVyZSBtYXRjaGVzLgogIC8vIFRoaXMgYWxsb3dzIHRoZSB1c2VyIHRvIGVzY2FwZSBzcGVjaWFsIGNoYXJhY3RlcnMgdGhhdCB3b24ndCB0cmFuc2Zvcm0uCiAgJyhcXFxcLiknLCAvLyBNYXRjaCBFeHByZXNzLXN0eWxlIHBhcmFtZXRlcnMgYW5kIHVuLW5hbWVkIHBhcmFtZXRlcnMgd2l0aCBhIHByZWZpeAogIC8vIGFuZCBvcHRpb25hbCBzdWZmaXhlcy4gTWF0Y2hlcyBhcHBlYXIgYXM6CiAgLy8KICAvLyAiLzp0ZXN0KFxcZCspPyIgPT4gWyIvIiwgInRlc3QiLCAiXGQrIiwgdW5kZWZpbmVkLCAiPyIsIHVuZGVmaW5lZF0KICAvLyAiL3JvdXRlKFxcZCspIiAgPT4gW3VuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsICJcZCsiLCB1bmRlZmluZWQsIHVuZGVmaW5lZF0KICAvLyAiLyoiICAgICAgICAgICAgPT4gWyIvIiwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCAiKiJdCiAgJyhbXFwvLl0pPyg/Oig/OlxcOihcXHcrKSg/OlxcKCgoPzpcXFxcLnxbXlxcXFwoKV0pKylcXCkpP3xcXCgoKD86XFxcXC58W15cXFxcKCldKSspXFwpKShbKyo/XSk/fChcXCopKSddLmpvaW4oJ3wnKSwgJ2cnKTsKICAvKioNCiAgICogUGFyc2UgYSBzdHJpbmcgZm9yIHRoZSByYXcgdG9rZW5zLg0KICAgKg0KICAgKiBAcGFyYW0gIHtzdHJpbmd9ICBzdHINCiAgICogQHBhcmFtICB7T2JqZWN0PX0gb3B0aW9ucw0KICAgKiBAcmV0dXJuIHshQXJyYXl9DQogICAqLwoKICBmdW5jdGlvbiBwYXJzZShzdHIsIG9wdGlvbnMpIHsKICAgIHZhciB0b2tlbnMgPSBbXTsKICAgIHZhciBrZXkgPSAwOwogICAgdmFyIGluZGV4ID0gMDsKICAgIHZhciBwYXRoID0gJyc7CiAgICB2YXIgZGVmYXVsdERlbGltaXRlciA9IG9wdGlvbnMgJiYgb3B0aW9ucy5kZWxpbWl0ZXIgfHwgJy8nOwogICAgdmFyIHJlczsKCiAgICB3aGlsZSAoKHJlcyA9IFBBVEhfUkVHRVhQLmV4ZWMoc3RyKSkgIT0gbnVsbCkgewogICAgICB2YXIgbSA9IHJlc1swXTsKICAgICAgdmFyIGVzY2FwZWQgPSByZXNbMV07CiAgICAgIHZhciBvZmZzZXQgPSByZXMuaW5kZXg7CiAgICAgIHBhdGggKz0gc3RyLnNsaWNlKGluZGV4LCBvZmZzZXQpOwogICAgICBpbmRleCA9IG9mZnNldCArIG0ubGVuZ3RoOyAvLyBJZ25vcmUgYWxyZWFkeSBlc2NhcGVkIHNlcXVlbmNlcy4KCiAgICAgIGlmIChlc2NhcGVkKSB7CiAgICAgICAgcGF0aCArPSBlc2NhcGVkWzFdOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICB2YXIgbmV4dCA9IHN0cltpbmRleF07CiAgICAgIHZhciBwcmVmaXggPSByZXNbMl07CiAgICAgIHZhciBuYW1lID0gcmVzWzNdOwogICAgICB2YXIgY2FwdHVyZSA9IHJlc1s0XTsKICAgICAgdmFyIGdyb3VwID0gcmVzWzVdOwogICAgICB2YXIgbW9kaWZpZXIgPSByZXNbNl07CiAgICAgIHZhciBhc3RlcmlzayA9IHJlc1s3XTsgLy8gUHVzaCB0aGUgY3VycmVudCBwYXRoIG9udG8gdGhlIHRva2Vucy4KCiAgICAgIGlmIChwYXRoKSB7CiAgICAgICAgdG9rZW5zLnB1c2gocGF0aCk7CiAgICAgICAgcGF0aCA9ICcnOwogICAgICB9CgogICAgICB2YXIgcGFydGlhbCA9IHByZWZpeCAhPSBudWxsICYmIG5leHQgIT0gbnVsbCAmJiBuZXh0ICE9PSBwcmVmaXg7CiAgICAgIHZhciByZXBlYXQgPSBtb2RpZmllciA9PT0gJysnIHx8IG1vZGlmaWVyID09PSAnKic7CiAgICAgIHZhciBvcHRpb25hbCA9IG1vZGlmaWVyID09PSAnPycgfHwgbW9kaWZpZXIgPT09ICcqJzsKICAgICAgdmFyIGRlbGltaXRlciA9IHJlc1syXSB8fCBkZWZhdWx0RGVsaW1pdGVyOwogICAgICB2YXIgcGF0dGVybiA9IGNhcHR1cmUgfHwgZ3JvdXA7CiAgICAgIHRva2Vucy5wdXNoKHsKICAgICAgICBuYW1lOiBuYW1lIHx8IGtleSsrLAogICAgICAgIHByZWZpeDogcHJlZml4IHx8ICcnLAogICAgICAgIGRlbGltaXRlcjogZGVsaW1pdGVyLAogICAgICAgIG9wdGlvbmFsOiBvcHRpb25hbCwKICAgICAgICByZXBlYXQ6IHJlcGVhdCwKICAgICAgICBwYXJ0aWFsOiBwYXJ0aWFsLAogICAgICAgIGFzdGVyaXNrOiAhIWFzdGVyaXNrLAogICAgICAgIHBhdHRlcm46IHBhdHRlcm4gPyBlc2NhcGVHcm91cChwYXR0ZXJuKSA6IGFzdGVyaXNrID8gJy4qJyA6ICdbXicgKyBlc2NhcGVTdHJpbmcoZGVsaW1pdGVyKSArICddKz8nCiAgICAgIH0pOwogICAgfSAvLyBNYXRjaCBhbnkgY2hhcmFjdGVycyBzdGlsbCByZW1haW5pbmcuCgoKICAgIGlmIChpbmRleCA8IHN0ci5sZW5ndGgpIHsKICAgICAgcGF0aCArPSBzdHIuc3Vic3RyKGluZGV4KTsKICAgIH0gLy8gSWYgdGhlIHBhdGggZXhpc3RzLCBwdXNoIGl0IG9udG8gdGhlIGVuZC4KCgogICAgaWYgKHBhdGgpIHsKICAgICAgdG9rZW5zLnB1c2gocGF0aCk7CiAgICB9CgogICAgcmV0dXJuIHRva2VuczsKICB9CiAgLyoqDQogICAqIENvbXBpbGUgYSBzdHJpbmcgdG8gYSB0ZW1wbGF0ZSBmdW5jdGlvbiBmb3IgdGhlIHBhdGguDQogICAqDQogICAqIEBwYXJhbSAge3N0cmluZ30gICAgICAgICAgICAgc3RyDQogICAqIEBwYXJhbSAge09iamVjdD19ICAgICAgICAgICAgb3B0aW9ucw0KICAgKiBAcmV0dXJuIHshZnVuY3Rpb24oT2JqZWN0PSwgT2JqZWN0PSl9DQogICAqLwoKCiAgZnVuY3Rpb24gY29tcGlsZShzdHIsIG9wdGlvbnMpIHsKICAgIHJldHVybiB0b2tlbnNUb0Z1bmN0aW9uKHBhcnNlKHN0ciwgb3B0aW9ucykpOwogIH0KICAvKioNCiAgICogUHJldHRpZXIgZW5jb2Rpbmcgb2YgVVJJIHBhdGggc2VnbWVudHMuDQogICAqDQogICAqIEBwYXJhbSAge3N0cmluZ30NCiAgICogQHJldHVybiB7c3RyaW5nfQ0KICAgKi8KCgogIGZ1bmN0aW9uIGVuY29kZVVSSUNvbXBvbmVudFByZXR0eShzdHIpIHsKICAgIHJldHVybiBlbmNvZGVVUkkoc3RyKS5yZXBsYWNlKC9bXC8/I10vZywgZnVuY3Rpb24gKGMpIHsKICAgICAgcmV0dXJuICclJyArIGMuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKTsKICAgIH0pOwogIH0KICAvKioNCiAgICogRW5jb2RlIHRoZSBhc3RlcmlzayBwYXJhbWV0ZXIuIFNpbWlsYXIgdG8gYHByZXR0eWAsIGJ1dCBhbGxvd3Mgc2xhc2hlcy4NCiAgICoNCiAgICogQHBhcmFtICB7c3RyaW5nfQ0KICAgKiBAcmV0dXJuIHtzdHJpbmd9DQogICAqLwoKCiAgZnVuY3Rpb24gZW5jb2RlQXN0ZXJpc2soc3RyKSB7CiAgICByZXR1cm4gZW5jb2RlVVJJKHN0cikucmVwbGFjZSgvWz8jXS9nLCBmdW5jdGlvbiAoYykgewogICAgICByZXR1cm4gJyUnICsgYy5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpOwogICAgfSk7CiAgfQogIC8qKg0KICAgKiBFeHBvc2UgYSBtZXRob2QgZm9yIHRyYW5zZm9ybWluZyB0b2tlbnMgaW50byB0aGUgcGF0aCBmdW5jdGlvbi4NCiAgICovCgoKICBmdW5jdGlvbiB0b2tlbnNUb0Z1bmN0aW9uKHRva2VucykgewogICAgLy8gQ29tcGlsZSBhbGwgdGhlIHRva2VucyBpbnRvIHJlZ2V4cHMuCiAgICB2YXIgbWF0Y2hlcyA9IG5ldyBBcnJheSh0b2tlbnMubGVuZ3RoKTsgLy8gQ29tcGlsZSBhbGwgdGhlIHBhdHRlcm5zIGJlZm9yZSBjb21waWxhdGlvbi4KCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoX3R5cGVvZih0b2tlbnNbaV0pID09PSAnb2JqZWN0JykgewogICAgICAgIG1hdGNoZXNbaV0gPSBuZXcgUmVnRXhwKCdeKD86JyArIHRva2Vuc1tpXS5wYXR0ZXJuICsgJykkJyk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZnVuY3Rpb24gKG9iaiwgb3B0cykgewogICAgICB2YXIgcGF0aCA9ICcnOwogICAgICB2YXIgZGF0YSA9IG9iaiB8fCB7fTsKICAgICAgdmFyIG9wdGlvbnMgPSBvcHRzIHx8IHt9OwogICAgICB2YXIgZW5jb2RlID0gb3B0aW9ucy5wcmV0dHkgPyBlbmNvZGVVUklDb21wb25lbnRQcmV0dHkgOiBlbmNvZGVVUklDb21wb25lbnQ7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpXTsKCiAgICAgICAgaWYgKHR5cGVvZiB0b2tlbiA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIHBhdGggKz0gdG9rZW47CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIHZhciB2YWx1ZSA9IGRhdGFbdG9rZW4ubmFtZV07CiAgICAgICAgdmFyIHNlZ21lbnQ7CgogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICBpZiAodG9rZW4ub3B0aW9uYWwpIHsKICAgICAgICAgICAgLy8gUHJlcGVuZCBwYXJ0aWFsIHNlZ21lbnQgcHJlZml4ZXMuCiAgICAgICAgICAgIGlmICh0b2tlbi5wYXJ0aWFsKSB7CiAgICAgICAgICAgICAgcGF0aCArPSB0b2tlbi5wcmVmaXg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRXhwZWN0ZWQgIicgKyB0b2tlbi5uYW1lICsgJyIgdG8gYmUgZGVmaW5lZCcpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGlzYXJyYXkodmFsdWUpKSB7CiAgICAgICAgICBpZiAoIXRva2VuLnJlcGVhdCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCAiJyArIHRva2VuLm5hbWUgKyAnIiB0byBub3QgcmVwZWF0LCBidXQgcmVjZWl2ZWQgYCcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZSkgKyAnYCcpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgaWYgKHRva2VuLm9wdGlvbmFsKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRXhwZWN0ZWQgIicgKyB0b2tlbi5uYW1lICsgJyIgdG8gbm90IGJlIGVtcHR5Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHZhbHVlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIHNlZ21lbnQgPSBlbmNvZGUodmFsdWVbal0pOwoKICAgICAgICAgICAgaWYgKCFtYXRjaGVzW2ldLnRlc3Qoc2VnbWVudCkpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCBhbGwgIicgKyB0b2tlbi5uYW1lICsgJyIgdG8gbWF0Y2ggIicgKyB0b2tlbi5wYXR0ZXJuICsgJyIsIGJ1dCByZWNlaXZlZCBgJyArIEpTT04uc3RyaW5naWZ5KHNlZ21lbnQpICsgJ2AnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcGF0aCArPSAoaiA9PT0gMCA/IHRva2VuLnByZWZpeCA6IHRva2VuLmRlbGltaXRlcikgKyBzZWdtZW50OwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgc2VnbWVudCA9IHRva2VuLmFzdGVyaXNrID8gZW5jb2RlQXN0ZXJpc2sodmFsdWUpIDogZW5jb2RlKHZhbHVlKTsKCiAgICAgICAgaWYgKCFtYXRjaGVzW2ldLnRlc3Qoc2VnbWVudCkpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkICInICsgdG9rZW4ubmFtZSArICciIHRvIG1hdGNoICInICsgdG9rZW4ucGF0dGVybiArICciLCBidXQgcmVjZWl2ZWQgIicgKyBzZWdtZW50ICsgJyInKTsKICAgICAgICB9CgogICAgICAgIHBhdGggKz0gdG9rZW4ucHJlZml4ICsgc2VnbWVudDsKICAgICAgfQoKICAgICAgcmV0dXJuIHBhdGg7CiAgICB9OwogIH0KICAvKioNCiAgICogRXNjYXBlIGEgcmVndWxhciBleHByZXNzaW9uIHN0cmluZy4NCiAgICoNCiAgICogQHBhcmFtICB7c3RyaW5nfSBzdHINCiAgICogQHJldHVybiB7c3RyaW5nfQ0KICAgKi8KCgogIGZ1bmN0aW9uIGVzY2FwZVN0cmluZyhzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvKFsuKyo/PV4hOiR7fSgpW1xdfFwvXFxdKS9nLCAnXFwkMScpOwogIH0KICAvKioNCiAgICogRXNjYXBlIHRoZSBjYXB0dXJpbmcgZ3JvdXAgYnkgZXNjYXBpbmcgc3BlY2lhbCBjaGFyYWN0ZXJzIGFuZCBtZWFuaW5nLg0KICAgKg0KICAgKiBAcGFyYW0gIHtzdHJpbmd9IGdyb3VwDQogICAqIEByZXR1cm4ge3N0cmluZ30NCiAgICovCgoKICBmdW5jdGlvbiBlc2NhcGVHcm91cChncm91cCkgewogICAgcmV0dXJuIGdyb3VwLnJlcGxhY2UoLyhbPSE6JFwvKCldKS9nLCAnXFwkMScpOwogIH0KICAvKioNCiAgICogQXR0YWNoIHRoZSBrZXlzIGFzIGEgcHJvcGVydHkgb2YgdGhlIHJlZ2V4cC4NCiAgICoNCiAgICogQHBhcmFtICB7IVJlZ0V4cH0gcmUNCiAgICogQHBhcmFtICB7QXJyYXl9ICAga2V5cw0KICAgKiBAcmV0dXJuIHshUmVnRXhwfQ0KICAgKi8KCgogIGZ1bmN0aW9uIGF0dGFjaEtleXMocmUsIGtleXMpIHsKICAgIHJlLmtleXMgPSBrZXlzOwogICAgcmV0dXJuIHJlOwogIH0KICAvKioNCiAgICogR2V0IHRoZSBmbGFncyBmb3IgYSByZWdleHAgZnJvbSB0aGUgb3B0aW9ucy4NCiAgICoNCiAgICogQHBhcmFtICB7T2JqZWN0fSBvcHRpb25zDQogICAqIEByZXR1cm4ge3N0cmluZ30NCiAgICovCgoKICBmdW5jdGlvbiBmbGFncyhvcHRpb25zKSB7CiAgICByZXR1cm4gb3B0aW9ucy5zZW5zaXRpdmUgPyAnJyA6ICdpJzsKICB9CiAgLyoqDQogICAqIFB1bGwgb3V0IGtleXMgZnJvbSBhIHJlZ2V4cC4NCiAgICoNCiAgICogQHBhcmFtICB7IVJlZ0V4cH0gcGF0aA0KICAgKiBAcGFyYW0gIHshQXJyYXl9ICBrZXlzDQogICAqIEByZXR1cm4geyFSZWdFeHB9DQogICAqLwoKCiAgZnVuY3Rpb24gcmVnZXhwVG9SZWdleHAocGF0aCwga2V5cykgewogICAgLy8gVXNlIGEgbmVnYXRpdmUgbG9va2FoZWFkIHRvIG1hdGNoIG9ubHkgY2FwdHVyaW5nIGdyb3Vwcy4KICAgIHZhciBncm91cHMgPSBwYXRoLnNvdXJjZS5tYXRjaCgvXCgoPyFcPykvZyk7CgogICAgaWYgKGdyb3VwcykgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgIGtleXMucHVzaCh7CiAgICAgICAgICBuYW1lOiBpLAogICAgICAgICAgcHJlZml4OiBudWxsLAogICAgICAgICAgZGVsaW1pdGVyOiBudWxsLAogICAgICAgICAgb3B0aW9uYWw6IGZhbHNlLAogICAgICAgICAgcmVwZWF0OiBmYWxzZSwKICAgICAgICAgIHBhcnRpYWw6IGZhbHNlLAogICAgICAgICAgYXN0ZXJpc2s6IGZhbHNlLAogICAgICAgICAgcGF0dGVybjogbnVsbAogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGF0dGFjaEtleXMocGF0aCwga2V5cyk7CiAgfQogIC8qKg0KICAgKiBUcmFuc2Zvcm0gYW4gYXJyYXkgaW50byBhIHJlZ2V4cC4NCiAgICoNCiAgICogQHBhcmFtICB7IUFycmF5fSAgcGF0aA0KICAgKiBAcGFyYW0gIHtBcnJheX0gICBrZXlzDQogICAqIEBwYXJhbSAgeyFPYmplY3R9IG9wdGlvbnMNCiAgICogQHJldHVybiB7IVJlZ0V4cH0NCiAgICovCgoKICBmdW5jdGlvbiBhcnJheVRvUmVnZXhwKHBhdGgsIGtleXMsIG9wdGlvbnMpIHsKICAgIHZhciBwYXJ0cyA9IFtdOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykgewogICAgICBwYXJ0cy5wdXNoKHBhdGhUb1JlZ2V4cChwYXRoW2ldLCBrZXlzLCBvcHRpb25zKS5zb3VyY2UpOwogICAgfQoKICAgIHZhciByZWdleHAgPSBuZXcgUmVnRXhwKCcoPzonICsgcGFydHMuam9pbignfCcpICsgJyknLCBmbGFncyhvcHRpb25zKSk7CiAgICByZXR1cm4gYXR0YWNoS2V5cyhyZWdleHAsIGtleXMpOwogIH0KICAvKioNCiAgICogQ3JlYXRlIGEgcGF0aCByZWdleHAgZnJvbSBzdHJpbmcgaW5wdXQuDQogICAqDQogICAqIEBwYXJhbSAge3N0cmluZ30gIHBhdGgNCiAgICogQHBhcmFtICB7IUFycmF5fSAga2V5cw0KICAgKiBAcGFyYW0gIHshT2JqZWN0fSBvcHRpb25zDQogICAqIEByZXR1cm4geyFSZWdFeHB9DQogICAqLwoKCiAgZnVuY3Rpb24gc3RyaW5nVG9SZWdleHAocGF0aCwga2V5cywgb3B0aW9ucykgewogICAgcmV0dXJuIHRva2Vuc1RvUmVnRXhwKHBhcnNlKHBhdGgsIG9wdGlvbnMpLCBrZXlzLCBvcHRpb25zKTsKICB9CiAgLyoqDQogICAqIEV4cG9zZSBhIGZ1bmN0aW9uIGZvciB0YWtpbmcgdG9rZW5zIGFuZCByZXR1cm5pbmcgYSBSZWdFeHAuDQogICAqDQogICAqIEBwYXJhbSAgeyFBcnJheX0gICAgICAgICAgdG9rZW5zDQogICAqIEBwYXJhbSAgeyhBcnJheXxPYmplY3QpPX0ga2V5cw0KICAgKiBAcGFyYW0gIHtPYmplY3Q9fSAgICAgICAgIG9wdGlvbnMNCiAgICogQHJldHVybiB7IVJlZ0V4cH0NCiAgICovCgoKICBmdW5jdGlvbiB0b2tlbnNUb1JlZ0V4cCh0b2tlbnMsIGtleXMsIG9wdGlvbnMpIHsKICAgIGlmICghaXNhcnJheShrZXlzKSkgewogICAgICBvcHRpb25zID0KICAgICAgLyoqIEB0eXBlIHshT2JqZWN0fSAqLwogICAgICBrZXlzIHx8IG9wdGlvbnM7CiAgICAgIGtleXMgPSBbXTsKICAgIH0KCiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgIHZhciBzdHJpY3QgPSBvcHRpb25zLnN0cmljdDsKICAgIHZhciBlbmQgPSBvcHRpb25zLmVuZCAhPT0gZmFsc2U7CiAgICB2YXIgcm91dGUgPSAnJzsgLy8gSXRlcmF0ZSBvdmVyIHRoZSB0b2tlbnMgYW5kIGNyZWF0ZSBvdXIgcmVnZXhwIHN0cmluZy4KCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgdG9rZW4gPSB0b2tlbnNbaV07CgogICAgICBpZiAodHlwZW9mIHRva2VuID09PSAnc3RyaW5nJykgewogICAgICAgIHJvdXRlICs9IGVzY2FwZVN0cmluZyh0b2tlbik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHByZWZpeCA9IGVzY2FwZVN0cmluZyh0b2tlbi5wcmVmaXgpOwogICAgICAgIHZhciBjYXB0dXJlID0gJyg/OicgKyB0b2tlbi5wYXR0ZXJuICsgJyknOwogICAgICAgIGtleXMucHVzaCh0b2tlbik7CgogICAgICAgIGlmICh0b2tlbi5yZXBlYXQpIHsKICAgICAgICAgIGNhcHR1cmUgKz0gJyg/OicgKyBwcmVmaXggKyBjYXB0dXJlICsgJykqJzsKICAgICAgICB9CgogICAgICAgIGlmICh0b2tlbi5vcHRpb25hbCkgewogICAgICAgICAgaWYgKCF0b2tlbi5wYXJ0aWFsKSB7CiAgICAgICAgICAgIGNhcHR1cmUgPSAnKD86JyArIHByZWZpeCArICcoJyArIGNhcHR1cmUgKyAnKSk/JzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNhcHR1cmUgPSBwcmVmaXggKyAnKCcgKyBjYXB0dXJlICsgJyk/JzsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2FwdHVyZSA9IHByZWZpeCArICcoJyArIGNhcHR1cmUgKyAnKSc7CiAgICAgICAgfQoKICAgICAgICByb3V0ZSArPSBjYXB0dXJlOwogICAgICB9CiAgICB9CgogICAgdmFyIGRlbGltaXRlciA9IGVzY2FwZVN0cmluZyhvcHRpb25zLmRlbGltaXRlciB8fCAnLycpOwogICAgdmFyIGVuZHNXaXRoRGVsaW1pdGVyID0gcm91dGUuc2xpY2UoLWRlbGltaXRlci5sZW5ndGgpID09PSBkZWxpbWl0ZXI7IC8vIEluIG5vbi1zdHJpY3QgbW9kZSB3ZSBhbGxvdyBhIHNsYXNoIGF0IHRoZSBlbmQgb2YgbWF0Y2guIElmIHRoZSBwYXRoIHRvCiAgICAvLyBtYXRjaCBhbHJlYWR5IGVuZHMgd2l0aCBhIHNsYXNoLCB3ZSByZW1vdmUgaXQgZm9yIGNvbnNpc3RlbmN5LiBUaGUgc2xhc2gKICAgIC8vIGlzIHZhbGlkIGF0IHRoZSBlbmQgb2YgYSBwYXRoIG1hdGNoLCBub3QgaW4gdGhlIG1pZGRsZS4gVGhpcyBpcyBpbXBvcnRhbnQKICAgIC8vIGluIG5vbi1lbmRpbmcgbW9kZSwgd2hlcmUgIi90ZXN0LyIgc2hvdWxkbid0IG1hdGNoICIvdGVzdC8vcm91dGUiLgoKICAgIGlmICghc3RyaWN0KSB7CiAgICAgIHJvdXRlID0gKGVuZHNXaXRoRGVsaW1pdGVyID8gcm91dGUuc2xpY2UoMCwgLWRlbGltaXRlci5sZW5ndGgpIDogcm91dGUpICsgJyg/OicgKyBkZWxpbWl0ZXIgKyAnKD89JCkpPyc7CiAgICB9CgogICAgaWYgKGVuZCkgewogICAgICByb3V0ZSArPSAnJCc7CiAgICB9IGVsc2UgewogICAgICAvLyBJbiBub24tZW5kaW5nIG1vZGUsIHdlIG5lZWQgdGhlIGNhcHR1cmluZyBncm91cHMgdG8gbWF0Y2ggYXMgbXVjaCBhcwogICAgICAvLyBwb3NzaWJsZSBieSB1c2luZyBhIHBvc2l0aXZlIGxvb2thaGVhZCB0byB0aGUgZW5kIG9yIG5leHQgcGF0aCBzZWdtZW50LgogICAgICByb3V0ZSArPSBzdHJpY3QgJiYgZW5kc1dpdGhEZWxpbWl0ZXIgPyAnJyA6ICcoPz0nICsgZGVsaW1pdGVyICsgJ3wkKSc7CiAgICB9CgogICAgcmV0dXJuIGF0dGFjaEtleXMobmV3IFJlZ0V4cCgnXicgKyByb3V0ZSwgZmxhZ3Mob3B0aW9ucykpLCBrZXlzKTsKICB9CiAgLyoqDQogICAqIE5vcm1hbGl6ZSB0aGUgZ2l2ZW4gcGF0aCBzdHJpbmcsIHJldHVybmluZyBhIHJlZ3VsYXIgZXhwcmVzc2lvbi4NCiAgICoNCiAgICogQW4gZW1wdHkgYXJyYXkgY2FuIGJlIHBhc3NlZCBpbiBmb3IgdGhlIGtleXMsIHdoaWNoIHdpbGwgaG9sZCB0aGUNCiAgICogcGxhY2Vob2xkZXIga2V5IGRlc2NyaXB0aW9ucy4gRm9yIGV4YW1wbGUsIHVzaW5nIGAvdXNlci86aWRgLCBga2V5c2Agd2lsbA0KICAgKiBjb250YWluIGBbeyBuYW1lOiAnaWQnLCBkZWxpbWl0ZXI6ICcvJywgb3B0aW9uYWw6IGZhbHNlLCByZXBlYXQ6IGZhbHNlIH1dYC4NCiAgICoNCiAgICogQHBhcmFtICB7KHN0cmluZ3xSZWdFeHB8QXJyYXkpfSBwYXRoDQogICAqIEBwYXJhbSAgeyhBcnJheXxPYmplY3QpPX0gICAgICAga2V5cw0KICAgKiBAcGFyYW0gIHtPYmplY3Q9fSAgICAgICAgICAgICAgIG9wdGlvbnMNCiAgICogQHJldHVybiB7IVJlZ0V4cH0NCiAgICovCgoKICBmdW5jdGlvbiBwYXRoVG9SZWdleHAocGF0aCwga2V5cywgb3B0aW9ucykgewogICAgaWYgKCFpc2FycmF5KGtleXMpKSB7CiAgICAgIG9wdGlvbnMgPQogICAgICAvKiogQHR5cGUgeyFPYmplY3R9ICovCiAgICAgIGtleXMgfHwgb3B0aW9uczsKICAgICAga2V5cyA9IFtdOwogICAgfQoKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICAgIGlmIChwYXRoIGluc3RhbmNlb2YgUmVnRXhwKSB7CiAgICAgIHJldHVybiByZWdleHBUb1JlZ2V4cChwYXRoLAogICAgICAvKiogQHR5cGUgeyFBcnJheX0gKi8KICAgICAga2V5cyk7CiAgICB9CgogICAgaWYgKGlzYXJyYXkocGF0aCkpIHsKICAgICAgcmV0dXJuIGFycmF5VG9SZWdleHAoCiAgICAgIC8qKiBAdHlwZSB7IUFycmF5fSAqLwogICAgICBwYXRoLAogICAgICAvKiogQHR5cGUgeyFBcnJheX0gKi8KICAgICAga2V5cywgb3B0aW9ucyk7CiAgICB9CgogICAgcmV0dXJuIHN0cmluZ1RvUmVnZXhwKAogICAgLyoqIEB0eXBlIHtzdHJpbmd9ICovCiAgICBwYXRoLAogICAgLyoqIEB0eXBlIHshQXJyYXl9ICovCiAgICBrZXlzLCBvcHRpb25zKTsKICB9CgogIHBhdGhUb1JlZ2V4cF8xLnBhcnNlID0gcGFyc2VfMTsKICBwYXRoVG9SZWdleHBfMS5jb21waWxlID0gY29tcGlsZV8xOwogIHBhdGhUb1JlZ2V4cF8xLnRva2Vuc1RvRnVuY3Rpb24gPSB0b2tlbnNUb0Z1bmN0aW9uXzE7CiAgcGF0aFRvUmVnZXhwXzEudG9rZW5zVG9SZWdFeHAgPSB0b2tlbnNUb1JlZ0V4cF8xOwogIC8qICAqLwogIC8vICRmbG93LWRpc2FibGUtbGluZQoKICB2YXIgcmVnZXhwQ29tcGlsZUNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCiAgZnVuY3Rpb24gZmlsbFBhcmFtcyhwYXRoLCBwYXJhbXMsIHJvdXRlTXNnKSB7CiAgICB0cnkgewogICAgICB2YXIgZmlsbGVyID0gcmVnZXhwQ29tcGlsZUNhY2hlW3BhdGhdIHx8IChyZWdleHBDb21waWxlQ2FjaGVbcGF0aF0gPSBwYXRoVG9SZWdleHBfMS5jb21waWxlKHBhdGgpKTsKICAgICAgcmV0dXJuIGZpbGxlcihwYXJhbXMgfHwge30sIHsKICAgICAgICBwcmV0dHk6IHRydWUKICAgICAgfSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHsKICAgICAgICB3YXJuKGZhbHNlLCAibWlzc2luZyBwYXJhbSBmb3IgIiArIHJvdXRlTXNnICsgIjogIiArIGUubWVzc2FnZSk7CiAgICAgIH0KICAgICAgcmV0dXJuICcnOwogICAgfQogIH0KICAvKiAgKi8KCgogIGZ1bmN0aW9uIGNyZWF0ZVJvdXRlTWFwKHJvdXRlcywgb2xkUGF0aExpc3QsIG9sZFBhdGhNYXAsIG9sZE5hbWVNYXApIHsKICAgIC8vIHRoZSBwYXRoIGxpc3QgaXMgdXNlZCB0byBjb250cm9sIHBhdGggbWF0Y2hpbmcgcHJpb3JpdHkKICAgIHZhciBwYXRoTGlzdCA9IG9sZFBhdGhMaXN0IHx8IFtdOyAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKCiAgICB2YXIgcGF0aE1hcCA9IG9sZFBhdGhNYXAgfHwgT2JqZWN0LmNyZWF0ZShudWxsKTsgLy8gJGZsb3ctZGlzYWJsZS1saW5lCgogICAgdmFyIG5hbWVNYXAgPSBvbGROYW1lTWFwIHx8IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICByb3V0ZXMuZm9yRWFjaChmdW5jdGlvbiAocm91dGUpIHsKICAgICAgYWRkUm91dGVSZWNvcmQocGF0aExpc3QsIHBhdGhNYXAsIG5hbWVNYXAsIHJvdXRlKTsKICAgIH0pOyAvLyBlbnN1cmUgd2lsZGNhcmQgcm91dGVzIGFyZSBhbHdheXMgYXQgdGhlIGVuZAoKICAgIGZvciAodmFyIGkgPSAwLCBsID0gcGF0aExpc3QubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIGlmIChwYXRoTGlzdFtpXSA9PT0gJyonKSB7CiAgICAgICAgcGF0aExpc3QucHVzaChwYXRoTGlzdC5zcGxpY2UoaSwgMSlbMF0pOwogICAgICAgIGwtLTsKICAgICAgICBpLS07CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICBwYXRoTGlzdDogcGF0aExpc3QsCiAgICAgIHBhdGhNYXA6IHBhdGhNYXAsCiAgICAgIG5hbWVNYXA6IG5hbWVNYXAKICAgIH07CiAgfQoKICBmdW5jdGlvbiBhZGRSb3V0ZVJlY29yZChwYXRoTGlzdCwgcGF0aE1hcCwgbmFtZU1hcCwgcm91dGUsIHBhcmVudCwgbWF0Y2hBcykgewogICAgdmFyIHBhdGggPSByb3V0ZS5wYXRoOwogICAgdmFyIG5hbWUgPSByb3V0ZS5uYW1lOwogICAgewogICAgICBhc3NlcnQocGF0aCAhPSBudWxsLCAiXCJwYXRoXCIgaXMgcmVxdWlyZWQgaW4gYSByb3V0ZSBjb25maWd1cmF0aW9uLiIpOwogICAgICBhc3NlcnQodHlwZW9mIHJvdXRlLmNvbXBvbmVudCAhPT0gJ3N0cmluZycsICJyb3V0ZSBjb25maWcgXCJjb21wb25lbnRcIiBmb3IgcGF0aDogIiArIFN0cmluZyhwYXRoIHx8IG5hbWUpICsgIiBjYW5ub3QgYmUgYSAiICsgInN0cmluZyBpZC4gVXNlIGFuIGFjdHVhbCBjb21wb25lbnQgaW5zdGVhZC4iKTsKICAgIH0KICAgIHZhciBwYXRoVG9SZWdleHBPcHRpb25zID0gcm91dGUucGF0aFRvUmVnZXhwT3B0aW9ucyB8fCB7fTsKICAgIHZhciBub3JtYWxpemVkUGF0aCA9IG5vcm1hbGl6ZVBhdGgocGF0aCwgcGFyZW50LCBwYXRoVG9SZWdleHBPcHRpb25zLnN0cmljdCk7CgogICAgaWYgKHR5cGVvZiByb3V0ZS5jYXNlU2Vuc2l0aXZlID09PSAnYm9vbGVhbicpIHsKICAgICAgcGF0aFRvUmVnZXhwT3B0aW9ucy5zZW5zaXRpdmUgPSByb3V0ZS5jYXNlU2Vuc2l0aXZlOwogICAgfQoKICAgIHZhciByZWNvcmQgPSB7CiAgICAgIHBhdGg6IG5vcm1hbGl6ZWRQYXRoLAogICAgICByZWdleDogY29tcGlsZVJvdXRlUmVnZXgobm9ybWFsaXplZFBhdGgsIHBhdGhUb1JlZ2V4cE9wdGlvbnMpLAogICAgICBjb21wb25lbnRzOiByb3V0ZS5jb21wb25lbnRzIHx8IHsKICAgICAgICBkZWZhdWx0OiByb3V0ZS5jb21wb25lbnQKICAgICAgfSwKICAgICAgaW5zdGFuY2VzOiB7fSwKICAgICAgbmFtZTogbmFtZSwKICAgICAgcGFyZW50OiBwYXJlbnQsCiAgICAgIG1hdGNoQXM6IG1hdGNoQXMsCiAgICAgIHJlZGlyZWN0OiByb3V0ZS5yZWRpcmVjdCwKICAgICAgYmVmb3JlRW50ZXI6IHJvdXRlLmJlZm9yZUVudGVyLAogICAgICBtZXRhOiByb3V0ZS5tZXRhIHx8IHt9LAogICAgICBwcm9wczogcm91dGUucHJvcHMgPT0gbnVsbCA/IHt9IDogcm91dGUuY29tcG9uZW50cyA/IHJvdXRlLnByb3BzIDogewogICAgICAgIGRlZmF1bHQ6IHJvdXRlLnByb3BzCiAgICAgIH0KICAgIH07CgogICAgaWYgKHJvdXRlLmNoaWxkcmVuKSB7CiAgICAgIC8vIFdhcm4gaWYgcm91dGUgaXMgbmFtZWQsIGRvZXMgbm90IHJlZGlyZWN0IGFuZCBoYXMgYSBkZWZhdWx0IGNoaWxkIHJvdXRlLgogICAgICAvLyBJZiB1c2VycyBuYXZpZ2F0ZSB0byB0aGlzIHJvdXRlIGJ5IG5hbWUsIHRoZSBkZWZhdWx0IGNoaWxkIHdpbGwKICAgICAgLy8gbm90IGJlIHJlbmRlcmVkIChHSCBJc3N1ZSAjNjI5KQogICAgICB7CiAgICAgICAgaWYgKHJvdXRlLm5hbWUgJiYgIXJvdXRlLnJlZGlyZWN0ICYmIHJvdXRlLmNoaWxkcmVuLnNvbWUoZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgICByZXR1cm4gL15cLz8kLy50ZXN0KGNoaWxkLnBhdGgpOwogICAgICAgIH0pKSB7CiAgICAgICAgICB3YXJuKGZhbHNlLCAiTmFtZWQgUm91dGUgJyIgKyByb3V0ZS5uYW1lICsgIicgaGFzIGEgZGVmYXVsdCBjaGlsZCByb3V0ZS4gIiArICJXaGVuIG5hdmlnYXRpbmcgdG8gdGhpcyBuYW1lZCByb3V0ZSAoOnRvPVwie25hbWU6ICciICsgcm91dGUubmFtZSArICInXCIpLCAiICsgInRoZSBkZWZhdWx0IGNoaWxkIHJvdXRlIHdpbGwgbm90IGJlIHJlbmRlcmVkLiBSZW1vdmUgdGhlIG5hbWUgZnJvbSAiICsgInRoaXMgcm91dGUgYW5kIHVzZSB0aGUgbmFtZSBvZiB0aGUgZGVmYXVsdCBjaGlsZCByb3V0ZSBmb3IgbmFtZWQgIiArICJsaW5rcyBpbnN0ZWFkLiIpOwogICAgICAgIH0KICAgICAgfQogICAgICByb3V0ZS5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICAgIHZhciBjaGlsZE1hdGNoQXMgPSBtYXRjaEFzID8gY2xlYW5QYXRoKG1hdGNoQXMgKyAiLyIgKyBjaGlsZC5wYXRoKSA6IHVuZGVmaW5lZDsKICAgICAgICBhZGRSb3V0ZVJlY29yZChwYXRoTGlzdCwgcGF0aE1hcCwgbmFtZU1hcCwgY2hpbGQsIHJlY29yZCwgY2hpbGRNYXRjaEFzKTsKICAgICAgfSk7CiAgICB9CgogICAgaWYgKHJvdXRlLmFsaWFzICE9PSB1bmRlZmluZWQpIHsKICAgICAgdmFyIGFsaWFzZXMgPSBBcnJheS5pc0FycmF5KHJvdXRlLmFsaWFzKSA/IHJvdXRlLmFsaWFzIDogW3JvdXRlLmFsaWFzXTsKICAgICAgYWxpYXNlcy5mb3JFYWNoKGZ1bmN0aW9uIChhbGlhcykgewogICAgICAgIHZhciBhbGlhc1JvdXRlID0gewogICAgICAgICAgcGF0aDogYWxpYXMsCiAgICAgICAgICBjaGlsZHJlbjogcm91dGUuY2hpbGRyZW4KICAgICAgICB9OwogICAgICAgIGFkZFJvdXRlUmVjb3JkKHBhdGhMaXN0LCBwYXRoTWFwLCBuYW1lTWFwLCBhbGlhc1JvdXRlLCBwYXJlbnQsIHJlY29yZC5wYXRoIHx8ICcvJyAvLyBtYXRjaEFzCiAgICAgICAgKTsKICAgICAgfSk7CiAgICB9CgogICAgaWYgKCFwYXRoTWFwW3JlY29yZC5wYXRoXSkgewogICAgICBwYXRoTGlzdC5wdXNoKHJlY29yZC5wYXRoKTsKICAgICAgcGF0aE1hcFtyZWNvcmQucGF0aF0gPSByZWNvcmQ7CiAgICB9CgogICAgaWYgKG5hbWUpIHsKICAgICAgaWYgKCFuYW1lTWFwW25hbWVdKSB7CiAgICAgICAgbmFtZU1hcFtuYW1lXSA9IHJlY29yZDsKICAgICAgfSBlbHNlIGlmICgiZGV2ZWxvcG1lbnQiICE9PSAncHJvZHVjdGlvbicgJiYgIW1hdGNoQXMpIHsKICAgICAgICB3YXJuKGZhbHNlLCAiRHVwbGljYXRlIG5hbWVkIHJvdXRlcyBkZWZpbml0aW9uOiAiICsgInsgbmFtZTogXCIiICsgbmFtZSArICJcIiwgcGF0aDogXCIiICsgcmVjb3JkLnBhdGggKyAiXCIgfSIpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjb21waWxlUm91dGVSZWdleChwYXRoLCBwYXRoVG9SZWdleHBPcHRpb25zKSB7CiAgICB2YXIgcmVnZXggPSBwYXRoVG9SZWdleHBfMShwYXRoLCBbXSwgcGF0aFRvUmVnZXhwT3B0aW9ucyk7CiAgICB7CiAgICAgIHZhciBrZXlzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgcmVnZXgua2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICB3YXJuKCFrZXlzW2tleS5uYW1lXSwgIkR1cGxpY2F0ZSBwYXJhbSBrZXlzIGluIHJvdXRlIHdpdGggcGF0aDogXCIiICsgcGF0aCArICJcIiIpOwogICAgICAgIGtleXNba2V5Lm5hbWVdID0gdHJ1ZTsKICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gcmVnZXg7CiAgfQoKICBmdW5jdGlvbiBub3JtYWxpemVQYXRoKHBhdGgsIHBhcmVudCwgc3RyaWN0KSB7CiAgICBpZiAoIXN0cmljdCkgewogICAgICBwYXRoID0gcGF0aC5yZXBsYWNlKC9cLyQvLCAnJyk7CiAgICB9CgogICAgaWYgKHBhdGhbMF0gPT09ICcvJykgewogICAgICByZXR1cm4gcGF0aDsKICAgIH0KCiAgICBpZiAocGFyZW50ID09IG51bGwpIHsKICAgICAgcmV0dXJuIHBhdGg7CiAgICB9CgogICAgcmV0dXJuIGNsZWFuUGF0aChwYXJlbnQucGF0aCArICIvIiArIHBhdGgpOwogIH0KICAvKiAgKi8KCgogIGZ1bmN0aW9uIG5vcm1hbGl6ZUxvY2F0aW9uKHJhdywgY3VycmVudCwgYXBwZW5kLCByb3V0ZXIpIHsKICAgIHZhciBuZXh0ID0gdHlwZW9mIHJhdyA9PT0gJ3N0cmluZycgPyB7CiAgICAgIHBhdGg6IHJhdwogICAgfSA6IHJhdzsgLy8gbmFtZWQgdGFyZ2V0CgogICAgaWYgKG5leHQubmFtZSB8fCBuZXh0Ll9ub3JtYWxpemVkKSB7CiAgICAgIHJldHVybiBuZXh0OwogICAgfSAvLyByZWxhdGl2ZSBwYXJhbXMKCgogICAgaWYgKCFuZXh0LnBhdGggJiYgbmV4dC5wYXJhbXMgJiYgY3VycmVudCkgewogICAgICBuZXh0ID0gYXNzaWduKHt9LCBuZXh0KTsKICAgICAgbmV4dC5fbm9ybWFsaXplZCA9IHRydWU7CiAgICAgIHZhciBwYXJhbXMgPSBhc3NpZ24oYXNzaWduKHt9LCBjdXJyZW50LnBhcmFtcyksIG5leHQucGFyYW1zKTsKCiAgICAgIGlmIChjdXJyZW50Lm5hbWUpIHsKICAgICAgICBuZXh0Lm5hbWUgPSBjdXJyZW50Lm5hbWU7CiAgICAgICAgbmV4dC5wYXJhbXMgPSBwYXJhbXM7CiAgICAgIH0gZWxzZSBpZiAoY3VycmVudC5tYXRjaGVkLmxlbmd0aCkgewogICAgICAgIHZhciByYXdQYXRoID0gY3VycmVudC5tYXRjaGVkW2N1cnJlbnQubWF0Y2hlZC5sZW5ndGggLSAxXS5wYXRoOwogICAgICAgIG5leHQucGF0aCA9IGZpbGxQYXJhbXMocmF3UGF0aCwgcGFyYW1zLCAicGF0aCAiICsgY3VycmVudC5wYXRoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKGZhbHNlLCAicmVsYXRpdmUgcGFyYW1zIG5hdmlnYXRpb24gcmVxdWlyZXMgYSBjdXJyZW50IHJvdXRlLiIpOwogICAgICB9CgogICAgICByZXR1cm4gbmV4dDsKICAgIH0KCiAgICB2YXIgcGFyc2VkUGF0aCA9IHBhcnNlUGF0aChuZXh0LnBhdGggfHwgJycpOwogICAgdmFyIGJhc2VQYXRoID0gY3VycmVudCAmJiBjdXJyZW50LnBhdGggfHwgJy8nOwogICAgdmFyIHBhdGggPSBwYXJzZWRQYXRoLnBhdGggPyByZXNvbHZlUGF0aChwYXJzZWRQYXRoLnBhdGgsIGJhc2VQYXRoLCBhcHBlbmQgfHwgbmV4dC5hcHBlbmQpIDogYmFzZVBhdGg7CiAgICB2YXIgcXVlcnkgPSByZXNvbHZlUXVlcnkocGFyc2VkUGF0aC5xdWVyeSwgbmV4dC5xdWVyeSwgcm91dGVyICYmIHJvdXRlci5vcHRpb25zLnBhcnNlUXVlcnkpOwogICAgdmFyIGhhc2ggPSBuZXh0Lmhhc2ggfHwgcGFyc2VkUGF0aC5oYXNoOwoKICAgIGlmIChoYXNoICYmIGhhc2guY2hhckF0KDApICE9PSAnIycpIHsKICAgICAgaGFzaCA9ICIjIiArIGhhc2g7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgX25vcm1hbGl6ZWQ6IHRydWUsCiAgICAgIHBhdGg6IHBhdGgsCiAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgaGFzaDogaGFzaAogICAgfTsKICB9CgogIGZ1bmN0aW9uIGFzc2lnbihhLCBiKSB7CiAgICBmb3IgKHZhciBrZXkgaW4gYikgewogICAgICBhW2tleV0gPSBiW2tleV07CiAgICB9CgogICAgcmV0dXJuIGE7CiAgfQogIC8qICAqLwoKCiAgZnVuY3Rpb24gY3JlYXRlTWF0Y2hlcihyb3V0ZXMsIHJvdXRlcikgewogICAgdmFyIHJlZiA9IGNyZWF0ZVJvdXRlTWFwKHJvdXRlcyk7CiAgICB2YXIgcGF0aExpc3QgPSByZWYucGF0aExpc3Q7CiAgICB2YXIgcGF0aE1hcCA9IHJlZi5wYXRoTWFwOwogICAgdmFyIG5hbWVNYXAgPSByZWYubmFtZU1hcDsKCiAgICBmdW5jdGlvbiBhZGRSb3V0ZXMocm91dGVzKSB7CiAgICAgIGNyZWF0ZVJvdXRlTWFwKHJvdXRlcywgcGF0aExpc3QsIHBhdGhNYXAsIG5hbWVNYXApOwogICAgfQoKICAgIGZ1bmN0aW9uIG1hdGNoKHJhdywgY3VycmVudFJvdXRlLCByZWRpcmVjdGVkRnJvbSkgewogICAgICB2YXIgbG9jYXRpb24gPSBub3JtYWxpemVMb2NhdGlvbihyYXcsIGN1cnJlbnRSb3V0ZSwgZmFsc2UsIHJvdXRlcik7CiAgICAgIHZhciBuYW1lID0gbG9jYXRpb24ubmFtZTsKCiAgICAgIGlmIChuYW1lKSB7CiAgICAgICAgdmFyIHJlY29yZCA9IG5hbWVNYXBbbmFtZV07CiAgICAgICAgewogICAgICAgICAgd2FybihyZWNvcmQsICJSb3V0ZSB3aXRoIG5hbWUgJyIgKyBuYW1lICsgIicgZG9lcyBub3QgZXhpc3QiKTsKICAgICAgICB9CgogICAgICAgIGlmICghcmVjb3JkKSB7CiAgICAgICAgICByZXR1cm4gX2NyZWF0ZVJvdXRlKG51bGwsIGxvY2F0aW9uKTsKICAgICAgICB9CgogICAgICAgIHZhciBwYXJhbU5hbWVzID0gcmVjb3JkLnJlZ2V4LmtleXMuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIHJldHVybiAha2V5Lm9wdGlvbmFsOwogICAgICAgIH0pLm1hcChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICByZXR1cm4ga2V5Lm5hbWU7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChfdHlwZW9mKGxvY2F0aW9uLnBhcmFtcykgIT09ICdvYmplY3QnKSB7CiAgICAgICAgICBsb2NhdGlvbi5wYXJhbXMgPSB7fTsKICAgICAgICB9CgogICAgICAgIGlmIChjdXJyZW50Um91dGUgJiYgX3R5cGVvZihjdXJyZW50Um91dGUucGFyYW1zKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBjdXJyZW50Um91dGUucGFyYW1zKSB7CiAgICAgICAgICAgIGlmICghKGtleSBpbiBsb2NhdGlvbi5wYXJhbXMpICYmIHBhcmFtTmFtZXMuaW5kZXhPZihrZXkpID4gLTEpIHsKICAgICAgICAgICAgICBsb2NhdGlvbi5wYXJhbXNba2V5XSA9IGN1cnJlbnRSb3V0ZS5wYXJhbXNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHJlY29yZCkgewogICAgICAgICAgbG9jYXRpb24ucGF0aCA9IGZpbGxQYXJhbXMocmVjb3JkLnBhdGgsIGxvY2F0aW9uLnBhcmFtcywgIm5hbWVkIHJvdXRlIFwiIiArIG5hbWUgKyAiXCIiKTsKICAgICAgICAgIHJldHVybiBfY3JlYXRlUm91dGUocmVjb3JkLCBsb2NhdGlvbiwgcmVkaXJlY3RlZEZyb20pOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChsb2NhdGlvbi5wYXRoKSB7CiAgICAgICAgbG9jYXRpb24ucGFyYW1zID0ge307CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGF0aExpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBwYXRoID0gcGF0aExpc3RbaV07CiAgICAgICAgICB2YXIgcmVjb3JkJDEgPSBwYXRoTWFwW3BhdGhdOwoKICAgICAgICAgIGlmIChtYXRjaFJvdXRlKHJlY29yZCQxLnJlZ2V4LCBsb2NhdGlvbi5wYXRoLCBsb2NhdGlvbi5wYXJhbXMpKSB7CiAgICAgICAgICAgIHJldHVybiBfY3JlYXRlUm91dGUocmVjb3JkJDEsIGxvY2F0aW9uLCByZWRpcmVjdGVkRnJvbSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIG5vIG1hdGNoCgoKICAgICAgcmV0dXJuIF9jcmVhdGVSb3V0ZShudWxsLCBsb2NhdGlvbik7CiAgICB9CgogICAgZnVuY3Rpb24gcmVkaXJlY3QocmVjb3JkLCBsb2NhdGlvbikgewogICAgICB2YXIgb3JpZ2luYWxSZWRpcmVjdCA9IHJlY29yZC5yZWRpcmVjdDsKICAgICAgdmFyIHJlZGlyZWN0ID0gdHlwZW9mIG9yaWdpbmFsUmVkaXJlY3QgPT09ICdmdW5jdGlvbicgPyBvcmlnaW5hbFJlZGlyZWN0KGNyZWF0ZVJvdXRlKHJlY29yZCwgbG9jYXRpb24sIG51bGwsIHJvdXRlcikpIDogb3JpZ2luYWxSZWRpcmVjdDsKCiAgICAgIGlmICh0eXBlb2YgcmVkaXJlY3QgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgcmVkaXJlY3QgPSB7CiAgICAgICAgICBwYXRoOiByZWRpcmVjdAogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGlmICghcmVkaXJlY3QgfHwgX3R5cGVvZihyZWRpcmVjdCkgIT09ICdvYmplY3QnKSB7CiAgICAgICAgewogICAgICAgICAgd2FybihmYWxzZSwgImludmFsaWQgcmVkaXJlY3Qgb3B0aW9uOiAiICsgSlNPTi5zdHJpbmdpZnkocmVkaXJlY3QpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jcmVhdGVSb3V0ZShudWxsLCBsb2NhdGlvbik7CiAgICAgIH0KCiAgICAgIHZhciByZSA9IHJlZGlyZWN0OwogICAgICB2YXIgbmFtZSA9IHJlLm5hbWU7CiAgICAgIHZhciBwYXRoID0gcmUucGF0aDsKICAgICAgdmFyIHF1ZXJ5ID0gbG9jYXRpb24ucXVlcnk7CiAgICAgIHZhciBoYXNoID0gbG9jYXRpb24uaGFzaDsKICAgICAgdmFyIHBhcmFtcyA9IGxvY2F0aW9uLnBhcmFtczsKICAgICAgcXVlcnkgPSByZS5oYXNPd25Qcm9wZXJ0eSgncXVlcnknKSA/IHJlLnF1ZXJ5IDogcXVlcnk7CiAgICAgIGhhc2ggPSByZS5oYXNPd25Qcm9wZXJ0eSgnaGFzaCcpID8gcmUuaGFzaCA6IGhhc2g7CiAgICAgIHBhcmFtcyA9IHJlLmhhc093blByb3BlcnR5KCdwYXJhbXMnKSA/IHJlLnBhcmFtcyA6IHBhcmFtczsKCiAgICAgIGlmIChuYW1lKSB7CiAgICAgICAgLy8gcmVzb2x2ZWQgbmFtZWQgZGlyZWN0CiAgICAgICAgdmFyIHRhcmdldFJlY29yZCA9IG5hbWVNYXBbbmFtZV07CiAgICAgICAgewogICAgICAgICAgYXNzZXJ0KHRhcmdldFJlY29yZCwgInJlZGlyZWN0IGZhaWxlZDogbmFtZWQgcm91dGUgXCIiICsgbmFtZSArICJcIiBub3QgZm91bmQuIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBtYXRjaCh7CiAgICAgICAgICBfbm9ybWFsaXplZDogdHJ1ZSwKICAgICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgICBoYXNoOiBoYXNoLAogICAgICAgICAgcGFyYW1zOiBwYXJhbXMKICAgICAgICB9LCB1bmRlZmluZWQsIGxvY2F0aW9uKTsKICAgICAgfSBlbHNlIGlmIChwYXRoKSB7CiAgICAgICAgLy8gMS4gcmVzb2x2ZSByZWxhdGl2ZSByZWRpcmVjdAogICAgICAgIHZhciByYXdQYXRoID0gcmVzb2x2ZVJlY29yZFBhdGgocGF0aCwgcmVjb3JkKTsgLy8gMi4gcmVzb2x2ZSBwYXJhbXMKCiAgICAgICAgdmFyIHJlc29sdmVkUGF0aCA9IGZpbGxQYXJhbXMocmF3UGF0aCwgcGFyYW1zLCAicmVkaXJlY3Qgcm91dGUgd2l0aCBwYXRoIFwiIiArIHJhd1BhdGggKyAiXCIiKTsgLy8gMy4gcmVtYXRjaCB3aXRoIGV4aXN0aW5nIHF1ZXJ5IGFuZCBoYXNoCgogICAgICAgIHJldHVybiBtYXRjaCh7CiAgICAgICAgICBfbm9ybWFsaXplZDogdHJ1ZSwKICAgICAgICAgIHBhdGg6IHJlc29sdmVkUGF0aCwKICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgIGhhc2g6IGhhc2gKICAgICAgICB9LCB1bmRlZmluZWQsIGxvY2F0aW9uKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB7CiAgICAgICAgICB3YXJuKGZhbHNlLCAiaW52YWxpZCByZWRpcmVjdCBvcHRpb246ICIgKyBKU09OLnN0cmluZ2lmeShyZWRpcmVjdCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2NyZWF0ZVJvdXRlKG51bGwsIGxvY2F0aW9uKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGFsaWFzKHJlY29yZCwgbG9jYXRpb24sIG1hdGNoQXMpIHsKICAgICAgdmFyIGFsaWFzZWRQYXRoID0gZmlsbFBhcmFtcyhtYXRjaEFzLCBsb2NhdGlvbi5wYXJhbXMsICJhbGlhc2VkIHJvdXRlIHdpdGggcGF0aCBcIiIgKyBtYXRjaEFzICsgIlwiIik7CiAgICAgIHZhciBhbGlhc2VkTWF0Y2ggPSBtYXRjaCh7CiAgICAgICAgX25vcm1hbGl6ZWQ6IHRydWUsCiAgICAgICAgcGF0aDogYWxpYXNlZFBhdGgKICAgICAgfSk7CgogICAgICBpZiAoYWxpYXNlZE1hdGNoKSB7CiAgICAgICAgdmFyIG1hdGNoZWQgPSBhbGlhc2VkTWF0Y2gubWF0Y2hlZDsKICAgICAgICB2YXIgYWxpYXNlZFJlY29yZCA9IG1hdGNoZWRbbWF0Y2hlZC5sZW5ndGggLSAxXTsKICAgICAgICBsb2NhdGlvbi5wYXJhbXMgPSBhbGlhc2VkTWF0Y2gucGFyYW1zOwogICAgICAgIHJldHVybiBfY3JlYXRlUm91dGUoYWxpYXNlZFJlY29yZCwgbG9jYXRpb24pOwogICAgICB9CgogICAgICByZXR1cm4gX2NyZWF0ZVJvdXRlKG51bGwsIGxvY2F0aW9uKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfY3JlYXRlUm91dGUocmVjb3JkLCBsb2NhdGlvbiwgcmVkaXJlY3RlZEZyb20pIHsKICAgICAgaWYgKHJlY29yZCAmJiByZWNvcmQucmVkaXJlY3QpIHsKICAgICAgICByZXR1cm4gcmVkaXJlY3QocmVjb3JkLCByZWRpcmVjdGVkRnJvbSB8fCBsb2NhdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChyZWNvcmQgJiYgcmVjb3JkLm1hdGNoQXMpIHsKICAgICAgICByZXR1cm4gYWxpYXMocmVjb3JkLCBsb2NhdGlvbiwgcmVjb3JkLm1hdGNoQXMpOwogICAgICB9CgogICAgICByZXR1cm4gY3JlYXRlUm91dGUocmVjb3JkLCBsb2NhdGlvbiwgcmVkaXJlY3RlZEZyb20sIHJvdXRlcik7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgbWF0Y2g6IG1hdGNoLAogICAgICBhZGRSb3V0ZXM6IGFkZFJvdXRlcwogICAgfTsKICB9CgogIGZ1bmN0aW9uIG1hdGNoUm91dGUocmVnZXgsIHBhdGgsIHBhcmFtcykgewogICAgdmFyIG0gPSBwYXRoLm1hdGNoKHJlZ2V4KTsKCiAgICBpZiAoIW0pIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSBlbHNlIGlmICghcGFyYW1zKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZvciAodmFyIGkgPSAxLCBsZW4gPSBtLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgIHZhciBrZXkgPSByZWdleC5rZXlzW2kgLSAxXTsKICAgICAgdmFyIHZhbCA9IHR5cGVvZiBtW2ldID09PSAnc3RyaW5nJyA/IGRlY29kZVVSSUNvbXBvbmVudChtW2ldKSA6IG1baV07CgogICAgICBpZiAoa2V5KSB7CiAgICAgICAgcGFyYW1zW2tleS5uYW1lXSA9IHZhbDsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gcmVzb2x2ZVJlY29yZFBhdGgocGF0aCwgcmVjb3JkKSB7CiAgICByZXR1cm4gcmVzb2x2ZVBhdGgocGF0aCwgcmVjb3JkLnBhcmVudCA/IHJlY29yZC5wYXJlbnQucGF0aCA6ICcvJywgdHJ1ZSk7CiAgfQogIC8qICAqLwoKCiAgdmFyIHBvc2l0aW9uU3RvcmUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICBmdW5jdGlvbiBzZXR1cFNjcm9sbCgpIHsKICAgIC8vIEZpeCBmb3IgIzE1ODUgZm9yIEZpcmVmb3gKICAgIHdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSh7CiAgICAgIGtleTogZ2V0U3RhdGVLZXkoKQogICAgfSwgJycpOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgZnVuY3Rpb24gKGUpIHsKICAgICAgc2F2ZVNjcm9sbFBvc2l0aW9uKCk7CgogICAgICBpZiAoZS5zdGF0ZSAmJiBlLnN0YXRlLmtleSkgewogICAgICAgIHNldFN0YXRlS2V5KGUuc3RhdGUua2V5KTsKICAgICAgfQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVTY3JvbGwocm91dGVyLCB0bywgZnJvbSwgaXNQb3ApIHsKICAgIGlmICghcm91dGVyLmFwcCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGJlaGF2aW9yID0gcm91dGVyLm9wdGlvbnMuc2Nyb2xsQmVoYXZpb3I7CgogICAgaWYgKCFiZWhhdmlvcikgewogICAgICByZXR1cm47CiAgICB9CgogICAgewogICAgICBhc3NlcnQodHlwZW9mIGJlaGF2aW9yID09PSAnZnVuY3Rpb24nLCAic2Nyb2xsQmVoYXZpb3IgbXVzdCBiZSBhIGZ1bmN0aW9uIik7CiAgICB9IC8vIHdhaXQgdW50aWwgcmUtcmVuZGVyIGZpbmlzaGVzIGJlZm9yZSBzY3JvbGxpbmcKCiAgICByb3V0ZXIuYXBwLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBwb3NpdGlvbiA9IGdldFNjcm9sbFBvc2l0aW9uKCk7CiAgICAgIHZhciBzaG91bGRTY3JvbGwgPSBiZWhhdmlvcih0bywgZnJvbSwgaXNQb3AgPyBwb3NpdGlvbiA6IG51bGwpOwoKICAgICAgaWYgKCFzaG91bGRTY3JvbGwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0eXBlb2Ygc2hvdWxkU2Nyb2xsLnRoZW4gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBzaG91bGRTY3JvbGwudGhlbihmdW5jdGlvbiAoc2hvdWxkU2Nyb2xsKSB7CiAgICAgICAgICBzY3JvbGxUb1Bvc2l0aW9uKHNob3VsZFNjcm9sbCwgcG9zaXRpb24pOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgIHsKICAgICAgICAgICAgYXNzZXJ0KGZhbHNlLCBlcnIudG9TdHJpbmcoKSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2Nyb2xsVG9Qb3NpdGlvbihzaG91bGRTY3JvbGwsIHBvc2l0aW9uKTsKICAgICAgfQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBzYXZlU2Nyb2xsUG9zaXRpb24oKSB7CiAgICB2YXIga2V5ID0gZ2V0U3RhdGVLZXkoKTsKCiAgICBpZiAoa2V5KSB7CiAgICAgIHBvc2l0aW9uU3RvcmVba2V5XSA9IHsKICAgICAgICB4OiB3aW5kb3cucGFnZVhPZmZzZXQsCiAgICAgICAgeTogd2luZG93LnBhZ2VZT2Zmc2V0CiAgICAgIH07CiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZXRTY3JvbGxQb3NpdGlvbigpIHsKICAgIHZhciBrZXkgPSBnZXRTdGF0ZUtleSgpOwoKICAgIGlmIChrZXkpIHsKICAgICAgcmV0dXJuIHBvc2l0aW9uU3RvcmVba2V5XTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldEVsZW1lbnRQb3NpdGlvbihlbCwgb2Zmc2V0KSB7CiAgICB2YXIgZG9jRWwgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICB2YXIgZG9jUmVjdCA9IGRvY0VsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgdmFyIGVsUmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgcmV0dXJuIHsKICAgICAgeDogZWxSZWN0LmxlZnQgLSBkb2NSZWN0LmxlZnQgLSBvZmZzZXQueCwKICAgICAgeTogZWxSZWN0LnRvcCAtIGRvY1JlY3QudG9wIC0gb2Zmc2V0LnkKICAgIH07CiAgfQoKICBmdW5jdGlvbiBpc1ZhbGlkUG9zaXRpb24ob2JqKSB7CiAgICByZXR1cm4gaXNOdW1iZXIob2JqLngpIHx8IGlzTnVtYmVyKG9iai55KTsKICB9CgogIGZ1bmN0aW9uIG5vcm1hbGl6ZVBvc2l0aW9uKG9iaikgewogICAgcmV0dXJuIHsKICAgICAgeDogaXNOdW1iZXIob2JqLngpID8gb2JqLnggOiB3aW5kb3cucGFnZVhPZmZzZXQsCiAgICAgIHk6IGlzTnVtYmVyKG9iai55KSA/IG9iai55IDogd2luZG93LnBhZ2VZT2Zmc2V0CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gbm9ybWFsaXplT2Zmc2V0KG9iaikgewogICAgcmV0dXJuIHsKICAgICAgeDogaXNOdW1iZXIob2JqLngpID8gb2JqLnggOiAwLAogICAgICB5OiBpc051bWJlcihvYmoueSkgPyBvYmoueSA6IDAKICAgIH07CiAgfQoKICBmdW5jdGlvbiBpc051bWJlcih2KSB7CiAgICByZXR1cm4gdHlwZW9mIHYgPT09ICdudW1iZXInOwogIH0KCiAgZnVuY3Rpb24gc2Nyb2xsVG9Qb3NpdGlvbihzaG91bGRTY3JvbGwsIHBvc2l0aW9uKSB7CiAgICB2YXIgaXNPYmplY3QgPSBfdHlwZW9mKHNob3VsZFNjcm9sbCkgPT09ICdvYmplY3QnOwoKICAgIGlmIChpc09iamVjdCAmJiB0eXBlb2Ygc2hvdWxkU2Nyb2xsLnNlbGVjdG9yID09PSAnc3RyaW5nJykgewogICAgICB2YXIgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNob3VsZFNjcm9sbC5zZWxlY3Rvcik7CgogICAgICBpZiAoZWwpIHsKICAgICAgICB2YXIgb2Zmc2V0ID0gc2hvdWxkU2Nyb2xsLm9mZnNldCAmJiBfdHlwZW9mKHNob3VsZFNjcm9sbC5vZmZzZXQpID09PSAnb2JqZWN0JyA/IHNob3VsZFNjcm9sbC5vZmZzZXQgOiB7fTsKICAgICAgICBvZmZzZXQgPSBub3JtYWxpemVPZmZzZXQob2Zmc2V0KTsKICAgICAgICBwb3NpdGlvbiA9IGdldEVsZW1lbnRQb3NpdGlvbihlbCwgb2Zmc2V0KTsKICAgICAgfSBlbHNlIGlmIChpc1ZhbGlkUG9zaXRpb24oc2hvdWxkU2Nyb2xsKSkgewogICAgICAgIHBvc2l0aW9uID0gbm9ybWFsaXplUG9zaXRpb24oc2hvdWxkU2Nyb2xsKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChpc09iamVjdCAmJiBpc1ZhbGlkUG9zaXRpb24oc2hvdWxkU2Nyb2xsKSkgewogICAgICBwb3NpdGlvbiA9IG5vcm1hbGl6ZVBvc2l0aW9uKHNob3VsZFNjcm9sbCk7CiAgICB9CgogICAgaWYgKHBvc2l0aW9uKSB7CiAgICAgIHdpbmRvdy5zY3JvbGxUbyhwb3NpdGlvbi54LCBwb3NpdGlvbi55KTsKICAgIH0KICB9CiAgLyogICovCgoKICB2YXIgc3VwcG9ydHNQdXNoU3RhdGUgPSBpbkJyb3dzZXIgJiYgZnVuY3Rpb24gKCkgewogICAgdmFyIHVhID0gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQ7CgogICAgaWYgKCh1YS5pbmRleE9mKCdBbmRyb2lkIDIuJykgIT09IC0xIHx8IHVhLmluZGV4T2YoJ0FuZHJvaWQgNC4wJykgIT09IC0xKSAmJiB1YS5pbmRleE9mKCdNb2JpbGUgU2FmYXJpJykgIT09IC0xICYmIHVhLmluZGV4T2YoJ0Nocm9tZScpID09PSAtMSAmJiB1YS5pbmRleE9mKCdXaW5kb3dzIFBob25lJykgPT09IC0xKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gd2luZG93Lmhpc3RvcnkgJiYgJ3B1c2hTdGF0ZScgaW4gd2luZG93Lmhpc3Rvcnk7CiAgfSgpOyAvLyB1c2UgVXNlciBUaW1pbmcgYXBpIChpZiBwcmVzZW50KSBmb3IgbW9yZSBhY2N1cmF0ZSBrZXkgcHJlY2lzaW9uCgoKICB2YXIgVGltZSA9IGluQnJvd3NlciAmJiB3aW5kb3cucGVyZm9ybWFuY2UgJiYgd2luZG93LnBlcmZvcm1hbmNlLm5vdyA/IHdpbmRvdy5wZXJmb3JtYW5jZSA6IERhdGU7CgogIHZhciBfa2V5ID0gZ2VuS2V5KCk7CgogIGZ1bmN0aW9uIGdlbktleSgpIHsKICAgIHJldHVybiBUaW1lLm5vdygpLnRvRml4ZWQoMyk7CiAgfQoKICBmdW5jdGlvbiBnZXRTdGF0ZUtleSgpIHsKICAgIHJldHVybiBfa2V5OwogIH0KCiAgZnVuY3Rpb24gc2V0U3RhdGVLZXkoa2V5KSB7CiAgICBfa2V5ID0ga2V5OwogIH0KCiAgZnVuY3Rpb24gcHVzaFN0YXRlKHVybCwgcmVwbGFjZSkgewogICAgc2F2ZVNjcm9sbFBvc2l0aW9uKCk7IC8vIHRyeS4uLmNhdGNoIHRoZSBwdXNoU3RhdGUgY2FsbCB0byBnZXQgYXJvdW5kIFNhZmFyaQogICAgLy8gRE9NIEV4Y2VwdGlvbiAxOCB3aGVyZSBpdCBsaW1pdHMgdG8gMTAwIHB1c2hTdGF0ZSBjYWxscwoKICAgIHZhciBoaXN0b3J5ID0gd2luZG93Lmhpc3Rvcnk7CgogICAgdHJ5IHsKICAgICAgaWYgKHJlcGxhY2UpIHsKICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZSh7CiAgICAgICAgICBrZXk6IF9rZXkKICAgICAgICB9LCAnJywgdXJsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBfa2V5ID0gZ2VuS2V5KCk7CiAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUoewogICAgICAgICAga2V5OiBfa2V5CiAgICAgICAgfSwgJycsIHVybCk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgd2luZG93LmxvY2F0aW9uW3JlcGxhY2UgPyAncmVwbGFjZScgOiAnYXNzaWduJ10odXJsKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlcGxhY2VTdGF0ZSh1cmwpIHsKICAgIHB1c2hTdGF0ZSh1cmwsIHRydWUpOwogIH0KICAvKiAgKi8KCgogIGZ1bmN0aW9uIHJ1blF1ZXVlKHF1ZXVlLCBmbiwgY2IpIHsKICAgIHZhciBzdGVwID0gZnVuY3Rpb24gc3RlcChpbmRleCkgewogICAgICBpZiAoaW5kZXggPj0gcXVldWUubGVuZ3RoKSB7CiAgICAgICAgY2IoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAocXVldWVbaW5kZXhdKSB7CiAgICAgICAgICBmbihxdWV1ZVtpbmRleF0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgc3RlcChpbmRleCArIDEpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0ZXAoaW5kZXggKyAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgc3RlcCgwKTsKICB9CiAgLyogICovCgoKICBmdW5jdGlvbiByZXNvbHZlQXN5bmNDb21wb25lbnRzKG1hdGNoZWQpIHsKICAgIHJldHVybiBmdW5jdGlvbiAodG8sIGZyb20sIG5leHQpIHsKICAgICAgdmFyIGhhc0FzeW5jID0gZmFsc2U7CiAgICAgIHZhciBwZW5kaW5nID0gMDsKICAgICAgdmFyIGVycm9yID0gbnVsbDsKICAgICAgZmxhdE1hcENvbXBvbmVudHMobWF0Y2hlZCwgZnVuY3Rpb24gKGRlZiwgXywgbWF0Y2gsIGtleSkgewogICAgICAgIC8vIGlmIGl0J3MgYSBmdW5jdGlvbiBhbmQgZG9lc24ndCBoYXZlIGNpZCBhdHRhY2hlZCwKICAgICAgICAvLyBhc3N1bWUgaXQncyBhbiBhc3luYyBjb21wb25lbnQgcmVzb2x2ZSBmdW5jdGlvbi4KICAgICAgICAvLyB3ZSBhcmUgbm90IHVzaW5nIFZ1ZSdzIGRlZmF1bHQgYXN5bmMgcmVzb2x2aW5nIG1lY2hhbmlzbSBiZWNhdXNlCiAgICAgICAgLy8gd2Ugd2FudCB0byBoYWx0IHRoZSBuYXZpZ2F0aW9uIHVudGlsIHRoZSBpbmNvbWluZyBjb21wb25lbnQgaGFzIGJlZW4KICAgICAgICAvLyByZXNvbHZlZC4KICAgICAgICBpZiAodHlwZW9mIGRlZiA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWYuY2lkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGhhc0FzeW5jID0gdHJ1ZTsKICAgICAgICAgIHBlbmRpbmcrKzsKICAgICAgICAgIHZhciByZXNvbHZlID0gb25jZShmdW5jdGlvbiAocmVzb2x2ZWREZWYpIHsKICAgICAgICAgICAgaWYgKGlzRVNNb2R1bGUocmVzb2x2ZWREZWYpKSB7CiAgICAgICAgICAgICAgcmVzb2x2ZWREZWYgPSByZXNvbHZlZERlZi5kZWZhdWx0OwogICAgICAgICAgICB9IC8vIHNhdmUgcmVzb2x2ZWQgb24gYXN5bmMgZmFjdG9yeSBpbiBjYXNlIGl0J3MgdXNlZCBlbHNld2hlcmUKCgogICAgICAgICAgICBkZWYucmVzb2x2ZWQgPSB0eXBlb2YgcmVzb2x2ZWREZWYgPT09ICdmdW5jdGlvbicgPyByZXNvbHZlZERlZiA6IF9WdWUuZXh0ZW5kKHJlc29sdmVkRGVmKTsKICAgICAgICAgICAgbWF0Y2guY29tcG9uZW50c1trZXldID0gcmVzb2x2ZWREZWY7CiAgICAgICAgICAgIHBlbmRpbmctLTsKCiAgICAgICAgICAgIGlmIChwZW5kaW5nIDw9IDApIHsKICAgICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIHJlamVjdCA9IG9uY2UoZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICB2YXIgbXNnID0gIkZhaWxlZCB0byByZXNvbHZlIGFzeW5jIGNvbXBvbmVudCAiICsga2V5ICsgIjogIiArIHJlYXNvbjsKICAgICAgICAgICAgImRldmVsb3BtZW50IiAhPT0gJ3Byb2R1Y3Rpb24nICYmIHdhcm4oZmFsc2UsIG1zZyk7CgogICAgICAgICAgICBpZiAoIWVycm9yKSB7CiAgICAgICAgICAgICAgZXJyb3IgPSBpc0Vycm9yKHJlYXNvbikgPyByZWFzb24gOiBuZXcgRXJyb3IobXNnKTsKICAgICAgICAgICAgICBuZXh0KGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgcmVzOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJlcyA9IGRlZihyZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgICBpZiAodHlwZW9mIHJlcy50aGVuID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgcmVzLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBuZXcgc3ludGF4IGluIFZ1ZSAyLjMKICAgICAgICAgICAgICB2YXIgY29tcCA9IHJlcy5jb21wb25lbnQ7CgogICAgICAgICAgICAgIGlmIChjb21wICYmIHR5cGVvZiBjb21wLnRoZW4gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIGNvbXAudGhlbihyZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CgogICAgICBpZiAoIWhhc0FzeW5jKSB7CiAgICAgICAgbmV4dCgpOwogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gZmxhdE1hcENvbXBvbmVudHMobWF0Y2hlZCwgZm4pIHsKICAgIHJldHVybiBmbGF0dGVuKG1hdGNoZWQubWFwKGZ1bmN0aW9uIChtKSB7CiAgICAgIHJldHVybiBPYmplY3Qua2V5cyhtLmNvbXBvbmVudHMpLm1hcChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgcmV0dXJuIGZuKG0uY29tcG9uZW50c1trZXldLCBtLmluc3RhbmNlc1trZXldLCBtLCBrZXkpOwogICAgICB9KTsKICAgIH0pKTsKICB9CgogIGZ1bmN0aW9uIGZsYXR0ZW4oYXJyKSB7CiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmNvbmNhdC5hcHBseShbXSwgYXJyKTsKICB9CgogIHZhciBoYXNTeW1ib2wgPSB0eXBlb2YgU3ltYm9sID09PSAnZnVuY3Rpb24nICYmIF90eXBlb2YoU3ltYm9sLnRvU3RyaW5nVGFnKSA9PT0gJ3N5bWJvbCc7CgogIGZ1bmN0aW9uIGlzRVNNb2R1bGUob2JqKSB7CiAgICByZXR1cm4gb2JqLl9fZXNNb2R1bGUgfHwgaGFzU3ltYm9sICYmIG9ialtTeW1ib2wudG9TdHJpbmdUYWddID09PSAnTW9kdWxlJzsKICB9IC8vIGluIFdlYnBhY2sgMiwgcmVxdWlyZS5lbnN1cmUgbm93IGFsc28gcmV0dXJucyBhIFByb21pc2UKICAvLyBzbyB0aGUgcmVzb2x2ZS9yZWplY3QgZnVuY3Rpb25zIG1heSBnZXQgY2FsbGVkIGFuIGV4dHJhIHRpbWUKICAvLyBpZiB0aGUgdXNlciB1c2VzIGFuIGFycm93IGZ1bmN0aW9uIHNob3J0aGFuZCB0aGF0IGhhcHBlbnMgdG8KICAvLyByZXR1cm4gdGhhdCBQcm9taXNlLgoKCiAgZnVuY3Rpb24gb25jZShmbikgewogICAgdmFyIGNhbGxlZCA9IGZhbHNlOwogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwKICAgICAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CgogICAgICB3aGlsZSAobGVuLS0pIHsKICAgICAgICBhcmdzW2xlbl0gPSBhcmd1bWVudHNbbGVuXTsKICAgICAgfQoKICAgICAgaWYgKGNhbGxlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY2FsbGVkID0gdHJ1ZTsKICAgICAgcmV0dXJuIGZuLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgfTsKICB9CiAgLyogICovCgoKICB2YXIgSGlzdG9yeSA9IGZ1bmN0aW9uIEhpc3Rvcnkocm91dGVyLCBiYXNlKSB7CiAgICB0aGlzLnJvdXRlciA9IHJvdXRlcjsKICAgIHRoaXMuYmFzZSA9IG5vcm1hbGl6ZUJhc2UoYmFzZSk7IC8vIHN0YXJ0IHdpdGggYSByb3V0ZSBvYmplY3QgdGhhdCBzdGFuZHMgZm9yICJub3doZXJlIgoKICAgIHRoaXMuY3VycmVudCA9IFNUQVJUOwogICAgdGhpcy5wZW5kaW5nID0gbnVsbDsKICAgIHRoaXMucmVhZHkgPSBmYWxzZTsKICAgIHRoaXMucmVhZHlDYnMgPSBbXTsKICAgIHRoaXMucmVhZHlFcnJvckNicyA9IFtdOwogICAgdGhpcy5lcnJvckNicyA9IFtdOwogIH07CgogIEhpc3RvcnkucHJvdG90eXBlLmxpc3RlbiA9IGZ1bmN0aW9uIGxpc3RlbihjYikgewogICAgdGhpcy5jYiA9IGNiOwogIH07CgogIEhpc3RvcnkucHJvdG90eXBlLm9uUmVhZHkgPSBmdW5jdGlvbiBvblJlYWR5KGNiLCBlcnJvckNiKSB7CiAgICBpZiAodGhpcy5yZWFkeSkgewogICAgICBjYigpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5yZWFkeUNicy5wdXNoKGNiKTsKCiAgICAgIGlmIChlcnJvckNiKSB7CiAgICAgICAgdGhpcy5yZWFkeUVycm9yQ2JzLnB1c2goZXJyb3JDYik7CiAgICAgIH0KICAgIH0KICB9OwoKICBIaXN0b3J5LnByb3RvdHlwZS5vbkVycm9yID0gZnVuY3Rpb24gb25FcnJvcihlcnJvckNiKSB7CiAgICB0aGlzLmVycm9yQ2JzLnB1c2goZXJyb3JDYik7CiAgfTsKCiAgSGlzdG9yeS5wcm90b3R5cGUudHJhbnNpdGlvblRvID0gZnVuY3Rpb24gdHJhbnNpdGlvblRvKGxvY2F0aW9uLCBvbkNvbXBsZXRlLCBvbkFib3J0KSB7CiAgICB2YXIgdGhpcyQxID0gdGhpczsKICAgIHZhciByb3V0ZSA9IHRoaXMucm91dGVyLm1hdGNoKGxvY2F0aW9uLCB0aGlzLmN1cnJlbnQpOwogICAgdGhpcy5jb25maXJtVHJhbnNpdGlvbihyb3V0ZSwgZnVuY3Rpb24gKCkgewogICAgICB0aGlzJDEudXBkYXRlUm91dGUocm91dGUpOwogICAgICBvbkNvbXBsZXRlICYmIG9uQ29tcGxldGUocm91dGUpOwogICAgICB0aGlzJDEuZW5zdXJlVVJMKCk7IC8vIGZpcmUgcmVhZHkgY2JzIG9uY2UKCiAgICAgIGlmICghdGhpcyQxLnJlYWR5KSB7CiAgICAgICAgdGhpcyQxLnJlYWR5ID0gdHJ1ZTsKICAgICAgICB0aGlzJDEucmVhZHlDYnMuZm9yRWFjaChmdW5jdGlvbiAoY2IpIHsKICAgICAgICAgIGNiKHJvdXRlKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwgZnVuY3Rpb24gKGVycikgewogICAgICBpZiAob25BYm9ydCkgewogICAgICAgIG9uQWJvcnQoZXJyKTsKICAgICAgfQoKICAgICAgaWYgKGVyciAmJiAhdGhpcyQxLnJlYWR5KSB7CiAgICAgICAgdGhpcyQxLnJlYWR5ID0gdHJ1ZTsKICAgICAgICB0aGlzJDEucmVhZHlFcnJvckNicy5mb3JFYWNoKGZ1bmN0aW9uIChjYikgewogICAgICAgICAgY2IoZXJyKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfTsKCiAgSGlzdG9yeS5wcm90b3R5cGUuY29uZmlybVRyYW5zaXRpb24gPSBmdW5jdGlvbiBjb25maXJtVHJhbnNpdGlvbihyb3V0ZSwgb25Db21wbGV0ZSwgb25BYm9ydCkgewogICAgdmFyIHRoaXMkMSA9IHRoaXM7CiAgICB2YXIgY3VycmVudCA9IHRoaXMuY3VycmVudDsKCiAgICB2YXIgYWJvcnQgPSBmdW5jdGlvbiBhYm9ydChlcnIpIHsKICAgICAgaWYgKGlzRXJyb3IoZXJyKSkgewogICAgICAgIGlmICh0aGlzJDEuZXJyb3JDYnMubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzJDEuZXJyb3JDYnMuZm9yRWFjaChmdW5jdGlvbiAoY2IpIHsKICAgICAgICAgICAgY2IoZXJyKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3YXJuKGZhbHNlLCAndW5jYXVnaHQgZXJyb3IgZHVyaW5nIHJvdXRlIG5hdmlnYXRpb246Jyk7CiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgICAgfQogICAgICB9CgogICAgICBvbkFib3J0ICYmIG9uQWJvcnQoZXJyKTsKICAgIH07CgogICAgaWYgKGlzU2FtZVJvdXRlKHJvdXRlLCBjdXJyZW50KSAmJiAvLyBpbiB0aGUgY2FzZSB0aGUgcm91dGUgbWFwIGhhcyBiZWVuIGR5bmFtaWNhbGx5IGFwcGVuZGVkIHRvCiAgICByb3V0ZS5tYXRjaGVkLmxlbmd0aCA9PT0gY3VycmVudC5tYXRjaGVkLmxlbmd0aCkgewogICAgICB0aGlzLmVuc3VyZVVSTCgpOwogICAgICByZXR1cm4gYWJvcnQoKTsKICAgIH0KCiAgICB2YXIgcmVmID0gcmVzb2x2ZVF1ZXVlKHRoaXMuY3VycmVudC5tYXRjaGVkLCByb3V0ZS5tYXRjaGVkKTsKICAgIHZhciB1cGRhdGVkID0gcmVmLnVwZGF0ZWQ7CiAgICB2YXIgZGVhY3RpdmF0ZWQgPSByZWYuZGVhY3RpdmF0ZWQ7CiAgICB2YXIgYWN0aXZhdGVkID0gcmVmLmFjdGl2YXRlZDsKICAgIHZhciBxdWV1ZSA9IFtdLmNvbmNhdCggLy8gaW4tY29tcG9uZW50IGxlYXZlIGd1YXJkcwogICAgZXh0cmFjdExlYXZlR3VhcmRzKGRlYWN0aXZhdGVkKSwgLy8gZ2xvYmFsIGJlZm9yZSBob29rcwogICAgdGhpcy5yb3V0ZXIuYmVmb3JlSG9va3MsIC8vIGluLWNvbXBvbmVudCB1cGRhdGUgaG9va3MKICAgIGV4dHJhY3RVcGRhdGVIb29rcyh1cGRhdGVkKSwgLy8gaW4tY29uZmlnIGVudGVyIGd1YXJkcwogICAgYWN0aXZhdGVkLm1hcChmdW5jdGlvbiAobSkgewogICAgICByZXR1cm4gbS5iZWZvcmVFbnRlcjsKICAgIH0pLCAvLyBhc3luYyBjb21wb25lbnRzCiAgICByZXNvbHZlQXN5bmNDb21wb25lbnRzKGFjdGl2YXRlZCkpOwogICAgdGhpcy5wZW5kaW5nID0gcm91dGU7CgogICAgdmFyIGl0ZXJhdG9yID0gZnVuY3Rpb24gaXRlcmF0b3IoaG9vaywgbmV4dCkgewogICAgICBpZiAodGhpcyQxLnBlbmRpbmcgIT09IHJvdXRlKSB7CiAgICAgICAgcmV0dXJuIGFib3J0KCk7CiAgICAgIH0KCiAgICAgIHRyeSB7CiAgICAgICAgaG9vayhyb3V0ZSwgY3VycmVudCwgZnVuY3Rpb24gKHRvKSB7CiAgICAgICAgICBpZiAodG8gPT09IGZhbHNlIHx8IGlzRXJyb3IodG8pKSB7CiAgICAgICAgICAgIC8vIG5leHQoZmFsc2UpIC0+IGFib3J0IG5hdmlnYXRpb24sIGVuc3VyZSBjdXJyZW50IFVSTAogICAgICAgICAgICB0aGlzJDEuZW5zdXJlVVJMKHRydWUpOwogICAgICAgICAgICBhYm9ydCh0byk7CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0byA9PT0gJ3N0cmluZycgfHwgX3R5cGVvZih0bykgPT09ICdvYmplY3QnICYmICh0eXBlb2YgdG8ucGF0aCA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIHRvLm5hbWUgPT09ICdzdHJpbmcnKSkgewogICAgICAgICAgICAvLyBuZXh0KCcvJykgb3IgbmV4dCh7IHBhdGg6ICcvJyB9KSAtPiByZWRpcmVjdAogICAgICAgICAgICBhYm9ydCgpOwoKICAgICAgICAgICAgaWYgKF90eXBlb2YodG8pID09PSAnb2JqZWN0JyAmJiB0by5yZXBsYWNlKSB7CiAgICAgICAgICAgICAgdGhpcyQxLnJlcGxhY2UodG8pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMkMS5wdXNoKHRvKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gY29uZmlybSB0cmFuc2l0aW9uIGFuZCBwYXNzIG9uIHRoZSB2YWx1ZQogICAgICAgICAgICBuZXh0KHRvKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGFib3J0KGUpOwogICAgICB9CiAgICB9OwoKICAgIHJ1blF1ZXVlKHF1ZXVlLCBpdGVyYXRvciwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgcG9zdEVudGVyQ2JzID0gW107CgogICAgICB2YXIgaXNWYWxpZCA9IGZ1bmN0aW9uIGlzVmFsaWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMkMS5jdXJyZW50ID09PSByb3V0ZTsKICAgICAgfTsgLy8gd2FpdCB1bnRpbCBhc3luYyBjb21wb25lbnRzIGFyZSByZXNvbHZlZCBiZWZvcmUKICAgICAgLy8gZXh0cmFjdGluZyBpbi1jb21wb25lbnQgZW50ZXIgZ3VhcmRzCgoKICAgICAgdmFyIGVudGVyR3VhcmRzID0gZXh0cmFjdEVudGVyR3VhcmRzKGFjdGl2YXRlZCwgcG9zdEVudGVyQ2JzLCBpc1ZhbGlkKTsKICAgICAgdmFyIHF1ZXVlID0gZW50ZXJHdWFyZHMuY29uY2F0KHRoaXMkMS5yb3V0ZXIucmVzb2x2ZUhvb2tzKTsKICAgICAgcnVuUXVldWUocXVldWUsIGl0ZXJhdG9yLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMkMS5wZW5kaW5nICE9PSByb3V0ZSkgewogICAgICAgICAgcmV0dXJuIGFib3J0KCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzJDEucGVuZGluZyA9IG51bGw7CiAgICAgICAgb25Db21wbGV0ZShyb3V0ZSk7CgogICAgICAgIGlmICh0aGlzJDEucm91dGVyLmFwcCkgewogICAgICAgICAgdGhpcyQxLnJvdXRlci5hcHAuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcG9zdEVudGVyQ2JzLmZvckVhY2goZnVuY3Rpb24gKGNiKSB7CiAgICAgICAgICAgICAgY2IoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfTsKCiAgSGlzdG9yeS5wcm90b3R5cGUudXBkYXRlUm91dGUgPSBmdW5jdGlvbiB1cGRhdGVSb3V0ZShyb3V0ZSkgewogICAgdmFyIHByZXYgPSB0aGlzLmN1cnJlbnQ7CiAgICB0aGlzLmN1cnJlbnQgPSByb3V0ZTsKICAgIHRoaXMuY2IgJiYgdGhpcy5jYihyb3V0ZSk7CiAgICB0aGlzLnJvdXRlci5hZnRlckhvb2tzLmZvckVhY2goZnVuY3Rpb24gKGhvb2spIHsKICAgICAgaG9vayAmJiBob29rKHJvdXRlLCBwcmV2KTsKICAgIH0pOwogIH07CgogIGZ1bmN0aW9uIG5vcm1hbGl6ZUJhc2UoYmFzZSkgewogICAgaWYgKCFiYXNlKSB7CiAgICAgIGlmIChpbkJyb3dzZXIpIHsKICAgICAgICAvLyByZXNwZWN0IDxiYXNlPiB0YWcKICAgICAgICB2YXIgYmFzZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYmFzZScpOwogICAgICAgIGJhc2UgPSBiYXNlRWwgJiYgYmFzZUVsLmdldEF0dHJpYnV0ZSgnaHJlZicpIHx8ICcvJzsgLy8gc3RyaXAgZnVsbCBVUkwgb3JpZ2luCgogICAgICAgIGJhc2UgPSBiYXNlLnJlcGxhY2UoL15odHRwcz86XC9cL1teXC9dKy8sICcnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBiYXNlID0gJy8nOwogICAgICB9CiAgICB9IC8vIG1ha2Ugc3VyZSB0aGVyZSdzIHRoZSBzdGFydGluZyBzbGFzaAoKCiAgICBpZiAoYmFzZS5jaGFyQXQoMCkgIT09ICcvJykgewogICAgICBiYXNlID0gJy8nICsgYmFzZTsKICAgIH0gLy8gcmVtb3ZlIHRyYWlsaW5nIHNsYXNoCgoKICAgIHJldHVybiBiYXNlLnJlcGxhY2UoL1wvJC8sICcnKTsKICB9CgogIGZ1bmN0aW9uIHJlc29sdmVRdWV1ZShjdXJyZW50LCBuZXh0KSB7CiAgICB2YXIgaTsKICAgIHZhciBtYXggPSBNYXRoLm1heChjdXJyZW50Lmxlbmd0aCwgbmV4dC5sZW5ndGgpOwoKICAgIGZvciAoaSA9IDA7IGkgPCBtYXg7IGkrKykgewogICAgICBpZiAoY3VycmVudFtpXSAhPT0gbmV4dFtpXSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgdXBkYXRlZDogbmV4dC5zbGljZSgwLCBpKSwKICAgICAgYWN0aXZhdGVkOiBuZXh0LnNsaWNlKGkpLAogICAgICBkZWFjdGl2YXRlZDogY3VycmVudC5zbGljZShpKQogICAgfTsKICB9CgogIGZ1bmN0aW9uIGV4dHJhY3RHdWFyZHMocmVjb3JkcywgbmFtZSwgYmluZCwgcmV2ZXJzZSkgewogICAgdmFyIGd1YXJkcyA9IGZsYXRNYXBDb21wb25lbnRzKHJlY29yZHMsIGZ1bmN0aW9uIChkZWYsIGluc3RhbmNlLCBtYXRjaCwga2V5KSB7CiAgICAgIHZhciBndWFyZCA9IGV4dHJhY3RHdWFyZChkZWYsIG5hbWUpOwoKICAgICAgaWYgKGd1YXJkKSB7CiAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoZ3VhcmQpID8gZ3VhcmQubWFwKGZ1bmN0aW9uIChndWFyZCkgewogICAgICAgICAgcmV0dXJuIGJpbmQoZ3VhcmQsIGluc3RhbmNlLCBtYXRjaCwga2V5KTsKICAgICAgICB9KSA6IGJpbmQoZ3VhcmQsIGluc3RhbmNlLCBtYXRjaCwga2V5KTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gZmxhdHRlbihyZXZlcnNlID8gZ3VhcmRzLnJldmVyc2UoKSA6IGd1YXJkcyk7CiAgfQoKICBmdW5jdGlvbiBleHRyYWN0R3VhcmQoZGVmLCBrZXkpIHsKICAgIGlmICh0eXBlb2YgZGVmICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgIC8vIGV4dGVuZCBub3cgc28gdGhhdCBnbG9iYWwgbWl4aW5zIGFyZSBhcHBsaWVkLgogICAgICBkZWYgPSBfVnVlLmV4dGVuZChkZWYpOwogICAgfQoKICAgIHJldHVybiBkZWYub3B0aW9uc1trZXldOwogIH0KCiAgZnVuY3Rpb24gZXh0cmFjdExlYXZlR3VhcmRzKGRlYWN0aXZhdGVkKSB7CiAgICByZXR1cm4gZXh0cmFjdEd1YXJkcyhkZWFjdGl2YXRlZCwgJ2JlZm9yZVJvdXRlTGVhdmUnLCBiaW5kR3VhcmQsIHRydWUpOwogIH0KCiAgZnVuY3Rpb24gZXh0cmFjdFVwZGF0ZUhvb2tzKHVwZGF0ZWQpIHsKICAgIHJldHVybiBleHRyYWN0R3VhcmRzKHVwZGF0ZWQsICdiZWZvcmVSb3V0ZVVwZGF0ZScsIGJpbmRHdWFyZCk7CiAgfQoKICBmdW5jdGlvbiBiaW5kR3VhcmQoZ3VhcmQsIGluc3RhbmNlKSB7CiAgICBpZiAoaW5zdGFuY2UpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIGJvdW5kUm91dGVHdWFyZCgpIHsKICAgICAgICByZXR1cm4gZ3VhcmQuYXBwbHkoaW5zdGFuY2UsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9CiAgfQoKICBmdW5jdGlvbiBleHRyYWN0RW50ZXJHdWFyZHMoYWN0aXZhdGVkLCBjYnMsIGlzVmFsaWQpIHsKICAgIHJldHVybiBleHRyYWN0R3VhcmRzKGFjdGl2YXRlZCwgJ2JlZm9yZVJvdXRlRW50ZXInLCBmdW5jdGlvbiAoZ3VhcmQsIF8sIG1hdGNoLCBrZXkpIHsKICAgICAgcmV0dXJuIGJpbmRFbnRlckd1YXJkKGd1YXJkLCBtYXRjaCwga2V5LCBjYnMsIGlzVmFsaWQpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBiaW5kRW50ZXJHdWFyZChndWFyZCwgbWF0Y2gsIGtleSwgY2JzLCBpc1ZhbGlkKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gcm91dGVFbnRlckd1YXJkKHRvLCBmcm9tLCBuZXh0KSB7CiAgICAgIHJldHVybiBndWFyZCh0bywgZnJvbSwgZnVuY3Rpb24gKGNiKSB7CiAgICAgICAgbmV4dChjYik7CgogICAgICAgIGlmICh0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIGNicy5wdXNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy8gIzc1MAogICAgICAgICAgICAvLyBpZiBhIHJvdXRlci12aWV3IGlzIHdyYXBwZWQgd2l0aCBhbiBvdXQtaW4gdHJhbnNpdGlvbiwKICAgICAgICAgICAgLy8gdGhlIGluc3RhbmNlIG1heSBub3QgaGF2ZSBiZWVuIHJlZ2lzdGVyZWQgYXQgdGhpcyB0aW1lLgogICAgICAgICAgICAvLyB3ZSB3aWxsIG5lZWQgdG8gcG9sbCBmb3IgcmVnaXN0cmF0aW9uIHVudGlsIGN1cnJlbnQgcm91dGUKICAgICAgICAgICAgLy8gaXMgbm8gbG9uZ2VyIHZhbGlkLgogICAgICAgICAgICBwb2xsKGNiLCBtYXRjaC5pbnN0YW5jZXMsIGtleSwgaXNWYWxpZCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIHBvbGwoY2IsIC8vIHNvbWVob3cgZmxvdyBjYW5ub3QgaW5mZXIgdGhpcyBpcyBhIGZ1bmN0aW9uCiAgaW5zdGFuY2VzLCBrZXksIGlzVmFsaWQpIHsKICAgIGlmIChpbnN0YW5jZXNba2V5XSkgewogICAgICBjYihpbnN0YW5jZXNba2V5XSk7CiAgICB9IGVsc2UgaWYgKGlzVmFsaWQoKSkgewogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBwb2xsKGNiLCBpbnN0YW5jZXMsIGtleSwgaXNWYWxpZCk7CiAgICAgIH0sIDE2KTsKICAgIH0KICB9CiAgLyogICovCgoKICB2YXIgSFRNTDVIaXN0b3J5ID0gZnVuY3Rpb24gKEhpc3RvcnkkJDEpIHsKICAgIGZ1bmN0aW9uIEhUTUw1SGlzdG9yeShyb3V0ZXIsIGJhc2UpIHsKICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7CiAgICAgIEhpc3RvcnkkJDEuY2FsbCh0aGlzLCByb3V0ZXIsIGJhc2UpOwogICAgICB2YXIgZXhwZWN0U2Nyb2xsID0gcm91dGVyLm9wdGlvbnMuc2Nyb2xsQmVoYXZpb3I7CgogICAgICBpZiAoZXhwZWN0U2Nyb2xsKSB7CiAgICAgICAgc2V0dXBTY3JvbGwoKTsKICAgICAgfQoKICAgICAgdmFyIGluaXRMb2NhdGlvbiA9IGdldExvY2F0aW9uKHRoaXMuYmFzZSk7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwb3BzdGF0ZScsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzJDEuY3VycmVudDsgLy8gQXZvaWRpbmcgZmlyc3QgYHBvcHN0YXRlYCBldmVudCBkaXNwYXRjaGVkIGluIHNvbWUgYnJvd3NlcnMgYnV0IGZpcnN0CiAgICAgICAgLy8gaGlzdG9yeSByb3V0ZSBub3QgdXBkYXRlZCBzaW5jZSBhc3luYyBndWFyZCBhdCB0aGUgc2FtZSB0aW1lLgoKICAgICAgICB2YXIgbG9jYXRpb24gPSBnZXRMb2NhdGlvbih0aGlzJDEuYmFzZSk7CgogICAgICAgIGlmICh0aGlzJDEuY3VycmVudCA9PT0gU1RBUlQgJiYgbG9jYXRpb24gPT09IGluaXRMb2NhdGlvbikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdGhpcyQxLnRyYW5zaXRpb25Ubyhsb2NhdGlvbiwgZnVuY3Rpb24gKHJvdXRlKSB7CiAgICAgICAgICBpZiAoZXhwZWN0U2Nyb2xsKSB7CiAgICAgICAgICAgIGhhbmRsZVNjcm9sbChyb3V0ZXIsIHJvdXRlLCBjdXJyZW50LCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgaWYgKEhpc3RvcnkkJDEpIEhUTUw1SGlzdG9yeS5fX3Byb3RvX18gPSBIaXN0b3J5JCQxOwogICAgSFRNTDVIaXN0b3J5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoSGlzdG9yeSQkMSAmJiBIaXN0b3J5JCQxLnByb3RvdHlwZSk7CiAgICBIVE1MNUhpc3RvcnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gSFRNTDVIaXN0b3J5OwoKICAgIEhUTUw1SGlzdG9yeS5wcm90b3R5cGUuZ28gPSBmdW5jdGlvbiBnbyhuKSB7CiAgICAgIHdpbmRvdy5oaXN0b3J5LmdvKG4pOwogICAgfTsKCiAgICBIVE1MNUhpc3RvcnkucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiBwdXNoKGxvY2F0aW9uLCBvbkNvbXBsZXRlLCBvbkFib3J0KSB7CiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOwogICAgICB2YXIgcmVmID0gdGhpczsKICAgICAgdmFyIGZyb21Sb3V0ZSA9IHJlZi5jdXJyZW50OwogICAgICB0aGlzLnRyYW5zaXRpb25Ubyhsb2NhdGlvbiwgZnVuY3Rpb24gKHJvdXRlKSB7CiAgICAgICAgcHVzaFN0YXRlKGNsZWFuUGF0aCh0aGlzJDEuYmFzZSArIHJvdXRlLmZ1bGxQYXRoKSk7CiAgICAgICAgaGFuZGxlU2Nyb2xsKHRoaXMkMS5yb3V0ZXIsIHJvdXRlLCBmcm9tUm91dGUsIGZhbHNlKTsKICAgICAgICBvbkNvbXBsZXRlICYmIG9uQ29tcGxldGUocm91dGUpOwogICAgICB9LCBvbkFib3J0KTsKICAgIH07CgogICAgSFRNTDVIaXN0b3J5LnByb3RvdHlwZS5yZXBsYWNlID0gZnVuY3Rpb24gcmVwbGFjZShsb2NhdGlvbiwgb25Db21wbGV0ZSwgb25BYm9ydCkgewogICAgICB2YXIgdGhpcyQxID0gdGhpczsKICAgICAgdmFyIHJlZiA9IHRoaXM7CiAgICAgIHZhciBmcm9tUm91dGUgPSByZWYuY3VycmVudDsKICAgICAgdGhpcy50cmFuc2l0aW9uVG8obG9jYXRpb24sIGZ1bmN0aW9uIChyb3V0ZSkgewogICAgICAgIHJlcGxhY2VTdGF0ZShjbGVhblBhdGgodGhpcyQxLmJhc2UgKyByb3V0ZS5mdWxsUGF0aCkpOwogICAgICAgIGhhbmRsZVNjcm9sbCh0aGlzJDEucm91dGVyLCByb3V0ZSwgZnJvbVJvdXRlLCBmYWxzZSk7CiAgICAgICAgb25Db21wbGV0ZSAmJiBvbkNvbXBsZXRlKHJvdXRlKTsKICAgICAgfSwgb25BYm9ydCk7CiAgICB9OwoKICAgIEhUTUw1SGlzdG9yeS5wcm90b3R5cGUuZW5zdXJlVVJMID0gZnVuY3Rpb24gZW5zdXJlVVJMKHB1c2gpIHsKICAgICAgaWYgKGdldExvY2F0aW9uKHRoaXMuYmFzZSkgIT09IHRoaXMuY3VycmVudC5mdWxsUGF0aCkgewogICAgICAgIHZhciBjdXJyZW50ID0gY2xlYW5QYXRoKHRoaXMuYmFzZSArIHRoaXMuY3VycmVudC5mdWxsUGF0aCk7CiAgICAgICAgcHVzaCA/IHB1c2hTdGF0ZShjdXJyZW50KSA6IHJlcGxhY2VTdGF0ZShjdXJyZW50KTsKICAgICAgfQogICAgfTsKCiAgICBIVE1MNUhpc3RvcnkucHJvdG90eXBlLmdldEN1cnJlbnRMb2NhdGlvbiA9IGZ1bmN0aW9uIGdldEN1cnJlbnRMb2NhdGlvbigpIHsKICAgICAgcmV0dXJuIGdldExvY2F0aW9uKHRoaXMuYmFzZSk7CiAgICB9OwoKICAgIHJldHVybiBIVE1MNUhpc3Rvcnk7CiAgfShIaXN0b3J5KTsKCiAgZnVuY3Rpb24gZ2V0TG9jYXRpb24oYmFzZSkgewogICAgdmFyIHBhdGggPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7CgogICAgaWYgKGJhc2UgJiYgcGF0aC5pbmRleE9mKGJhc2UpID09PSAwKSB7CiAgICAgIHBhdGggPSBwYXRoLnNsaWNlKGJhc2UubGVuZ3RoKTsKICAgIH0KCiAgICByZXR1cm4gKHBhdGggfHwgJy8nKSArIHdpbmRvdy5sb2NhdGlvbi5zZWFyY2ggKyB3aW5kb3cubG9jYXRpb24uaGFzaDsKICB9CiAgLyogICovCgoKICB2YXIgSGFzaEhpc3RvcnkgPSBmdW5jdGlvbiAoSGlzdG9yeSQkMSkgewogICAgZnVuY3Rpb24gSGFzaEhpc3Rvcnkocm91dGVyLCBiYXNlLCBmYWxsYmFjaykgewogICAgICBIaXN0b3J5JCQxLmNhbGwodGhpcywgcm91dGVyLCBiYXNlKTsgLy8gY2hlY2sgaGlzdG9yeSBmYWxsYmFjayBkZWVwbGlua2luZwoKICAgICAgaWYgKGZhbGxiYWNrICYmIGNoZWNrRmFsbGJhY2sodGhpcy5iYXNlKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZW5zdXJlU2xhc2goKTsKICAgIH0KCiAgICBpZiAoSGlzdG9yeSQkMSkgSGFzaEhpc3RvcnkuX19wcm90b19fID0gSGlzdG9yeSQkMTsKICAgIEhhc2hIaXN0b3J5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoSGlzdG9yeSQkMSAmJiBIaXN0b3J5JCQxLnByb3RvdHlwZSk7CiAgICBIYXNoSGlzdG9yeS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBIYXNoSGlzdG9yeTsgLy8gdGhpcyBpcyBkZWxheWVkIHVudGlsIHRoZSBhcHAgbW91bnRzCiAgICAvLyB0byBhdm9pZCB0aGUgaGFzaGNoYW5nZSBsaXN0ZW5lciBiZWluZyBmaXJlZCB0b28gZWFybHkKCiAgICBIYXNoSGlzdG9yeS5wcm90b3R5cGUuc2V0dXBMaXN0ZW5lcnMgPSBmdW5jdGlvbiBzZXR1cExpc3RlbmVycygpIHsKICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7CiAgICAgIHZhciByb3V0ZXIgPSB0aGlzLnJvdXRlcjsKICAgICAgdmFyIGV4cGVjdFNjcm9sbCA9IHJvdXRlci5vcHRpb25zLnNjcm9sbEJlaGF2aW9yOwogICAgICB2YXIgc3VwcG9ydHNTY3JvbGwgPSBzdXBwb3J0c1B1c2hTdGF0ZSAmJiBleHBlY3RTY3JvbGw7CgogICAgICBpZiAoc3VwcG9ydHNTY3JvbGwpIHsKICAgICAgICBzZXR1cFNjcm9sbCgpOwogICAgICB9CgogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihzdXBwb3J0c1B1c2hTdGF0ZSA/ICdwb3BzdGF0ZScgOiAnaGFzaGNoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgY3VycmVudCA9IHRoaXMkMS5jdXJyZW50OwoKICAgICAgICBpZiAoIWVuc3VyZVNsYXNoKCkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRoaXMkMS50cmFuc2l0aW9uVG8oZ2V0SGFzaCgpLCBmdW5jdGlvbiAocm91dGUpIHsKICAgICAgICAgIGlmIChzdXBwb3J0c1Njcm9sbCkgewogICAgICAgICAgICBoYW5kbGVTY3JvbGwodGhpcyQxLnJvdXRlciwgcm91dGUsIGN1cnJlbnQsIHRydWUpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghc3VwcG9ydHNQdXNoU3RhdGUpIHsKICAgICAgICAgICAgcmVwbGFjZUhhc2gocm91dGUuZnVsbFBhdGgpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH07CgogICAgSGFzaEhpc3RvcnkucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiBwdXNoKGxvY2F0aW9uLCBvbkNvbXBsZXRlLCBvbkFib3J0KSB7CiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOwogICAgICB2YXIgcmVmID0gdGhpczsKICAgICAgdmFyIGZyb21Sb3V0ZSA9IHJlZi5jdXJyZW50OwogICAgICB0aGlzLnRyYW5zaXRpb25Ubyhsb2NhdGlvbiwgZnVuY3Rpb24gKHJvdXRlKSB7CiAgICAgICAgcHVzaEhhc2gocm91dGUuZnVsbFBhdGgpOwogICAgICAgIGhhbmRsZVNjcm9sbCh0aGlzJDEucm91dGVyLCByb3V0ZSwgZnJvbVJvdXRlLCBmYWxzZSk7CiAgICAgICAgb25Db21wbGV0ZSAmJiBvbkNvbXBsZXRlKHJvdXRlKTsKICAgICAgfSwgb25BYm9ydCk7CiAgICB9OwoKICAgIEhhc2hIaXN0b3J5LnByb3RvdHlwZS5yZXBsYWNlID0gZnVuY3Rpb24gcmVwbGFjZShsb2NhdGlvbiwgb25Db21wbGV0ZSwgb25BYm9ydCkgewogICAgICB2YXIgdGhpcyQxID0gdGhpczsKICAgICAgdmFyIHJlZiA9IHRoaXM7CiAgICAgIHZhciBmcm9tUm91dGUgPSByZWYuY3VycmVudDsKICAgICAgdGhpcy50cmFuc2l0aW9uVG8obG9jYXRpb24sIGZ1bmN0aW9uIChyb3V0ZSkgewogICAgICAgIHJlcGxhY2VIYXNoKHJvdXRlLmZ1bGxQYXRoKTsKICAgICAgICBoYW5kbGVTY3JvbGwodGhpcyQxLnJvdXRlciwgcm91dGUsIGZyb21Sb3V0ZSwgZmFsc2UpOwogICAgICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZShyb3V0ZSk7CiAgICAgIH0sIG9uQWJvcnQpOwogICAgfTsKCiAgICBIYXNoSGlzdG9yeS5wcm90b3R5cGUuZ28gPSBmdW5jdGlvbiBnbyhuKSB7CiAgICAgIHdpbmRvdy5oaXN0b3J5LmdvKG4pOwogICAgfTsKCiAgICBIYXNoSGlzdG9yeS5wcm90b3R5cGUuZW5zdXJlVVJMID0gZnVuY3Rpb24gZW5zdXJlVVJMKHB1c2gpIHsKICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmN1cnJlbnQuZnVsbFBhdGg7CgogICAgICBpZiAoZ2V0SGFzaCgpICE9PSBjdXJyZW50KSB7CiAgICAgICAgcHVzaCA/IHB1c2hIYXNoKGN1cnJlbnQpIDogcmVwbGFjZUhhc2goY3VycmVudCk7CiAgICAgIH0KICAgIH07CgogICAgSGFzaEhpc3RvcnkucHJvdG90eXBlLmdldEN1cnJlbnRMb2NhdGlvbiA9IGZ1bmN0aW9uIGdldEN1cnJlbnRMb2NhdGlvbigpIHsKICAgICAgcmV0dXJuIGdldEhhc2goKTsKICAgIH07CgogICAgcmV0dXJuIEhhc2hIaXN0b3J5OwogIH0oSGlzdG9yeSk7CgogIGZ1bmN0aW9uIGNoZWNrRmFsbGJhY2soYmFzZSkgewogICAgdmFyIGxvY2F0aW9uID0gZ2V0TG9jYXRpb24oYmFzZSk7CgogICAgaWYgKCEvXlwvIy8udGVzdChsb2NhdGlvbikpIHsKICAgICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2UoY2xlYW5QYXRoKGJhc2UgKyAnLyMnICsgbG9jYXRpb24pKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBlbnN1cmVTbGFzaCgpIHsKICAgIHZhciBwYXRoID0gZ2V0SGFzaCgpOwoKICAgIGlmIChwYXRoLmNoYXJBdCgwKSA9PT0gJy8nKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHJlcGxhY2VIYXNoKCcvJyArIHBhdGgpOwogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gZ2V0SGFzaCgpIHsKICAgIC8vIFdlIGNhbid0IHVzZSB3aW5kb3cubG9jYXRpb24uaGFzaCBoZXJlIGJlY2F1c2UgaXQncyBub3QKICAgIC8vIGNvbnNpc3RlbnQgYWNyb3NzIGJyb3dzZXJzIC0gRmlyZWZveCB3aWxsIHByZS1kZWNvZGUgaXQhCiAgICB2YXIgaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgdmFyIGluZGV4ID0gaHJlZi5pbmRleE9mKCcjJyk7CiAgICByZXR1cm4gaW5kZXggPT09IC0xID8gJycgOiBocmVmLnNsaWNlKGluZGV4ICsgMSk7CiAgfQoKICBmdW5jdGlvbiBnZXRVcmwocGF0aCkgewogICAgdmFyIGhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAgIHZhciBpID0gaHJlZi5pbmRleE9mKCcjJyk7CiAgICB2YXIgYmFzZSA9IGkgPj0gMCA/IGhyZWYuc2xpY2UoMCwgaSkgOiBocmVmOwogICAgcmV0dXJuIGJhc2UgKyAiIyIgKyBwYXRoOwogIH0KCiAgZnVuY3Rpb24gcHVzaEhhc2gocGF0aCkgewogICAgaWYgKHN1cHBvcnRzUHVzaFN0YXRlKSB7CiAgICAgIHB1c2hTdGF0ZShnZXRVcmwocGF0aCkpOwogICAgfSBlbHNlIHsKICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBwYXRoOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcmVwbGFjZUhhc2gocGF0aCkgewogICAgaWYgKHN1cHBvcnRzUHVzaFN0YXRlKSB7CiAgICAgIHJlcGxhY2VTdGF0ZShnZXRVcmwocGF0aCkpOwogICAgfSBlbHNlIHsKICAgICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2UoZ2V0VXJsKHBhdGgpKTsKICAgIH0KICB9CiAgLyogICovCgoKICB2YXIgQWJzdHJhY3RIaXN0b3J5ID0gZnVuY3Rpb24gKEhpc3RvcnkkJDEpIHsKICAgIGZ1bmN0aW9uIEFic3RyYWN0SGlzdG9yeShyb3V0ZXIsIGJhc2UpIHsKICAgICAgSGlzdG9yeSQkMS5jYWxsKHRoaXMsIHJvdXRlciwgYmFzZSk7CiAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgdGhpcy5pbmRleCA9IC0xOwogICAgfQoKICAgIGlmIChIaXN0b3J5JCQxKSBBYnN0cmFjdEhpc3RvcnkuX19wcm90b19fID0gSGlzdG9yeSQkMTsKICAgIEFic3RyYWN0SGlzdG9yeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEhpc3RvcnkkJDEgJiYgSGlzdG9yeSQkMS5wcm90b3R5cGUpOwogICAgQWJzdHJhY3RIaXN0b3J5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEFic3RyYWN0SGlzdG9yeTsKCiAgICBBYnN0cmFjdEhpc3RvcnkucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiBwdXNoKGxvY2F0aW9uLCBvbkNvbXBsZXRlLCBvbkFib3J0KSB7CiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOwogICAgICB0aGlzLnRyYW5zaXRpb25Ubyhsb2NhdGlvbiwgZnVuY3Rpb24gKHJvdXRlKSB7CiAgICAgICAgdGhpcyQxLnN0YWNrID0gdGhpcyQxLnN0YWNrLnNsaWNlKDAsIHRoaXMkMS5pbmRleCArIDEpLmNvbmNhdChyb3V0ZSk7CiAgICAgICAgdGhpcyQxLmluZGV4Kys7CiAgICAgICAgb25Db21wbGV0ZSAmJiBvbkNvbXBsZXRlKHJvdXRlKTsKICAgICAgfSwgb25BYm9ydCk7CiAgICB9OwoKICAgIEFic3RyYWN0SGlzdG9yeS5wcm90b3R5cGUucmVwbGFjZSA9IGZ1bmN0aW9uIHJlcGxhY2UobG9jYXRpb24sIG9uQ29tcGxldGUsIG9uQWJvcnQpIHsKICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7CiAgICAgIHRoaXMudHJhbnNpdGlvblRvKGxvY2F0aW9uLCBmdW5jdGlvbiAocm91dGUpIHsKICAgICAgICB0aGlzJDEuc3RhY2sgPSB0aGlzJDEuc3RhY2suc2xpY2UoMCwgdGhpcyQxLmluZGV4KS5jb25jYXQocm91dGUpOwogICAgICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZShyb3V0ZSk7CiAgICAgIH0sIG9uQWJvcnQpOwogICAgfTsKCiAgICBBYnN0cmFjdEhpc3RvcnkucHJvdG90eXBlLmdvID0gZnVuY3Rpb24gZ28obikgewogICAgICB2YXIgdGhpcyQxID0gdGhpczsKICAgICAgdmFyIHRhcmdldEluZGV4ID0gdGhpcy5pbmRleCArIG47CgogICAgICBpZiAodGFyZ2V0SW5kZXggPCAwIHx8IHRhcmdldEluZGV4ID49IHRoaXMuc3RhY2subGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcm91dGUgPSB0aGlzLnN0YWNrW3RhcmdldEluZGV4XTsKICAgICAgdGhpcy5jb25maXJtVHJhbnNpdGlvbihyb3V0ZSwgZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMkMS5pbmRleCA9IHRhcmdldEluZGV4OwogICAgICAgIHRoaXMkMS51cGRhdGVSb3V0ZShyb3V0ZSk7CiAgICAgIH0pOwogICAgfTsKCiAgICBBYnN0cmFjdEhpc3RvcnkucHJvdG90eXBlLmdldEN1cnJlbnRMb2NhdGlvbiA9IGZ1bmN0aW9uIGdldEN1cnJlbnRMb2NhdGlvbigpIHsKICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV07CiAgICAgIHJldHVybiBjdXJyZW50ID8gY3VycmVudC5mdWxsUGF0aCA6ICcvJzsKICAgIH07CgogICAgQWJzdHJhY3RIaXN0b3J5LnByb3RvdHlwZS5lbnN1cmVVUkwgPSBmdW5jdGlvbiBlbnN1cmVVUkwoKSB7Ly8gbm9vcAogICAgfTsKCiAgICByZXR1cm4gQWJzdHJhY3RIaXN0b3J5OwogIH0oSGlzdG9yeSk7CiAgLyogICovCgoKICB2YXIgVnVlUm91dGVyID0gZnVuY3Rpb24gVnVlUm91dGVyKG9wdGlvbnMpIHsKICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIG9wdGlvbnMgPSB7fTsKICAgIHRoaXMuYXBwID0gbnVsbDsKICAgIHRoaXMuYXBwcyA9IFtdOwogICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgIHRoaXMuYmVmb3JlSG9va3MgPSBbXTsKICAgIHRoaXMucmVzb2x2ZUhvb2tzID0gW107CiAgICB0aGlzLmFmdGVySG9va3MgPSBbXTsKICAgIHRoaXMubWF0Y2hlciA9IGNyZWF0ZU1hdGNoZXIob3B0aW9ucy5yb3V0ZXMgfHwgW10sIHRoaXMpOwogICAgdmFyIG1vZGUgPSBvcHRpb25zLm1vZGUgfHwgJ2hhc2gnOwogICAgdGhpcy5mYWxsYmFjayA9IG1vZGUgPT09ICdoaXN0b3J5JyAmJiAhc3VwcG9ydHNQdXNoU3RhdGUgJiYgb3B0aW9ucy5mYWxsYmFjayAhPT0gZmFsc2U7CgogICAgaWYgKHRoaXMuZmFsbGJhY2spIHsKICAgICAgbW9kZSA9ICdoYXNoJzsKICAgIH0KCiAgICBpZiAoIWluQnJvd3NlcikgewogICAgICBtb2RlID0gJ2Fic3RyYWN0JzsKICAgIH0KCiAgICB0aGlzLm1vZGUgPSBtb2RlOwoKICAgIHN3aXRjaCAobW9kZSkgewogICAgICBjYXNlICdoaXN0b3J5JzoKICAgICAgICB0aGlzLmhpc3RvcnkgPSBuZXcgSFRNTDVIaXN0b3J5KHRoaXMsIG9wdGlvbnMuYmFzZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdoYXNoJzoKICAgICAgICB0aGlzLmhpc3RvcnkgPSBuZXcgSGFzaEhpc3RvcnkodGhpcywgb3B0aW9ucy5iYXNlLCB0aGlzLmZhbGxiYWNrKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2Fic3RyYWN0JzoKICAgICAgICB0aGlzLmhpc3RvcnkgPSBuZXcgQWJzdHJhY3RIaXN0b3J5KHRoaXMsIG9wdGlvbnMuYmFzZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIHsKICAgICAgICAgIGFzc2VydChmYWxzZSwgImludmFsaWQgbW9kZTogIiArIG1vZGUpOwogICAgICAgIH0KICAgIH0KICB9OwoKICB2YXIgcHJvdG90eXBlQWNjZXNzb3JzID0gewogICAgY3VycmVudFJvdXRlOiB7CiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfQogIH07CgogIFZ1ZVJvdXRlci5wcm90b3R5cGUubWF0Y2ggPSBmdW5jdGlvbiBtYXRjaChyYXcsIGN1cnJlbnQsIHJlZGlyZWN0ZWRGcm9tKSB7CiAgICByZXR1cm4gdGhpcy5tYXRjaGVyLm1hdGNoKHJhdywgY3VycmVudCwgcmVkaXJlY3RlZEZyb20pOwogIH07CgogIHByb3RvdHlwZUFjY2Vzc29ycy5jdXJyZW50Um91dGUuZ2V0ID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMuaGlzdG9yeSAmJiB0aGlzLmhpc3RvcnkuY3VycmVudDsKICB9OwoKICBWdWVSb3V0ZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBpbml0KGFwcAogIC8qIFZ1ZSBjb21wb25lbnQgaW5zdGFuY2UgKi8KICApIHsKICAgIHZhciB0aGlzJDEgPSB0aGlzOwogICAgImRldmVsb3BtZW50IiAhPT0gJ3Byb2R1Y3Rpb24nICYmIGFzc2VydChpbnN0YWxsLmluc3RhbGxlZCwgIm5vdCBpbnN0YWxsZWQuIE1ha2Ugc3VyZSB0byBjYWxsIGBWdWUudXNlKFZ1ZVJvdXRlcilgICIgKyAiYmVmb3JlIGNyZWF0aW5nIHJvb3QgaW5zdGFuY2UuIik7CiAgICB0aGlzLmFwcHMucHVzaChhcHApOyAvLyBtYWluIGFwcCBhbHJlYWR5IGluaXRpYWxpemVkLgoKICAgIGlmICh0aGlzLmFwcCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5hcHAgPSBhcHA7CiAgICB2YXIgaGlzdG9yeSA9IHRoaXMuaGlzdG9yeTsKCiAgICBpZiAoaGlzdG9yeSBpbnN0YW5jZW9mIEhUTUw1SGlzdG9yeSkgewogICAgICBoaXN0b3J5LnRyYW5zaXRpb25UbyhoaXN0b3J5LmdldEN1cnJlbnRMb2NhdGlvbigpKTsKICAgIH0gZWxzZSBpZiAoaGlzdG9yeSBpbnN0YW5jZW9mIEhhc2hIaXN0b3J5KSB7CiAgICAgIHZhciBzZXR1cEhhc2hMaXN0ZW5lciA9IGZ1bmN0aW9uIHNldHVwSGFzaExpc3RlbmVyKCkgewogICAgICAgIGhpc3Rvcnkuc2V0dXBMaXN0ZW5lcnMoKTsKICAgICAgfTsKCiAgICAgIGhpc3RvcnkudHJhbnNpdGlvblRvKGhpc3RvcnkuZ2V0Q3VycmVudExvY2F0aW9uKCksIHNldHVwSGFzaExpc3RlbmVyLCBzZXR1cEhhc2hMaXN0ZW5lcik7CiAgICB9CgogICAgaGlzdG9yeS5saXN0ZW4oZnVuY3Rpb24gKHJvdXRlKSB7CiAgICAgIHRoaXMkMS5hcHBzLmZvckVhY2goZnVuY3Rpb24gKGFwcCkgewogICAgICAgIGFwcC5fcm91dGUgPSByb3V0ZTsKICAgICAgfSk7CiAgICB9KTsKICB9OwoKICBWdWVSb3V0ZXIucHJvdG90eXBlLmJlZm9yZUVhY2ggPSBmdW5jdGlvbiBiZWZvcmVFYWNoKGZuKSB7CiAgICByZXR1cm4gcmVnaXN0ZXJIb29rKHRoaXMuYmVmb3JlSG9va3MsIGZuKTsKICB9OwoKICBWdWVSb3V0ZXIucHJvdG90eXBlLmJlZm9yZVJlc29sdmUgPSBmdW5jdGlvbiBiZWZvcmVSZXNvbHZlKGZuKSB7CiAgICByZXR1cm4gcmVnaXN0ZXJIb29rKHRoaXMucmVzb2x2ZUhvb2tzLCBmbik7CiAgfTsKCiAgVnVlUm91dGVyLnByb3RvdHlwZS5hZnRlckVhY2ggPSBmdW5jdGlvbiBhZnRlckVhY2goZm4pIHsKICAgIHJldHVybiByZWdpc3Rlckhvb2sodGhpcy5hZnRlckhvb2tzLCBmbik7CiAgfTsKCiAgVnVlUm91dGVyLnByb3RvdHlwZS5vblJlYWR5ID0gZnVuY3Rpb24gb25SZWFkeShjYiwgZXJyb3JDYikgewogICAgdGhpcy5oaXN0b3J5Lm9uUmVhZHkoY2IsIGVycm9yQ2IpOwogIH07CgogIFZ1ZVJvdXRlci5wcm90b3R5cGUub25FcnJvciA9IGZ1bmN0aW9uIG9uRXJyb3IoZXJyb3JDYikgewogICAgdGhpcy5oaXN0b3J5Lm9uRXJyb3IoZXJyb3JDYik7CiAgfTsKCiAgVnVlUm91dGVyLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gcHVzaChsb2NhdGlvbiwgb25Db21wbGV0ZSwgb25BYm9ydCkgewogICAgdGhpcy5oaXN0b3J5LnB1c2gobG9jYXRpb24sIG9uQ29tcGxldGUsIG9uQWJvcnQpOwogIH07CgogIFZ1ZVJvdXRlci5wcm90b3R5cGUucmVwbGFjZSA9IGZ1bmN0aW9uIHJlcGxhY2UobG9jYXRpb24sIG9uQ29tcGxldGUsIG9uQWJvcnQpIHsKICAgIHRoaXMuaGlzdG9yeS5yZXBsYWNlKGxvY2F0aW9uLCBvbkNvbXBsZXRlLCBvbkFib3J0KTsKICB9OwoKICBWdWVSb3V0ZXIucHJvdG90eXBlLmdvID0gZnVuY3Rpb24gZ28obikgewogICAgdGhpcy5oaXN0b3J5LmdvKG4pOwogIH07CgogIFZ1ZVJvdXRlci5wcm90b3R5cGUuYmFjayA9IGZ1bmN0aW9uIGJhY2soKSB7CiAgICB0aGlzLmdvKC0xKTsKICB9OwoKICBWdWVSb3V0ZXIucHJvdG90eXBlLmZvcndhcmQgPSBmdW5jdGlvbiBmb3J3YXJkKCkgewogICAgdGhpcy5nbygxKTsKICB9OwoKICBWdWVSb3V0ZXIucHJvdG90eXBlLmdldE1hdGNoZWRDb21wb25lbnRzID0gZnVuY3Rpb24gZ2V0TWF0Y2hlZENvbXBvbmVudHModG8pIHsKICAgIHZhciByb3V0ZSA9IHRvID8gdG8ubWF0Y2hlZCA/IHRvIDogdGhpcy5yZXNvbHZlKHRvKS5yb3V0ZSA6IHRoaXMuY3VycmVudFJvdXRlOwoKICAgIGlmICghcm91dGUpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQoKICAgIHJldHVybiBbXS5jb25jYXQuYXBwbHkoW10sIHJvdXRlLm1hdGNoZWQubWFwKGZ1bmN0aW9uIChtKSB7CiAgICAgIHJldHVybiBPYmplY3Qua2V5cyhtLmNvbXBvbmVudHMpLm1hcChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgcmV0dXJuIG0uY29tcG9uZW50c1trZXldOwogICAgICB9KTsKICAgIH0pKTsKICB9OwoKICBWdWVSb3V0ZXIucHJvdG90eXBlLnJlc29sdmUgPSBmdW5jdGlvbiByZXNvbHZlKHRvLCBjdXJyZW50LCBhcHBlbmQpIHsKICAgIHZhciBsb2NhdGlvbiA9IG5vcm1hbGl6ZUxvY2F0aW9uKHRvLCBjdXJyZW50IHx8IHRoaXMuaGlzdG9yeS5jdXJyZW50LCBhcHBlbmQsIHRoaXMpOwogICAgdmFyIHJvdXRlID0gdGhpcy5tYXRjaChsb2NhdGlvbiwgY3VycmVudCk7CiAgICB2YXIgZnVsbFBhdGggPSByb3V0ZS5yZWRpcmVjdGVkRnJvbSB8fCByb3V0ZS5mdWxsUGF0aDsKICAgIHZhciBiYXNlID0gdGhpcy5oaXN0b3J5LmJhc2U7CiAgICB2YXIgaHJlZiA9IGNyZWF0ZUhyZWYoYmFzZSwgZnVsbFBhdGgsIHRoaXMubW9kZSk7CiAgICByZXR1cm4gewogICAgICBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgIHJvdXRlOiByb3V0ZSwKICAgICAgaHJlZjogaHJlZiwKICAgICAgLy8gZm9yIGJhY2t3YXJkcyBjb21wYXQKICAgICAgbm9ybWFsaXplZFRvOiBsb2NhdGlvbiwKICAgICAgcmVzb2x2ZWQ6IHJvdXRlCiAgICB9OwogIH07CgogIFZ1ZVJvdXRlci5wcm90b3R5cGUuYWRkUm91dGVzID0gZnVuY3Rpb24gYWRkUm91dGVzKHJvdXRlcykgewogICAgdGhpcy5tYXRjaGVyLmFkZFJvdXRlcyhyb3V0ZXMpOwoKICAgIGlmICh0aGlzLmhpc3RvcnkuY3VycmVudCAhPT0gU1RBUlQpIHsKICAgICAgdGhpcy5oaXN0b3J5LnRyYW5zaXRpb25Ubyh0aGlzLmhpc3RvcnkuZ2V0Q3VycmVudExvY2F0aW9uKCkpOwogICAgfQogIH07CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKFZ1ZVJvdXRlci5wcm90b3R5cGUsIHByb3RvdHlwZUFjY2Vzc29ycyk7CgogIGZ1bmN0aW9uIHJlZ2lzdGVySG9vayhsaXN0LCBmbikgewogICAgbGlzdC5wdXNoKGZuKTsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBpID0gbGlzdC5pbmRleE9mKGZuKTsKCiAgICAgIGlmIChpID4gLTEpIHsKICAgICAgICBsaXN0LnNwbGljZShpLCAxKTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUhyZWYoYmFzZSwgZnVsbFBhdGgsIG1vZGUpIHsKICAgIHZhciBwYXRoID0gbW9kZSA9PT0gJ2hhc2gnID8gJyMnICsgZnVsbFBhdGggOiBmdWxsUGF0aDsKICAgIHJldHVybiBiYXNlID8gY2xlYW5QYXRoKGJhc2UgKyAnLycgKyBwYXRoKSA6IHBhdGg7CiAgfQoKICBWdWVSb3V0ZXIuaW5zdGFsbCA9IGluc3RhbGw7CiAgVnVlUm91dGVyLnZlcnNpb24gPSAnMy4wLjEnOwoKICBpZiAoaW5Ccm93c2VyICYmIHdpbmRvdy5WdWUpIHsKICAgIHdpbmRvdy5WdWUudXNlKFZ1ZVJvdXRlcik7CiAgfQoKICByZXR1cm4gVnVlUm91dGVyOwp9KTs="},{"version":3,"sources":["C:/FAKS/6 semestar/VueApp/real_vue1/src/js_util/vue-router.js"],"names":["global","factory","exports","module","define","amd","VueRouter","assert","condition","message","Error","warn","console","isError","err","Object","prototype","toString","call","indexOf","View","name","functional","props","type","String","default","render","_","ref","children","parent","data","routerView","h","$createElement","route","$route","cache","_routerViewCache","depth","inactive","_routerRoot","$vnode","_inactive","$parent","routerViewDepth","matched","component","components","registerRouteInstance","vm","val","current","instances","hook","prepatch","vnode","componentInstance","propsToPass","resolveProps","extend","attrs","key","config","params","undefined","path","to","from","encodeReserveRE","encodeReserveReplacer","c","charCodeAt","commaRE","encode","str","encodeURIComponent","replace","decode","decodeURIComponent","resolveQuery","query","extraQuery","_parseQuery","parse","parseQuery","parsedQuery","e","res","trim","split","forEach","param","parts","shift","length","join","Array","isArray","push","stringifyQuery","obj","keys","map","result","val2","filter","x","trailingSlashRE","createRoute","record","location","redirectedFrom","router","stringifyQuery$$1","options","clone","meta","hash","fullPath","getFullPath","formatMatch","freeze","value","START","unshift","_stringifyQuery","stringify","isSameRoute","a","b","isObjectEqual","aKeys","bKeys","every","aVal","bVal","isIncludedRoute","target","queryIncludes","toTypes","eventTypes","Link","required","tag","exact","Boolean","append","activeClass","exactActiveClass","event","this$1","$router","resolve","href","classes","globalActiveClass","linkActiveClass","globalExactActiveClass","linkExactActiveClass","activeClassFallback","exactActiveClassFallback","compareTarget","handler","guardEvent","on","click","class","findAnchor","$slots","isStatic","_Vue","util","aData","aAttrs","metaKey","altKey","ctrlKey","shiftKey","defaultPrevented","button","currentTarget","getAttribute","test","preventDefault","child","i","install","Vue","installed","isDef","v","registerInstance","callVal","$options","_parentVnode","mixin","beforeCreate","_router","init","defineReactive","history","destroyed","defineProperty","get","_route","strats","optionMergeStrategies","beforeRouteEnter","beforeRouteLeave","beforeRouteUpdate","created","inBrowser","window","resolvePath","relative","base","firstChar","charAt","stack","pop","segments","segment","parsePath","hashIndex","slice","queryIndex","cleanPath","isarray","arr","pathToRegexp_1","pathToRegexp","parse_1","compile_1","compile","tokensToFunction_1","tokensToFunction","tokensToRegExp_1","tokensToRegExp","PATH_REGEXP","RegExp","tokens","index","defaultDelimiter","delimiter","exec","m","escaped","offset","next","prefix","capture","group","modifier","asterisk","partial","repeat","optional","pattern","escapeGroup","escapeString","substr","encodeURIComponentPretty","encodeURI","toUpperCase","encodeAsterisk","matches","opts","pretty","token","TypeError","JSON","j","attachKeys","re","flags","sensitive","regexpToRegexp","groups","source","match","arrayToRegexp","regexp","stringToRegexp","strict","end","endsWithDelimiter","regexpCompileCache","create","fillParams","routeMsg","filler","createRouteMap","routes","oldPathList","oldPathMap","oldNameMap","pathList","pathMap","nameMap","addRouteRecord","l","splice","matchAs","pathToRegexpOptions","normalizedPath","normalizePath","caseSensitive","regex","compileRouteRegex","redirect","beforeEnter","some","childMatchAs","alias","aliases","aliasRoute","normalizeLocation","raw","_normalized","assign","rawPath","parsedPath","basePath","createMatcher","addRoutes","currentRoute","_createRoute","paramNames","record$1","matchRoute","originalRedirect","hasOwnProperty","targetRecord","resolveRecordPath","resolvedPath","aliasedPath","aliasedMatch","aliasedRecord","len","positionStore","setupScroll","replaceState","getStateKey","addEventListener","saveScrollPosition","state","setStateKey","handleScroll","isPop","app","behavior","scrollBehavior","$nextTick","position","getScrollPosition","shouldScroll","then","scrollToPosition","catch","pageXOffset","y","pageYOffset","getElementPosition","el","docEl","document","documentElement","docRect","getBoundingClientRect","elRect","left","top","isValidPosition","isNumber","normalizePosition","normalizeOffset","isObject","selector","querySelector","scrollTo","supportsPushState","ua","navigator","userAgent","Time","performance","now","Date","_key","genKey","toFixed","pushState","url","runQueue","queue","fn","cb","step","resolveAsyncComponents","hasAsync","pending","error","flatMapComponents","def","cid","once","resolvedDef","isESModule","resolved","reject","reason","msg","comp","flatten","concat","apply","hasSymbol","Symbol","toStringTag","__esModule","called","args","arguments","History","normalizeBase","ready","readyCbs","readyErrorCbs","errorCbs","listen","onReady","errorCb","onError","transitionTo","onComplete","onAbort","confirmTransition","updateRoute","ensureURL","abort","resolveQueue","updated","deactivated","activated","extractLeaveGuards","beforeHooks","extractUpdateHooks","iterator","postEnterCbs","isValid","enterGuards","extractEnterGuards","resolveHooks","prev","afterHooks","baseEl","max","Math","extractGuards","records","bind","reverse","guards","instance","guard","extractGuard","bindGuard","boundRouteGuard","cbs","bindEnterGuard","routeEnterGuard","poll","setTimeout","HTML5History","History$$1","expectScroll","initLocation","getLocation","__proto__","constructor","go","n","fromRoute","getCurrentLocation","pathname","search","HashHistory","fallback","checkFallback","ensureSlash","setupListeners","supportsScroll","getHash","replaceHash","pushHash","getUrl","AbstractHistory","targetIndex","apps","matcher","mode","prototypeAccessors","configurable","setupHashListener","beforeEach","registerHook","beforeResolve","afterEach","back","forward","getMatchedComponents","createHref","normalizedTo","defineProperties","list","version","use"],"mappings":"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","sourcesContent":["/**\r\n  * vue-router v3.0.1\r\n  * (c) 2017 Evan You\r\n  * @license MIT\r\n  */\r\n(function (global, factory) {\r\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\r\n\ttypeof define === 'function' && define.amd ? define(factory) :\r\n\t(global.VueRouter = factory());\r\n}(this, (function () { 'use strict';\r\n\r\n/*  */\r\n\r\nfunction assert (condition, message) {\r\n  if (!condition) {\r\n    throw new Error((\"[vue-router] \" + message))\r\n  }\r\n}\r\n\r\nfunction warn (condition, message) {\r\n  if (\"development\" !== 'production' && !condition) {\r\n    typeof console !== 'undefined' && console.warn((\"[vue-router] \" + message));\r\n  }\r\n}\r\n\r\nfunction isError (err) {\r\n  return Object.prototype.toString.call(err).indexOf('Error') > -1\r\n}\r\n\r\nvar View = {\r\n  name: 'router-view',\r\n  functional: true,\r\n  props: {\r\n    name: {\r\n      type: String,\r\n      default: 'default'\r\n    }\r\n  },\r\n  render: function render (_, ref) {\r\n    var props = ref.props;\r\n    var children = ref.children;\r\n    var parent = ref.parent;\r\n    var data = ref.data;\r\n\r\n    data.routerView = true;\r\n\r\n    // directly use parent context's createElement() function\r\n    // so that components rendered by router-view can resolve named slots\r\n    var h = parent.$createElement;\r\n    var name = props.name;\r\n    var route = parent.$route;\r\n    var cache = parent._routerViewCache || (parent._routerViewCache = {});\r\n\r\n    // determine current view depth, also check to see if the tree\r\n    // has been toggled inactive but kept-alive.\r\n    var depth = 0;\r\n    var inactive = false;\r\n    while (parent && parent._routerRoot !== parent) {\r\n      if (parent.$vnode && parent.$vnode.data.routerView) {\r\n        depth++;\r\n      }\r\n      if (parent._inactive) {\r\n        inactive = true;\r\n      }\r\n      parent = parent.$parent;\r\n    }\r\n    data.routerViewDepth = depth;\r\n\r\n    // render previous view if the tree is inactive and kept-alive\r\n    if (inactive) {\r\n      return h(cache[name], data, children)\r\n    }\r\n\r\n    var matched = route.matched[depth];\r\n    // render empty node if no matched route\r\n    if (!matched) {\r\n      cache[name] = null;\r\n      return h()\r\n    }\r\n\r\n    var component = cache[name] = matched.components[name];\r\n\r\n    // attach instance registration hook\r\n    // this will be called in the instance's injected lifecycle hooks\r\n    data.registerRouteInstance = function (vm, val) {\r\n      // val could be undefined for unregistration\r\n      var current = matched.instances[name];\r\n      if (\r\n        (val && current !== vm) ||\r\n        (!val && current === vm)\r\n      ) {\r\n        matched.instances[name] = val;\r\n      }\r\n    }\r\n\r\n    // also register instance in prepatch hook\r\n    // in case the same component instance is reused across different routes\r\n    ;(data.hook || (data.hook = {})).prepatch = function (_, vnode) {\r\n      matched.instances[name] = vnode.componentInstance;\r\n    };\r\n\r\n    // resolve props\r\n    var propsToPass = data.props = resolveProps(route, matched.props && matched.props[name]);\r\n    if (propsToPass) {\r\n      // clone to prevent mutation\r\n      propsToPass = data.props = extend({}, propsToPass);\r\n      // pass non-declared props as attrs\r\n      var attrs = data.attrs = data.attrs || {};\r\n      for (var key in propsToPass) {\r\n        if (!component.props || !(key in component.props)) {\r\n          attrs[key] = propsToPass[key];\r\n          delete propsToPass[key];\r\n        }\r\n      }\r\n    }\r\n\r\n    return h(component, data, children)\r\n  }\r\n};\r\n\r\nfunction resolveProps (route, config) {\r\n  switch (typeof config) {\r\n    case 'undefined':\r\n      return\r\n    case 'object':\r\n      return config\r\n    case 'function':\r\n      return config(route)\r\n    case 'boolean':\r\n      return config ? route.params : undefined\r\n    default:\r\n      {\r\n        warn(\r\n          false,\r\n          \"props in \\\"\" + (route.path) + \"\\\" is a \" + (typeof config) + \", \" +\r\n          \"expecting an object, function or boolean.\"\r\n        );\r\n      }\r\n  }\r\n}\r\n\r\nfunction extend (to, from) {\r\n  for (var key in from) {\r\n    to[key] = from[key];\r\n  }\r\n  return to\r\n}\r\n\r\n/*  */\r\n\r\nvar encodeReserveRE = /[!'()*]/g;\r\nvar encodeReserveReplacer = function (c) { return '%' + c.charCodeAt(0).toString(16); };\r\nvar commaRE = /%2C/g;\r\n\r\n// fixed encodeURIComponent which is more conformant to RFC3986:\r\n// - escapes [!'()*]\r\n// - preserve commas\r\nvar encode = function (str) { return encodeURIComponent(str)\r\n  .replace(encodeReserveRE, encodeReserveReplacer)\r\n  .replace(commaRE, ','); };\r\n\r\nvar decode = decodeURIComponent;\r\n\r\nfunction resolveQuery (\r\n  query,\r\n  extraQuery,\r\n  _parseQuery\r\n) {\r\n  if ( extraQuery === void 0 ) extraQuery = {};\r\n\r\n  var parse = _parseQuery || parseQuery;\r\n  var parsedQuery;\r\n  try {\r\n    parsedQuery = parse(query || '');\r\n  } catch (e) {\r\n    \"development\" !== 'production' && warn(false, e.message);\r\n    parsedQuery = {};\r\n  }\r\n  for (var key in extraQuery) {\r\n    parsedQuery[key] = extraQuery[key];\r\n  }\r\n  return parsedQuery\r\n}\r\n\r\nfunction parseQuery (query) {\r\n  var res = {};\r\n\r\n  query = query.trim().replace(/^(\\?|#|&)/, '');\r\n\r\n  if (!query) {\r\n    return res\r\n  }\r\n\r\n  query.split('&').forEach(function (param) {\r\n    var parts = param.replace(/\\+/g, ' ').split('=');\r\n    var key = decode(parts.shift());\r\n    var val = parts.length > 0\r\n      ? decode(parts.join('='))\r\n      : null;\r\n\r\n    if (res[key] === undefined) {\r\n      res[key] = val;\r\n    } else if (Array.isArray(res[key])) {\r\n      res[key].push(val);\r\n    } else {\r\n      res[key] = [res[key], val];\r\n    }\r\n  });\r\n\r\n  return res\r\n}\r\n\r\nfunction stringifyQuery (obj) {\r\n  var res = obj ? Object.keys(obj).map(function (key) {\r\n    var val = obj[key];\r\n\r\n    if (val === undefined) {\r\n      return ''\r\n    }\r\n\r\n    if (val === null) {\r\n      return encode(key)\r\n    }\r\n\r\n    if (Array.isArray(val)) {\r\n      var result = [];\r\n      val.forEach(function (val2) {\r\n        if (val2 === undefined) {\r\n          return\r\n        }\r\n        if (val2 === null) {\r\n          result.push(encode(key));\r\n        } else {\r\n          result.push(encode(key) + '=' + encode(val2));\r\n        }\r\n      });\r\n      return result.join('&')\r\n    }\r\n\r\n    return encode(key) + '=' + encode(val)\r\n  }).filter(function (x) { return x.length > 0; }).join('&') : null;\r\n  return res ? (\"?\" + res) : ''\r\n}\r\n\r\n/*  */\r\n\r\n\r\nvar trailingSlashRE = /\\/?$/;\r\n\r\nfunction createRoute (\r\n  record,\r\n  location,\r\n  redirectedFrom,\r\n  router\r\n) {\r\n  var stringifyQuery$$1 = router && router.options.stringifyQuery;\r\n\r\n  var query = location.query || {};\r\n  try {\r\n    query = clone(query);\r\n  } catch (e) {}\r\n\r\n  var route = {\r\n    name: location.name || (record && record.name),\r\n    meta: (record && record.meta) || {},\r\n    path: location.path || '/',\r\n    hash: location.hash || '',\r\n    query: query,\r\n    params: location.params || {},\r\n    fullPath: getFullPath(location, stringifyQuery$$1),\r\n    matched: record ? formatMatch(record) : []\r\n  };\r\n  if (redirectedFrom) {\r\n    route.redirectedFrom = getFullPath(redirectedFrom, stringifyQuery$$1);\r\n  }\r\n  return Object.freeze(route)\r\n}\r\n\r\nfunction clone (value) {\r\n  if (Array.isArray(value)) {\r\n    return value.map(clone)\r\n  } else if (value && typeof value === 'object') {\r\n    var res = {};\r\n    for (var key in value) {\r\n      res[key] = clone(value[key]);\r\n    }\r\n    return res\r\n  } else {\r\n    return value\r\n  }\r\n}\r\n\r\n// the starting route that represents the initial state\r\nvar START = createRoute(null, {\r\n  path: '/'\r\n});\r\n\r\nfunction formatMatch (record) {\r\n  var res = [];\r\n  while (record) {\r\n    res.unshift(record);\r\n    record = record.parent;\r\n  }\r\n  return res\r\n}\r\n\r\nfunction getFullPath (\r\n  ref,\r\n  _stringifyQuery\r\n) {\r\n  var path = ref.path;\r\n  var query = ref.query; if ( query === void 0 ) query = {};\r\n  var hash = ref.hash; if ( hash === void 0 ) hash = '';\r\n\r\n  var stringify = _stringifyQuery || stringifyQuery;\r\n  return (path || '/') + stringify(query) + hash\r\n}\r\n\r\nfunction isSameRoute (a, b) {\r\n  if (b === START) {\r\n    return a === b\r\n  } else if (!b) {\r\n    return false\r\n  } else if (a.path && b.path) {\r\n    return (\r\n      a.path.replace(trailingSlashRE, '') === b.path.replace(trailingSlashRE, '') &&\r\n      a.hash === b.hash &&\r\n      isObjectEqual(a.query, b.query)\r\n    )\r\n  } else if (a.name && b.name) {\r\n    return (\r\n      a.name === b.name &&\r\n      a.hash === b.hash &&\r\n      isObjectEqual(a.query, b.query) &&\r\n      isObjectEqual(a.params, b.params)\r\n    )\r\n  } else {\r\n    return false\r\n  }\r\n}\r\n\r\nfunction isObjectEqual (a, b) {\r\n  if ( a === void 0 ) a = {};\r\n  if ( b === void 0 ) b = {};\r\n\r\n  // handle null value #1566\r\n  if (!a || !b) { return a === b }\r\n  var aKeys = Object.keys(a);\r\n  var bKeys = Object.keys(b);\r\n  if (aKeys.length !== bKeys.length) {\r\n    return false\r\n  }\r\n  return aKeys.every(function (key) {\r\n    var aVal = a[key];\r\n    var bVal = b[key];\r\n    // check nested equality\r\n    if (typeof aVal === 'object' && typeof bVal === 'object') {\r\n      return isObjectEqual(aVal, bVal)\r\n    }\r\n    return String(aVal) === String(bVal)\r\n  })\r\n}\r\n\r\nfunction isIncludedRoute (current, target) {\r\n  return (\r\n    current.path.replace(trailingSlashRE, '/').indexOf(\r\n      target.path.replace(trailingSlashRE, '/')\r\n    ) === 0 &&\r\n    (!target.hash || current.hash === target.hash) &&\r\n    queryIncludes(current.query, target.query)\r\n  )\r\n}\r\n\r\nfunction queryIncludes (current, target) {\r\n  for (var key in target) {\r\n    if (!(key in current)) {\r\n      return false\r\n    }\r\n  }\r\n  return true\r\n}\r\n\r\n/*  */\r\n\r\n// work around weird flow bug\r\nvar toTypes = [String, Object];\r\nvar eventTypes = [String, Array];\r\n\r\nvar Link = {\r\n  name: 'router-link',\r\n  props: {\r\n    to: {\r\n      type: toTypes,\r\n      required: true\r\n    },\r\n    tag: {\r\n      type: String,\r\n      default: 'a'\r\n    },\r\n    exact: Boolean,\r\n    append: Boolean,\r\n    replace: Boolean,\r\n    activeClass: String,\r\n    exactActiveClass: String,\r\n    event: {\r\n      type: eventTypes,\r\n      default: 'click'\r\n    }\r\n  },\r\n  render: function render (h) {\r\n    var this$1 = this;\r\n\r\n    var router = this.$router;\r\n    var current = this.$route;\r\n    var ref = router.resolve(this.to, current, this.append);\r\n    var location = ref.location;\r\n    var route = ref.route;\r\n    var href = ref.href;\r\n\r\n    var classes = {};\r\n    var globalActiveClass = router.options.linkActiveClass;\r\n    var globalExactActiveClass = router.options.linkExactActiveClass;\r\n    // Support global empty active class\r\n    var activeClassFallback = globalActiveClass == null\r\n            ? 'router-link-active'\r\n            : globalActiveClass;\r\n    var exactActiveClassFallback = globalExactActiveClass == null\r\n            ? 'router-link-exact-active'\r\n            : globalExactActiveClass;\r\n    var activeClass = this.activeClass == null\r\n            ? activeClassFallback\r\n            : this.activeClass;\r\n    var exactActiveClass = this.exactActiveClass == null\r\n            ? exactActiveClassFallback\r\n            : this.exactActiveClass;\r\n    var compareTarget = location.path\r\n      ? createRoute(null, location, null, router)\r\n      : route;\r\n\r\n    classes[exactActiveClass] = isSameRoute(current, compareTarget);\r\n    classes[activeClass] = this.exact\r\n      ? classes[exactActiveClass]\r\n      : isIncludedRoute(current, compareTarget);\r\n\r\n    var handler = function (e) {\r\n      if (guardEvent(e)) {\r\n        if (this$1.replace) {\r\n          router.replace(location);\r\n        } else {\r\n          router.push(location);\r\n        }\r\n      }\r\n    };\r\n\r\n    var on = { click: guardEvent };\r\n    if (Array.isArray(this.event)) {\r\n      this.event.forEach(function (e) { on[e] = handler; });\r\n    } else {\r\n      on[this.event] = handler;\r\n    }\r\n\r\n    var data = {\r\n      class: classes\r\n    };\r\n\r\n    if (this.tag === 'a') {\r\n      data.on = on;\r\n      data.attrs = { href: href };\r\n    } else {\r\n      // find the first <a> child and apply listener and href\r\n      var a = findAnchor(this.$slots.default);\r\n      if (a) {\r\n        // in case the <a> is a static node\r\n        a.isStatic = false;\r\n        var extend = _Vue.util.extend;\r\n        var aData = a.data = extend({}, a.data);\r\n        aData.on = on;\r\n        var aAttrs = a.data.attrs = extend({}, a.data.attrs);\r\n        aAttrs.href = href;\r\n      } else {\r\n        // doesn't have <a> child, apply listener to self\r\n        data.on = on;\r\n      }\r\n    }\r\n\r\n    return h(this.tag, data, this.$slots.default)\r\n  }\r\n};\r\n\r\nfunction guardEvent (e) {\r\n  // don't redirect with control keys\r\n  if (e.metaKey || e.altKey || e.ctrlKey || e.shiftKey) { return }\r\n  // don't redirect when preventDefault called\r\n  if (e.defaultPrevented) { return }\r\n  // don't redirect on right click\r\n  if (e.button !== undefined && e.button !== 0) { return }\r\n  // don't redirect if `target=\"_blank\"`\r\n  if (e.currentTarget && e.currentTarget.getAttribute) {\r\n    var target = e.currentTarget.getAttribute('target');\r\n    if (/\\b_blank\\b/i.test(target)) { return }\r\n  }\r\n  // this may be a Weex event which doesn't have this method\r\n  if (e.preventDefault) {\r\n    e.preventDefault();\r\n  }\r\n  return true\r\n}\r\n\r\nfunction findAnchor (children) {\r\n  if (children) {\r\n    var child;\r\n    for (var i = 0; i < children.length; i++) {\r\n      child = children[i];\r\n      if (child.tag === 'a') {\r\n        return child\r\n      }\r\n      if (child.children && (child = findAnchor(child.children))) {\r\n        return child\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nvar _Vue;\r\n\r\nfunction install (Vue) {\r\n  if (install.installed && _Vue === Vue) { return }\r\n  install.installed = true;\r\n\r\n  _Vue = Vue;\r\n\r\n  var isDef = function (v) { return v !== undefined; };\r\n\r\n  var registerInstance = function (vm, callVal) {\r\n    var i = vm.$options._parentVnode;\r\n    if (isDef(i) && isDef(i = i.data) && isDef(i = i.registerRouteInstance)) {\r\n      i(vm, callVal);\r\n    }\r\n  };\r\n\r\n  Vue.mixin({\r\n    beforeCreate: function beforeCreate () {\r\n      if (isDef(this.$options.router)) {\r\n        this._routerRoot = this;\r\n        this._router = this.$options.router;\r\n        this._router.init(this);\r\n        Vue.util.defineReactive(this, '_route', this._router.history.current);\r\n      } else {\r\n        this._routerRoot = (this.$parent && this.$parent._routerRoot) || this;\r\n      }\r\n      registerInstance(this, this);\r\n    },\r\n    destroyed: function destroyed () {\r\n      registerInstance(this);\r\n    }\r\n  });\r\n\r\n  Object.defineProperty(Vue.prototype, '$router', {\r\n    get: function get () { return this._routerRoot._router }\r\n  });\r\n\r\n  Object.defineProperty(Vue.prototype, '$route', {\r\n    get: function get () { return this._routerRoot._route }\r\n  });\r\n\r\n  Vue.component('router-view', View);\r\n  Vue.component('router-link', Link);\r\n\r\n  var strats = Vue.config.optionMergeStrategies;\r\n  // use the same hook merging strategy for route hooks\r\n  strats.beforeRouteEnter = strats.beforeRouteLeave = strats.beforeRouteUpdate = strats.created;\r\n}\r\n\r\n/*  */\r\n\r\nvar inBrowser = typeof window !== 'undefined';\r\n\r\n/*  */\r\n\r\nfunction resolvePath (\r\n  relative,\r\n  base,\r\n  append\r\n) {\r\n  var firstChar = relative.charAt(0);\r\n  if (firstChar === '/') {\r\n    return relative\r\n  }\r\n\r\n  if (firstChar === '?' || firstChar === '#') {\r\n    return base + relative\r\n  }\r\n\r\n  var stack = base.split('/');\r\n\r\n  // remove trailing segment if:\r\n  // - not appending\r\n  // - appending to trailing slash (last segment is empty)\r\n  if (!append || !stack[stack.length - 1]) {\r\n    stack.pop();\r\n  }\r\n\r\n  // resolve relative path\r\n  var segments = relative.replace(/^\\//, '').split('/');\r\n  for (var i = 0; i < segments.length; i++) {\r\n    var segment = segments[i];\r\n    if (segment === '..') {\r\n      stack.pop();\r\n    } else if (segment !== '.') {\r\n      stack.push(segment);\r\n    }\r\n  }\r\n\r\n  // ensure leading slash\r\n  if (stack[0] !== '') {\r\n    stack.unshift('');\r\n  }\r\n\r\n  return stack.join('/')\r\n}\r\n\r\nfunction parsePath (path) {\r\n  var hash = '';\r\n  var query = '';\r\n\r\n  var hashIndex = path.indexOf('#');\r\n  if (hashIndex >= 0) {\r\n    hash = path.slice(hashIndex);\r\n    path = path.slice(0, hashIndex);\r\n  }\r\n\r\n  var queryIndex = path.indexOf('?');\r\n  if (queryIndex >= 0) {\r\n    query = path.slice(queryIndex + 1);\r\n    path = path.slice(0, queryIndex);\r\n  }\r\n\r\n  return {\r\n    path: path,\r\n    query: query,\r\n    hash: hash\r\n  }\r\n}\r\n\r\nfunction cleanPath (path) {\r\n  return path.replace(/\\/\\//g, '/')\r\n}\r\n\r\nvar isarray = Array.isArray || function (arr) {\r\n  return Object.prototype.toString.call(arr) == '[object Array]';\r\n};\r\n\r\n/**\r\n * Expose `pathToRegexp`.\r\n */\r\nvar pathToRegexp_1 = pathToRegexp;\r\nvar parse_1 = parse;\r\nvar compile_1 = compile;\r\nvar tokensToFunction_1 = tokensToFunction;\r\nvar tokensToRegExp_1 = tokensToRegExp;\r\n\r\n/**\r\n * The main path matching regexp utility.\r\n *\r\n * @type {RegExp}\r\n */\r\nvar PATH_REGEXP = new RegExp([\r\n  // Match escaped characters that would otherwise appear in future matches.\r\n  // This allows the user to escape special characters that won't transform.\r\n  '(\\\\\\\\.)',\r\n  // Match Express-style parameters and un-named parameters with a prefix\r\n  // and optional suffixes. Matches appear as:\r\n  //\r\n  // \"/:test(\\\\d+)?\" => [\"/\", \"test\", \"\\d+\", undefined, \"?\", undefined]\r\n  // \"/route(\\\\d+)\"  => [undefined, undefined, undefined, \"\\d+\", undefined, undefined]\r\n  // \"/*\"            => [\"/\", undefined, undefined, undefined, undefined, \"*\"]\r\n  '([\\\\/.])?(?:(?:\\\\:(\\\\w+)(?:\\\\(((?:\\\\\\\\.|[^\\\\\\\\()])+)\\\\))?|\\\\(((?:\\\\\\\\.|[^\\\\\\\\()])+)\\\\))([+*?])?|(\\\\*))'\r\n].join('|'), 'g');\r\n\r\n/**\r\n * Parse a string for the raw tokens.\r\n *\r\n * @param  {string}  str\r\n * @param  {Object=} options\r\n * @return {!Array}\r\n */\r\nfunction parse (str, options) {\r\n  var tokens = [];\r\n  var key = 0;\r\n  var index = 0;\r\n  var path = '';\r\n  var defaultDelimiter = options && options.delimiter || '/';\r\n  var res;\r\n\r\n  while ((res = PATH_REGEXP.exec(str)) != null) {\r\n    var m = res[0];\r\n    var escaped = res[1];\r\n    var offset = res.index;\r\n    path += str.slice(index, offset);\r\n    index = offset + m.length;\r\n\r\n    // Ignore already escaped sequences.\r\n    if (escaped) {\r\n      path += escaped[1];\r\n      continue\r\n    }\r\n\r\n    var next = str[index];\r\n    var prefix = res[2];\r\n    var name = res[3];\r\n    var capture = res[4];\r\n    var group = res[5];\r\n    var modifier = res[6];\r\n    var asterisk = res[7];\r\n\r\n    // Push the current path onto the tokens.\r\n    if (path) {\r\n      tokens.push(path);\r\n      path = '';\r\n    }\r\n\r\n    var partial = prefix != null && next != null && next !== prefix;\r\n    var repeat = modifier === '+' || modifier === '*';\r\n    var optional = modifier === '?' || modifier === '*';\r\n    var delimiter = res[2] || defaultDelimiter;\r\n    var pattern = capture || group;\r\n\r\n    tokens.push({\r\n      name: name || key++,\r\n      prefix: prefix || '',\r\n      delimiter: delimiter,\r\n      optional: optional,\r\n      repeat: repeat,\r\n      partial: partial,\r\n      asterisk: !!asterisk,\r\n      pattern: pattern ? escapeGroup(pattern) : (asterisk ? '.*' : '[^' + escapeString(delimiter) + ']+?')\r\n    });\r\n  }\r\n\r\n  // Match any characters still remaining.\r\n  if (index < str.length) {\r\n    path += str.substr(index);\r\n  }\r\n\r\n  // If the path exists, push it onto the end.\r\n  if (path) {\r\n    tokens.push(path);\r\n  }\r\n\r\n  return tokens\r\n}\r\n\r\n/**\r\n * Compile a string to a template function for the path.\r\n *\r\n * @param  {string}             str\r\n * @param  {Object=}            options\r\n * @return {!function(Object=, Object=)}\r\n */\r\nfunction compile (str, options) {\r\n  return tokensToFunction(parse(str, options))\r\n}\r\n\r\n/**\r\n * Prettier encoding of URI path segments.\r\n *\r\n * @param  {string}\r\n * @return {string}\r\n */\r\nfunction encodeURIComponentPretty (str) {\r\n  return encodeURI(str).replace(/[\\/?#]/g, function (c) {\r\n    return '%' + c.charCodeAt(0).toString(16).toUpperCase()\r\n  })\r\n}\r\n\r\n/**\r\n * Encode the asterisk parameter. Similar to `pretty`, but allows slashes.\r\n *\r\n * @param  {string}\r\n * @return {string}\r\n */\r\nfunction encodeAsterisk (str) {\r\n  return encodeURI(str).replace(/[?#]/g, function (c) {\r\n    return '%' + c.charCodeAt(0).toString(16).toUpperCase()\r\n  })\r\n}\r\n\r\n/**\r\n * Expose a method for transforming tokens into the path function.\r\n */\r\nfunction tokensToFunction (tokens) {\r\n  // Compile all the tokens into regexps.\r\n  var matches = new Array(tokens.length);\r\n\r\n  // Compile all the patterns before compilation.\r\n  for (var i = 0; i < tokens.length; i++) {\r\n    if (typeof tokens[i] === 'object') {\r\n      matches[i] = new RegExp('^(?:' + tokens[i].pattern + ')$');\r\n    }\r\n  }\r\n\r\n  return function (obj, opts) {\r\n    var path = '';\r\n    var data = obj || {};\r\n    var options = opts || {};\r\n    var encode = options.pretty ? encodeURIComponentPretty : encodeURIComponent;\r\n\r\n    for (var i = 0; i < tokens.length; i++) {\r\n      var token = tokens[i];\r\n\r\n      if (typeof token === 'string') {\r\n        path += token;\r\n\r\n        continue\r\n      }\r\n\r\n      var value = data[token.name];\r\n      var segment;\r\n\r\n      if (value == null) {\r\n        if (token.optional) {\r\n          // Prepend partial segment prefixes.\r\n          if (token.partial) {\r\n            path += token.prefix;\r\n          }\r\n\r\n          continue\r\n        } else {\r\n          throw new TypeError('Expected \"' + token.name + '\" to be defined')\r\n        }\r\n      }\r\n\r\n      if (isarray(value)) {\r\n        if (!token.repeat) {\r\n          throw new TypeError('Expected \"' + token.name + '\" to not repeat, but received `' + JSON.stringify(value) + '`')\r\n        }\r\n\r\n        if (value.length === 0) {\r\n          if (token.optional) {\r\n            continue\r\n          } else {\r\n            throw new TypeError('Expected \"' + token.name + '\" to not be empty')\r\n          }\r\n        }\r\n\r\n        for (var j = 0; j < value.length; j++) {\r\n          segment = encode(value[j]);\r\n\r\n          if (!matches[i].test(segment)) {\r\n            throw new TypeError('Expected all \"' + token.name + '\" to match \"' + token.pattern + '\", but received `' + JSON.stringify(segment) + '`')\r\n          }\r\n\r\n          path += (j === 0 ? token.prefix : token.delimiter) + segment;\r\n        }\r\n\r\n        continue\r\n      }\r\n\r\n      segment = token.asterisk ? encodeAsterisk(value) : encode(value);\r\n\r\n      if (!matches[i].test(segment)) {\r\n        throw new TypeError('Expected \"' + token.name + '\" to match \"' + token.pattern + '\", but received \"' + segment + '\"')\r\n      }\r\n\r\n      path += token.prefix + segment;\r\n    }\r\n\r\n    return path\r\n  }\r\n}\r\n\r\n/**\r\n * Escape a regular expression string.\r\n *\r\n * @param  {string} str\r\n * @return {string}\r\n */\r\nfunction escapeString (str) {\r\n  return str.replace(/([.+*?=^!:${}()[\\]|\\/\\\\])/g, '\\\\$1')\r\n}\r\n\r\n/**\r\n * Escape the capturing group by escaping special characters and meaning.\r\n *\r\n * @param  {string} group\r\n * @return {string}\r\n */\r\nfunction escapeGroup (group) {\r\n  return group.replace(/([=!:$\\/()])/g, '\\\\$1')\r\n}\r\n\r\n/**\r\n * Attach the keys as a property of the regexp.\r\n *\r\n * @param  {!RegExp} re\r\n * @param  {Array}   keys\r\n * @return {!RegExp}\r\n */\r\nfunction attachKeys (re, keys) {\r\n  re.keys = keys;\r\n  return re\r\n}\r\n\r\n/**\r\n * Get the flags for a regexp from the options.\r\n *\r\n * @param  {Object} options\r\n * @return {string}\r\n */\r\nfunction flags (options) {\r\n  return options.sensitive ? '' : 'i'\r\n}\r\n\r\n/**\r\n * Pull out keys from a regexp.\r\n *\r\n * @param  {!RegExp} path\r\n * @param  {!Array}  keys\r\n * @return {!RegExp}\r\n */\r\nfunction regexpToRegexp (path, keys) {\r\n  // Use a negative lookahead to match only capturing groups.\r\n  var groups = path.source.match(/\\((?!\\?)/g);\r\n\r\n  if (groups) {\r\n    for (var i = 0; i < groups.length; i++) {\r\n      keys.push({\r\n        name: i,\r\n        prefix: null,\r\n        delimiter: null,\r\n        optional: false,\r\n        repeat: false,\r\n        partial: false,\r\n        asterisk: false,\r\n        pattern: null\r\n      });\r\n    }\r\n  }\r\n\r\n  return attachKeys(path, keys)\r\n}\r\n\r\n/**\r\n * Transform an array into a regexp.\r\n *\r\n * @param  {!Array}  path\r\n * @param  {Array}   keys\r\n * @param  {!Object} options\r\n * @return {!RegExp}\r\n */\r\nfunction arrayToRegexp (path, keys, options) {\r\n  var parts = [];\r\n\r\n  for (var i = 0; i < path.length; i++) {\r\n    parts.push(pathToRegexp(path[i], keys, options).source);\r\n  }\r\n\r\n  var regexp = new RegExp('(?:' + parts.join('|') + ')', flags(options));\r\n\r\n  return attachKeys(regexp, keys)\r\n}\r\n\r\n/**\r\n * Create a path regexp from string input.\r\n *\r\n * @param  {string}  path\r\n * @param  {!Array}  keys\r\n * @param  {!Object} options\r\n * @return {!RegExp}\r\n */\r\nfunction stringToRegexp (path, keys, options) {\r\n  return tokensToRegExp(parse(path, options), keys, options)\r\n}\r\n\r\n/**\r\n * Expose a function for taking tokens and returning a RegExp.\r\n *\r\n * @param  {!Array}          tokens\r\n * @param  {(Array|Object)=} keys\r\n * @param  {Object=}         options\r\n * @return {!RegExp}\r\n */\r\nfunction tokensToRegExp (tokens, keys, options) {\r\n  if (!isarray(keys)) {\r\n    options = /** @type {!Object} */ (keys || options);\r\n    keys = [];\r\n  }\r\n\r\n  options = options || {};\r\n\r\n  var strict = options.strict;\r\n  var end = options.end !== false;\r\n  var route = '';\r\n\r\n  // Iterate over the tokens and create our regexp string.\r\n  for (var i = 0; i < tokens.length; i++) {\r\n    var token = tokens[i];\r\n\r\n    if (typeof token === 'string') {\r\n      route += escapeString(token);\r\n    } else {\r\n      var prefix = escapeString(token.prefix);\r\n      var capture = '(?:' + token.pattern + ')';\r\n\r\n      keys.push(token);\r\n\r\n      if (token.repeat) {\r\n        capture += '(?:' + prefix + capture + ')*';\r\n      }\r\n\r\n      if (token.optional) {\r\n        if (!token.partial) {\r\n          capture = '(?:' + prefix + '(' + capture + '))?';\r\n        } else {\r\n          capture = prefix + '(' + capture + ')?';\r\n        }\r\n      } else {\r\n        capture = prefix + '(' + capture + ')';\r\n      }\r\n\r\n      route += capture;\r\n    }\r\n  }\r\n\r\n  var delimiter = escapeString(options.delimiter || '/');\r\n  var endsWithDelimiter = route.slice(-delimiter.length) === delimiter;\r\n\r\n  // In non-strict mode we allow a slash at the end of match. If the path to\r\n  // match already ends with a slash, we remove it for consistency. The slash\r\n  // is valid at the end of a path match, not in the middle. This is important\r\n  // in non-ending mode, where \"/test/\" shouldn't match \"/test//route\".\r\n  if (!strict) {\r\n    route = (endsWithDelimiter ? route.slice(0, -delimiter.length) : route) + '(?:' + delimiter + '(?=$))?';\r\n  }\r\n\r\n  if (end) {\r\n    route += '$';\r\n  } else {\r\n    // In non-ending mode, we need the capturing groups to match as much as\r\n    // possible by using a positive lookahead to the end or next path segment.\r\n    route += strict && endsWithDelimiter ? '' : '(?=' + delimiter + '|$)';\r\n  }\r\n\r\n  return attachKeys(new RegExp('^' + route, flags(options)), keys)\r\n}\r\n\r\n/**\r\n * Normalize the given path string, returning a regular expression.\r\n *\r\n * An empty array can be passed in for the keys, which will hold the\r\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\r\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\r\n *\r\n * @param  {(string|RegExp|Array)} path\r\n * @param  {(Array|Object)=}       keys\r\n * @param  {Object=}               options\r\n * @return {!RegExp}\r\n */\r\nfunction pathToRegexp (path, keys, options) {\r\n  if (!isarray(keys)) {\r\n    options = /** @type {!Object} */ (keys || options);\r\n    keys = [];\r\n  }\r\n\r\n  options = options || {};\r\n\r\n  if (path instanceof RegExp) {\r\n    return regexpToRegexp(path, /** @type {!Array} */ (keys))\r\n  }\r\n\r\n  if (isarray(path)) {\r\n    return arrayToRegexp(/** @type {!Array} */ (path), /** @type {!Array} */ (keys), options)\r\n  }\r\n\r\n  return stringToRegexp(/** @type {string} */ (path), /** @type {!Array} */ (keys), options)\r\n}\r\n\r\npathToRegexp_1.parse = parse_1;\r\npathToRegexp_1.compile = compile_1;\r\npathToRegexp_1.tokensToFunction = tokensToFunction_1;\r\npathToRegexp_1.tokensToRegExp = tokensToRegExp_1;\r\n\r\n/*  */\r\n\r\n// $flow-disable-line\r\nvar regexpCompileCache = Object.create(null);\r\n\r\nfunction fillParams (\r\n  path,\r\n  params,\r\n  routeMsg\r\n) {\r\n  try {\r\n    var filler =\r\n      regexpCompileCache[path] ||\r\n      (regexpCompileCache[path] = pathToRegexp_1.compile(path));\r\n    return filler(params || {}, { pretty: true })\r\n  } catch (e) {\r\n    {\r\n      warn(false, (\"missing param for \" + routeMsg + \": \" + (e.message)));\r\n    }\r\n    return ''\r\n  }\r\n}\r\n\r\n/*  */\r\n\r\nfunction createRouteMap (\r\n  routes,\r\n  oldPathList,\r\n  oldPathMap,\r\n  oldNameMap\r\n) {\r\n  // the path list is used to control path matching priority\r\n  var pathList = oldPathList || [];\r\n  // $flow-disable-line\r\n  var pathMap = oldPathMap || Object.create(null);\r\n  // $flow-disable-line\r\n  var nameMap = oldNameMap || Object.create(null);\r\n\r\n  routes.forEach(function (route) {\r\n    addRouteRecord(pathList, pathMap, nameMap, route);\r\n  });\r\n\r\n  // ensure wildcard routes are always at the end\r\n  for (var i = 0, l = pathList.length; i < l; i++) {\r\n    if (pathList[i] === '*') {\r\n      pathList.push(pathList.splice(i, 1)[0]);\r\n      l--;\r\n      i--;\r\n    }\r\n  }\r\n\r\n  return {\r\n    pathList: pathList,\r\n    pathMap: pathMap,\r\n    nameMap: nameMap\r\n  }\r\n}\r\n\r\nfunction addRouteRecord (\r\n  pathList,\r\n  pathMap,\r\n  nameMap,\r\n  route,\r\n  parent,\r\n  matchAs\r\n) {\r\n  var path = route.path;\r\n  var name = route.name;\r\n  {\r\n    assert(path != null, \"\\\"path\\\" is required in a route configuration.\");\r\n    assert(\r\n      typeof route.component !== 'string',\r\n      \"route config \\\"component\\\" for path: \" + (String(path || name)) + \" cannot be a \" +\r\n      \"string id. Use an actual component instead.\"\r\n    );\r\n  }\r\n\r\n  var pathToRegexpOptions = route.pathToRegexpOptions || {};\r\n  var normalizedPath = normalizePath(\r\n    path,\r\n    parent,\r\n    pathToRegexpOptions.strict\r\n  );\r\n\r\n  if (typeof route.caseSensitive === 'boolean') {\r\n    pathToRegexpOptions.sensitive = route.caseSensitive;\r\n  }\r\n\r\n  var record = {\r\n    path: normalizedPath,\r\n    regex: compileRouteRegex(normalizedPath, pathToRegexpOptions),\r\n    components: route.components || { default: route.component },\r\n    instances: {},\r\n    name: name,\r\n    parent: parent,\r\n    matchAs: matchAs,\r\n    redirect: route.redirect,\r\n    beforeEnter: route.beforeEnter,\r\n    meta: route.meta || {},\r\n    props: route.props == null\r\n      ? {}\r\n      : route.components\r\n        ? route.props\r\n        : { default: route.props }\r\n  };\r\n\r\n  if (route.children) {\r\n    // Warn if route is named, does not redirect and has a default child route.\r\n    // If users navigate to this route by name, the default child will\r\n    // not be rendered (GH Issue #629)\r\n    {\r\n      if (route.name && !route.redirect && route.children.some(function (child) { return /^\\/?$/.test(child.path); })) {\r\n        warn(\r\n          false,\r\n          \"Named Route '\" + (route.name) + \"' has a default child route. \" +\r\n          \"When navigating to this named route (:to=\\\"{name: '\" + (route.name) + \"'\\\"), \" +\r\n          \"the default child route will not be rendered. Remove the name from \" +\r\n          \"this route and use the name of the default child route for named \" +\r\n          \"links instead.\"\r\n        );\r\n      }\r\n    }\r\n    route.children.forEach(function (child) {\r\n      var childMatchAs = matchAs\r\n        ? cleanPath((matchAs + \"/\" + (child.path)))\r\n        : undefined;\r\n      addRouteRecord(pathList, pathMap, nameMap, child, record, childMatchAs);\r\n    });\r\n  }\r\n\r\n  if (route.alias !== undefined) {\r\n    var aliases = Array.isArray(route.alias)\r\n      ? route.alias\r\n      : [route.alias];\r\n\r\n    aliases.forEach(function (alias) {\r\n      var aliasRoute = {\r\n        path: alias,\r\n        children: route.children\r\n      };\r\n      addRouteRecord(\r\n        pathList,\r\n        pathMap,\r\n        nameMap,\r\n        aliasRoute,\r\n        parent,\r\n        record.path || '/' // matchAs\r\n      );\r\n    });\r\n  }\r\n\r\n  if (!pathMap[record.path]) {\r\n    pathList.push(record.path);\r\n    pathMap[record.path] = record;\r\n  }\r\n\r\n  if (name) {\r\n    if (!nameMap[name]) {\r\n      nameMap[name] = record;\r\n    } else if (\"development\" !== 'production' && !matchAs) {\r\n      warn(\r\n        false,\r\n        \"Duplicate named routes definition: \" +\r\n        \"{ name: \\\"\" + name + \"\\\", path: \\\"\" + (record.path) + \"\\\" }\"\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nfunction compileRouteRegex (path, pathToRegexpOptions) {\r\n  var regex = pathToRegexp_1(path, [], pathToRegexpOptions);\r\n  {\r\n    var keys = Object.create(null);\r\n    regex.keys.forEach(function (key) {\r\n      warn(!keys[key.name], (\"Duplicate param keys in route with path: \\\"\" + path + \"\\\"\"));\r\n      keys[key.name] = true;\r\n    });\r\n  }\r\n  return regex\r\n}\r\n\r\nfunction normalizePath (path, parent, strict) {\r\n  if (!strict) { path = path.replace(/\\/$/, ''); }\r\n  if (path[0] === '/') { return path }\r\n  if (parent == null) { return path }\r\n  return cleanPath(((parent.path) + \"/\" + path))\r\n}\r\n\r\n/*  */\r\n\r\n\r\nfunction normalizeLocation (\r\n  raw,\r\n  current,\r\n  append,\r\n  router\r\n) {\r\n  var next = typeof raw === 'string' ? { path: raw } : raw;\r\n  // named target\r\n  if (next.name || next._normalized) {\r\n    return next\r\n  }\r\n\r\n  // relative params\r\n  if (!next.path && next.params && current) {\r\n    next = assign({}, next);\r\n    next._normalized = true;\r\n    var params = assign(assign({}, current.params), next.params);\r\n    if (current.name) {\r\n      next.name = current.name;\r\n      next.params = params;\r\n    } else if (current.matched.length) {\r\n      var rawPath = current.matched[current.matched.length - 1].path;\r\n      next.path = fillParams(rawPath, params, (\"path \" + (current.path)));\r\n    } else {\r\n      warn(false, \"relative params navigation requires a current route.\");\r\n    }\r\n    return next\r\n  }\r\n\r\n  var parsedPath = parsePath(next.path || '');\r\n  var basePath = (current && current.path) || '/';\r\n  var path = parsedPath.path\r\n    ? resolvePath(parsedPath.path, basePath, append || next.append)\r\n    : basePath;\r\n\r\n  var query = resolveQuery(\r\n    parsedPath.query,\r\n    next.query,\r\n    router && router.options.parseQuery\r\n  );\r\n\r\n  var hash = next.hash || parsedPath.hash;\r\n  if (hash && hash.charAt(0) !== '#') {\r\n    hash = \"#\" + hash;\r\n  }\r\n\r\n  return {\r\n    _normalized: true,\r\n    path: path,\r\n    query: query,\r\n    hash: hash\r\n  }\r\n}\r\n\r\nfunction assign (a, b) {\r\n  for (var key in b) {\r\n    a[key] = b[key];\r\n  }\r\n  return a\r\n}\r\n\r\n/*  */\r\n\r\n\r\nfunction createMatcher (\r\n  routes,\r\n  router\r\n) {\r\n  var ref = createRouteMap(routes);\r\n  var pathList = ref.pathList;\r\n  var pathMap = ref.pathMap;\r\n  var nameMap = ref.nameMap;\r\n\r\n  function addRoutes (routes) {\r\n    createRouteMap(routes, pathList, pathMap, nameMap);\r\n  }\r\n\r\n  function match (\r\n    raw,\r\n    currentRoute,\r\n    redirectedFrom\r\n  ) {\r\n    var location = normalizeLocation(raw, currentRoute, false, router);\r\n    var name = location.name;\r\n\r\n    if (name) {\r\n      var record = nameMap[name];\r\n      {\r\n        warn(record, (\"Route with name '\" + name + \"' does not exist\"));\r\n      }\r\n      if (!record) { return _createRoute(null, location) }\r\n      var paramNames = record.regex.keys\r\n        .filter(function (key) { return !key.optional; })\r\n        .map(function (key) { return key.name; });\r\n\r\n      if (typeof location.params !== 'object') {\r\n        location.params = {};\r\n      }\r\n\r\n      if (currentRoute && typeof currentRoute.params === 'object') {\r\n        for (var key in currentRoute.params) {\r\n          if (!(key in location.params) && paramNames.indexOf(key) > -1) {\r\n            location.params[key] = currentRoute.params[key];\r\n          }\r\n        }\r\n      }\r\n\r\n      if (record) {\r\n        location.path = fillParams(record.path, location.params, (\"named route \\\"\" + name + \"\\\"\"));\r\n        return _createRoute(record, location, redirectedFrom)\r\n      }\r\n    } else if (location.path) {\r\n      location.params = {};\r\n      for (var i = 0; i < pathList.length; i++) {\r\n        var path = pathList[i];\r\n        var record$1 = pathMap[path];\r\n        if (matchRoute(record$1.regex, location.path, location.params)) {\r\n          return _createRoute(record$1, location, redirectedFrom)\r\n        }\r\n      }\r\n    }\r\n    // no match\r\n    return _createRoute(null, location)\r\n  }\r\n\r\n  function redirect (\r\n    record,\r\n    location\r\n  ) {\r\n    var originalRedirect = record.redirect;\r\n    var redirect = typeof originalRedirect === 'function'\r\n        ? originalRedirect(createRoute(record, location, null, router))\r\n        : originalRedirect;\r\n\r\n    if (typeof redirect === 'string') {\r\n      redirect = { path: redirect };\r\n    }\r\n\r\n    if (!redirect || typeof redirect !== 'object') {\r\n      {\r\n        warn(\r\n          false, (\"invalid redirect option: \" + (JSON.stringify(redirect)))\r\n        );\r\n      }\r\n      return _createRoute(null, location)\r\n    }\r\n\r\n    var re = redirect;\r\n    var name = re.name;\r\n    var path = re.path;\r\n    var query = location.query;\r\n    var hash = location.hash;\r\n    var params = location.params;\r\n    query = re.hasOwnProperty('query') ? re.query : query;\r\n    hash = re.hasOwnProperty('hash') ? re.hash : hash;\r\n    params = re.hasOwnProperty('params') ? re.params : params;\r\n\r\n    if (name) {\r\n      // resolved named direct\r\n      var targetRecord = nameMap[name];\r\n      {\r\n        assert(targetRecord, (\"redirect failed: named route \\\"\" + name + \"\\\" not found.\"));\r\n      }\r\n      return match({\r\n        _normalized: true,\r\n        name: name,\r\n        query: query,\r\n        hash: hash,\r\n        params: params\r\n      }, undefined, location)\r\n    } else if (path) {\r\n      // 1. resolve relative redirect\r\n      var rawPath = resolveRecordPath(path, record);\r\n      // 2. resolve params\r\n      var resolvedPath = fillParams(rawPath, params, (\"redirect route with path \\\"\" + rawPath + \"\\\"\"));\r\n      // 3. rematch with existing query and hash\r\n      return match({\r\n        _normalized: true,\r\n        path: resolvedPath,\r\n        query: query,\r\n        hash: hash\r\n      }, undefined, location)\r\n    } else {\r\n      {\r\n        warn(false, (\"invalid redirect option: \" + (JSON.stringify(redirect))));\r\n      }\r\n      return _createRoute(null, location)\r\n    }\r\n  }\r\n\r\n  function alias (\r\n    record,\r\n    location,\r\n    matchAs\r\n  ) {\r\n    var aliasedPath = fillParams(matchAs, location.params, (\"aliased route with path \\\"\" + matchAs + \"\\\"\"));\r\n    var aliasedMatch = match({\r\n      _normalized: true,\r\n      path: aliasedPath\r\n    });\r\n    if (aliasedMatch) {\r\n      var matched = aliasedMatch.matched;\r\n      var aliasedRecord = matched[matched.length - 1];\r\n      location.params = aliasedMatch.params;\r\n      return _createRoute(aliasedRecord, location)\r\n    }\r\n    return _createRoute(null, location)\r\n  }\r\n\r\n  function _createRoute (\r\n    record,\r\n    location,\r\n    redirectedFrom\r\n  ) {\r\n    if (record && record.redirect) {\r\n      return redirect(record, redirectedFrom || location)\r\n    }\r\n    if (record && record.matchAs) {\r\n      return alias(record, location, record.matchAs)\r\n    }\r\n    return createRoute(record, location, redirectedFrom, router)\r\n  }\r\n\r\n  return {\r\n    match: match,\r\n    addRoutes: addRoutes\r\n  }\r\n}\r\n\r\nfunction matchRoute (\r\n  regex,\r\n  path,\r\n  params\r\n) {\r\n  var m = path.match(regex);\r\n\r\n  if (!m) {\r\n    return false\r\n  } else if (!params) {\r\n    return true\r\n  }\r\n\r\n  for (var i = 1, len = m.length; i < len; ++i) {\r\n    var key = regex.keys[i - 1];\r\n    var val = typeof m[i] === 'string' ? decodeURIComponent(m[i]) : m[i];\r\n    if (key) {\r\n      params[key.name] = val;\r\n    }\r\n  }\r\n\r\n  return true\r\n}\r\n\r\nfunction resolveRecordPath (path, record) {\r\n  return resolvePath(path, record.parent ? record.parent.path : '/', true)\r\n}\r\n\r\n/*  */\r\n\r\n\r\nvar positionStore = Object.create(null);\r\n\r\nfunction setupScroll () {\r\n  // Fix for #1585 for Firefox\r\n  window.history.replaceState({ key: getStateKey() }, '');\r\n  window.addEventListener('popstate', function (e) {\r\n    saveScrollPosition();\r\n    if (e.state && e.state.key) {\r\n      setStateKey(e.state.key);\r\n    }\r\n  });\r\n}\r\n\r\nfunction handleScroll (\r\n  router,\r\n  to,\r\n  from,\r\n  isPop\r\n) {\r\n  if (!router.app) {\r\n    return\r\n  }\r\n\r\n  var behavior = router.options.scrollBehavior;\r\n  if (!behavior) {\r\n    return\r\n  }\r\n\r\n  {\r\n    assert(typeof behavior === 'function', \"scrollBehavior must be a function\");\r\n  }\r\n\r\n  // wait until re-render finishes before scrolling\r\n  router.app.$nextTick(function () {\r\n    var position = getScrollPosition();\r\n    var shouldScroll = behavior(to, from, isPop ? position : null);\r\n\r\n    if (!shouldScroll) {\r\n      return\r\n    }\r\n\r\n    if (typeof shouldScroll.then === 'function') {\r\n      shouldScroll.then(function (shouldScroll) {\r\n        scrollToPosition((shouldScroll), position);\r\n      }).catch(function (err) {\r\n        {\r\n          assert(false, err.toString());\r\n        }\r\n      });\r\n    } else {\r\n      scrollToPosition(shouldScroll, position);\r\n    }\r\n  });\r\n}\r\n\r\nfunction saveScrollPosition () {\r\n  var key = getStateKey();\r\n  if (key) {\r\n    positionStore[key] = {\r\n      x: window.pageXOffset,\r\n      y: window.pageYOffset\r\n    };\r\n  }\r\n}\r\n\r\nfunction getScrollPosition () {\r\n  var key = getStateKey();\r\n  if (key) {\r\n    return positionStore[key]\r\n  }\r\n}\r\n\r\nfunction getElementPosition (el, offset) {\r\n  var docEl = document.documentElement;\r\n  var docRect = docEl.getBoundingClientRect();\r\n  var elRect = el.getBoundingClientRect();\r\n  return {\r\n    x: elRect.left - docRect.left - offset.x,\r\n    y: elRect.top - docRect.top - offset.y\r\n  }\r\n}\r\n\r\nfunction isValidPosition (obj) {\r\n  return isNumber(obj.x) || isNumber(obj.y)\r\n}\r\n\r\nfunction normalizePosition (obj) {\r\n  return {\r\n    x: isNumber(obj.x) ? obj.x : window.pageXOffset,\r\n    y: isNumber(obj.y) ? obj.y : window.pageYOffset\r\n  }\r\n}\r\n\r\nfunction normalizeOffset (obj) {\r\n  return {\r\n    x: isNumber(obj.x) ? obj.x : 0,\r\n    y: isNumber(obj.y) ? obj.y : 0\r\n  }\r\n}\r\n\r\nfunction isNumber (v) {\r\n  return typeof v === 'number'\r\n}\r\n\r\nfunction scrollToPosition (shouldScroll, position) {\r\n  var isObject = typeof shouldScroll === 'object';\r\n  if (isObject && typeof shouldScroll.selector === 'string') {\r\n    var el = document.querySelector(shouldScroll.selector);\r\n    if (el) {\r\n      var offset = shouldScroll.offset && typeof shouldScroll.offset === 'object' ? shouldScroll.offset : {};\r\n      offset = normalizeOffset(offset);\r\n      position = getElementPosition(el, offset);\r\n    } else if (isValidPosition(shouldScroll)) {\r\n      position = normalizePosition(shouldScroll);\r\n    }\r\n  } else if (isObject && isValidPosition(shouldScroll)) {\r\n    position = normalizePosition(shouldScroll);\r\n  }\r\n\r\n  if (position) {\r\n    window.scrollTo(position.x, position.y);\r\n  }\r\n}\r\n\r\n/*  */\r\n\r\nvar supportsPushState = inBrowser && (function () {\r\n  var ua = window.navigator.userAgent;\r\n\r\n  if (\r\n    (ua.indexOf('Android 2.') !== -1 || ua.indexOf('Android 4.0') !== -1) &&\r\n    ua.indexOf('Mobile Safari') !== -1 &&\r\n    ua.indexOf('Chrome') === -1 &&\r\n    ua.indexOf('Windows Phone') === -1\r\n  ) {\r\n    return false\r\n  }\r\n\r\n  return window.history && 'pushState' in window.history\r\n})();\r\n\r\n// use User Timing api (if present) for more accurate key precision\r\nvar Time = inBrowser && window.performance && window.performance.now\r\n  ? window.performance\r\n  : Date;\r\n\r\nvar _key = genKey();\r\n\r\nfunction genKey () {\r\n  return Time.now().toFixed(3)\r\n}\r\n\r\nfunction getStateKey () {\r\n  return _key\r\n}\r\n\r\nfunction setStateKey (key) {\r\n  _key = key;\r\n}\r\n\r\nfunction pushState (url, replace) {\r\n  saveScrollPosition();\r\n  // try...catch the pushState call to get around Safari\r\n  // DOM Exception 18 where it limits to 100 pushState calls\r\n  var history = window.history;\r\n  try {\r\n    if (replace) {\r\n      history.replaceState({ key: _key }, '', url);\r\n    } else {\r\n      _key = genKey();\r\n      history.pushState({ key: _key }, '', url);\r\n    }\r\n  } catch (e) {\r\n    window.location[replace ? 'replace' : 'assign'](url);\r\n  }\r\n}\r\n\r\nfunction replaceState (url) {\r\n  pushState(url, true);\r\n}\r\n\r\n/*  */\r\n\r\nfunction runQueue (queue, fn, cb) {\r\n  var step = function (index) {\r\n    if (index >= queue.length) {\r\n      cb();\r\n    } else {\r\n      if (queue[index]) {\r\n        fn(queue[index], function () {\r\n          step(index + 1);\r\n        });\r\n      } else {\r\n        step(index + 1);\r\n      }\r\n    }\r\n  };\r\n  step(0);\r\n}\r\n\r\n/*  */\r\n\r\nfunction resolveAsyncComponents (matched) {\r\n  return function (to, from, next) {\r\n    var hasAsync = false;\r\n    var pending = 0;\r\n    var error = null;\r\n\r\n    flatMapComponents(matched, function (def, _, match, key) {\r\n      // if it's a function and doesn't have cid attached,\r\n      // assume it's an async component resolve function.\r\n      // we are not using Vue's default async resolving mechanism because\r\n      // we want to halt the navigation until the incoming component has been\r\n      // resolved.\r\n      if (typeof def === 'function' && def.cid === undefined) {\r\n        hasAsync = true;\r\n        pending++;\r\n\r\n        var resolve = once(function (resolvedDef) {\r\n          if (isESModule(resolvedDef)) {\r\n            resolvedDef = resolvedDef.default;\r\n          }\r\n          // save resolved on async factory in case it's used elsewhere\r\n          def.resolved = typeof resolvedDef === 'function'\r\n            ? resolvedDef\r\n            : _Vue.extend(resolvedDef);\r\n          match.components[key] = resolvedDef;\r\n          pending--;\r\n          if (pending <= 0) {\r\n            next();\r\n          }\r\n        });\r\n\r\n        var reject = once(function (reason) {\r\n          var msg = \"Failed to resolve async component \" + key + \": \" + reason;\r\n          \"development\" !== 'production' && warn(false, msg);\r\n          if (!error) {\r\n            error = isError(reason)\r\n              ? reason\r\n              : new Error(msg);\r\n            next(error);\r\n          }\r\n        });\r\n\r\n        var res;\r\n        try {\r\n          res = def(resolve, reject);\r\n        } catch (e) {\r\n          reject(e);\r\n        }\r\n        if (res) {\r\n          if (typeof res.then === 'function') {\r\n            res.then(resolve, reject);\r\n          } else {\r\n            // new syntax in Vue 2.3\r\n            var comp = res.component;\r\n            if (comp && typeof comp.then === 'function') {\r\n              comp.then(resolve, reject);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    if (!hasAsync) { next(); }\r\n  }\r\n}\r\n\r\nfunction flatMapComponents (\r\n  matched,\r\n  fn\r\n) {\r\n  return flatten(matched.map(function (m) {\r\n    return Object.keys(m.components).map(function (key) { return fn(\r\n      m.components[key],\r\n      m.instances[key],\r\n      m, key\r\n    ); })\r\n  }))\r\n}\r\n\r\nfunction flatten (arr) {\r\n  return Array.prototype.concat.apply([], arr)\r\n}\r\n\r\nvar hasSymbol =\r\n  typeof Symbol === 'function' &&\r\n  typeof Symbol.toStringTag === 'symbol';\r\n\r\nfunction isESModule (obj) {\r\n  return obj.__esModule || (hasSymbol && obj[Symbol.toStringTag] === 'Module')\r\n}\r\n\r\n// in Webpack 2, require.ensure now also returns a Promise\r\n// so the resolve/reject functions may get called an extra time\r\n// if the user uses an arrow function shorthand that happens to\r\n// return that Promise.\r\nfunction once (fn) {\r\n  var called = false;\r\n  return function () {\r\n    var args = [], len = arguments.length;\r\n    while ( len-- ) args[ len ] = arguments[ len ];\r\n\r\n    if (called) { return }\r\n    called = true;\r\n    return fn.apply(this, args)\r\n  }\r\n}\r\n\r\n/*  */\r\n\r\nvar History = function History (router, base) {\r\n  this.router = router;\r\n  this.base = normalizeBase(base);\r\n  // start with a route object that stands for \"nowhere\"\r\n  this.current = START;\r\n  this.pending = null;\r\n  this.ready = false;\r\n  this.readyCbs = [];\r\n  this.readyErrorCbs = [];\r\n  this.errorCbs = [];\r\n};\r\n\r\nHistory.prototype.listen = function listen (cb) {\r\n  this.cb = cb;\r\n};\r\n\r\nHistory.prototype.onReady = function onReady (cb, errorCb) {\r\n  if (this.ready) {\r\n    cb();\r\n  } else {\r\n    this.readyCbs.push(cb);\r\n    if (errorCb) {\r\n      this.readyErrorCbs.push(errorCb);\r\n    }\r\n  }\r\n};\r\n\r\nHistory.prototype.onError = function onError (errorCb) {\r\n  this.errorCbs.push(errorCb);\r\n};\r\n\r\nHistory.prototype.transitionTo = function transitionTo (location, onComplete, onAbort) {\r\n    var this$1 = this;\r\n\r\n  var route = this.router.match(location, this.current);\r\n  this.confirmTransition(route, function () {\r\n    this$1.updateRoute(route);\r\n    onComplete && onComplete(route);\r\n    this$1.ensureURL();\r\n\r\n    // fire ready cbs once\r\n    if (!this$1.ready) {\r\n      this$1.ready = true;\r\n      this$1.readyCbs.forEach(function (cb) { cb(route); });\r\n    }\r\n  }, function (err) {\r\n    if (onAbort) {\r\n      onAbort(err);\r\n    }\r\n    if (err && !this$1.ready) {\r\n      this$1.ready = true;\r\n      this$1.readyErrorCbs.forEach(function (cb) { cb(err); });\r\n    }\r\n  });\r\n};\r\n\r\nHistory.prototype.confirmTransition = function confirmTransition (route, onComplete, onAbort) {\r\n    var this$1 = this;\r\n\r\n  var current = this.current;\r\n  var abort = function (err) {\r\n    if (isError(err)) {\r\n      if (this$1.errorCbs.length) {\r\n        this$1.errorCbs.forEach(function (cb) { cb(err); });\r\n      } else {\r\n        warn(false, 'uncaught error during route navigation:');\r\n        console.error(err);\r\n      }\r\n    }\r\n    onAbort && onAbort(err);\r\n  };\r\n  if (\r\n    isSameRoute(route, current) &&\r\n    // in the case the route map has been dynamically appended to\r\n    route.matched.length === current.matched.length\r\n  ) {\r\n    this.ensureURL();\r\n    return abort()\r\n  }\r\n\r\n  var ref = resolveQueue(this.current.matched, route.matched);\r\n    var updated = ref.updated;\r\n    var deactivated = ref.deactivated;\r\n    var activated = ref.activated;\r\n\r\n  var queue = [].concat(\r\n    // in-component leave guards\r\n    extractLeaveGuards(deactivated),\r\n    // global before hooks\r\n    this.router.beforeHooks,\r\n    // in-component update hooks\r\n    extractUpdateHooks(updated),\r\n    // in-config enter guards\r\n    activated.map(function (m) { return m.beforeEnter; }),\r\n    // async components\r\n    resolveAsyncComponents(activated)\r\n  );\r\n\r\n  this.pending = route;\r\n  var iterator = function (hook, next) {\r\n    if (this$1.pending !== route) {\r\n      return abort()\r\n    }\r\n    try {\r\n      hook(route, current, function (to) {\r\n        if (to === false || isError(to)) {\r\n          // next(false) -> abort navigation, ensure current URL\r\n          this$1.ensureURL(true);\r\n          abort(to);\r\n        } else if (\r\n          typeof to === 'string' ||\r\n          (typeof to === 'object' && (\r\n            typeof to.path === 'string' ||\r\n            typeof to.name === 'string'\r\n          ))\r\n        ) {\r\n          // next('/') or next({ path: '/' }) -> redirect\r\n          abort();\r\n          if (typeof to === 'object' && to.replace) {\r\n            this$1.replace(to);\r\n          } else {\r\n            this$1.push(to);\r\n          }\r\n        } else {\r\n          // confirm transition and pass on the value\r\n          next(to);\r\n        }\r\n      });\r\n    } catch (e) {\r\n      abort(e);\r\n    }\r\n  };\r\n\r\n  runQueue(queue, iterator, function () {\r\n    var postEnterCbs = [];\r\n    var isValid = function () { return this$1.current === route; };\r\n    // wait until async components are resolved before\r\n    // extracting in-component enter guards\r\n    var enterGuards = extractEnterGuards(activated, postEnterCbs, isValid);\r\n    var queue = enterGuards.concat(this$1.router.resolveHooks);\r\n    runQueue(queue, iterator, function () {\r\n      if (this$1.pending !== route) {\r\n        return abort()\r\n      }\r\n      this$1.pending = null;\r\n      onComplete(route);\r\n      if (this$1.router.app) {\r\n        this$1.router.app.$nextTick(function () {\r\n          postEnterCbs.forEach(function (cb) { cb(); });\r\n        });\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nHistory.prototype.updateRoute = function updateRoute (route) {\r\n  var prev = this.current;\r\n  this.current = route;\r\n  this.cb && this.cb(route);\r\n  this.router.afterHooks.forEach(function (hook) {\r\n    hook && hook(route, prev);\r\n  });\r\n};\r\n\r\nfunction normalizeBase (base) {\r\n  if (!base) {\r\n    if (inBrowser) {\r\n      // respect <base> tag\r\n      var baseEl = document.querySelector('base');\r\n      base = (baseEl && baseEl.getAttribute('href')) || '/';\r\n      // strip full URL origin\r\n      base = base.replace(/^https?:\\/\\/[^\\/]+/, '');\r\n    } else {\r\n      base = '/';\r\n    }\r\n  }\r\n  // make sure there's the starting slash\r\n  if (base.charAt(0) !== '/') {\r\n    base = '/' + base;\r\n  }\r\n  // remove trailing slash\r\n  return base.replace(/\\/$/, '')\r\n}\r\n\r\nfunction resolveQueue (\r\n  current,\r\n  next\r\n) {\r\n  var i;\r\n  var max = Math.max(current.length, next.length);\r\n  for (i = 0; i < max; i++) {\r\n    if (current[i] !== next[i]) {\r\n      break\r\n    }\r\n  }\r\n  return {\r\n    updated: next.slice(0, i),\r\n    activated: next.slice(i),\r\n    deactivated: current.slice(i)\r\n  }\r\n}\r\n\r\nfunction extractGuards (\r\n  records,\r\n  name,\r\n  bind,\r\n  reverse\r\n) {\r\n  var guards = flatMapComponents(records, function (def, instance, match, key) {\r\n    var guard = extractGuard(def, name);\r\n    if (guard) {\r\n      return Array.isArray(guard)\r\n        ? guard.map(function (guard) { return bind(guard, instance, match, key); })\r\n        : bind(guard, instance, match, key)\r\n    }\r\n  });\r\n  return flatten(reverse ? guards.reverse() : guards)\r\n}\r\n\r\nfunction extractGuard (\r\n  def,\r\n  key\r\n) {\r\n  if (typeof def !== 'function') {\r\n    // extend now so that global mixins are applied.\r\n    def = _Vue.extend(def);\r\n  }\r\n  return def.options[key]\r\n}\r\n\r\nfunction extractLeaveGuards (deactivated) {\r\n  return extractGuards(deactivated, 'beforeRouteLeave', bindGuard, true)\r\n}\r\n\r\nfunction extractUpdateHooks (updated) {\r\n  return extractGuards(updated, 'beforeRouteUpdate', bindGuard)\r\n}\r\n\r\nfunction bindGuard (guard, instance) {\r\n  if (instance) {\r\n    return function boundRouteGuard () {\r\n      return guard.apply(instance, arguments)\r\n    }\r\n  }\r\n}\r\n\r\nfunction extractEnterGuards (\r\n  activated,\r\n  cbs,\r\n  isValid\r\n) {\r\n  return extractGuards(activated, 'beforeRouteEnter', function (guard, _, match, key) {\r\n    return bindEnterGuard(guard, match, key, cbs, isValid)\r\n  })\r\n}\r\n\r\nfunction bindEnterGuard (\r\n  guard,\r\n  match,\r\n  key,\r\n  cbs,\r\n  isValid\r\n) {\r\n  return function routeEnterGuard (to, from, next) {\r\n    return guard(to, from, function (cb) {\r\n      next(cb);\r\n      if (typeof cb === 'function') {\r\n        cbs.push(function () {\r\n          // #750\r\n          // if a router-view is wrapped with an out-in transition,\r\n          // the instance may not have been registered at this time.\r\n          // we will need to poll for registration until current route\r\n          // is no longer valid.\r\n          poll(cb, match.instances, key, isValid);\r\n        });\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nfunction poll (\r\n  cb, // somehow flow cannot infer this is a function\r\n  instances,\r\n  key,\r\n  isValid\r\n) {\r\n  if (instances[key]) {\r\n    cb(instances[key]);\r\n  } else if (isValid()) {\r\n    setTimeout(function () {\r\n      poll(cb, instances, key, isValid);\r\n    }, 16);\r\n  }\r\n}\r\n\r\n/*  */\r\n\r\n\r\nvar HTML5History = (function (History$$1) {\r\n  function HTML5History (router, base) {\r\n    var this$1 = this;\r\n\r\n    History$$1.call(this, router, base);\r\n\r\n    var expectScroll = router.options.scrollBehavior;\r\n\r\n    if (expectScroll) {\r\n      setupScroll();\r\n    }\r\n\r\n    var initLocation = getLocation(this.base);\r\n    window.addEventListener('popstate', function (e) {\r\n      var current = this$1.current;\r\n\r\n      // Avoiding first `popstate` event dispatched in some browsers but first\r\n      // history route not updated since async guard at the same time.\r\n      var location = getLocation(this$1.base);\r\n      if (this$1.current === START && location === initLocation) {\r\n        return\r\n      }\r\n\r\n      this$1.transitionTo(location, function (route) {\r\n        if (expectScroll) {\r\n          handleScroll(router, route, current, true);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  if ( History$$1 ) HTML5History.__proto__ = History$$1;\r\n  HTML5History.prototype = Object.create( History$$1 && History$$1.prototype );\r\n  HTML5History.prototype.constructor = HTML5History;\r\n\r\n  HTML5History.prototype.go = function go (n) {\r\n    window.history.go(n);\r\n  };\r\n\r\n  HTML5History.prototype.push = function push (location, onComplete, onAbort) {\r\n    var this$1 = this;\r\n\r\n    var ref = this;\r\n    var fromRoute = ref.current;\r\n    this.transitionTo(location, function (route) {\r\n      pushState(cleanPath(this$1.base + route.fullPath));\r\n      handleScroll(this$1.router, route, fromRoute, false);\r\n      onComplete && onComplete(route);\r\n    }, onAbort);\r\n  };\r\n\r\n  HTML5History.prototype.replace = function replace (location, onComplete, onAbort) {\r\n    var this$1 = this;\r\n\r\n    var ref = this;\r\n    var fromRoute = ref.current;\r\n    this.transitionTo(location, function (route) {\r\n      replaceState(cleanPath(this$1.base + route.fullPath));\r\n      handleScroll(this$1.router, route, fromRoute, false);\r\n      onComplete && onComplete(route);\r\n    }, onAbort);\r\n  };\r\n\r\n  HTML5History.prototype.ensureURL = function ensureURL (push) {\r\n    if (getLocation(this.base) !== this.current.fullPath) {\r\n      var current = cleanPath(this.base + this.current.fullPath);\r\n      push ? pushState(current) : replaceState(current);\r\n    }\r\n  };\r\n\r\n  HTML5History.prototype.getCurrentLocation = function getCurrentLocation () {\r\n    return getLocation(this.base)\r\n  };\r\n\r\n  return HTML5History;\r\n}(History));\r\n\r\nfunction getLocation (base) {\r\n  var path = window.location.pathname;\r\n  if (base && path.indexOf(base) === 0) {\r\n    path = path.slice(base.length);\r\n  }\r\n  return (path || '/') + window.location.search + window.location.hash\r\n}\r\n\r\n/*  */\r\n\r\n\r\nvar HashHistory = (function (History$$1) {\r\n  function HashHistory (router, base, fallback) {\r\n    History$$1.call(this, router, base);\r\n    // check history fallback deeplinking\r\n    if (fallback && checkFallback(this.base)) {\r\n      return\r\n    }\r\n    ensureSlash();\r\n  }\r\n\r\n  if ( History$$1 ) HashHistory.__proto__ = History$$1;\r\n  HashHistory.prototype = Object.create( History$$1 && History$$1.prototype );\r\n  HashHistory.prototype.constructor = HashHistory;\r\n\r\n  // this is delayed until the app mounts\r\n  // to avoid the hashchange listener being fired too early\r\n  HashHistory.prototype.setupListeners = function setupListeners () {\r\n    var this$1 = this;\r\n\r\n    var router = this.router;\r\n    var expectScroll = router.options.scrollBehavior;\r\n    var supportsScroll = supportsPushState && expectScroll;\r\n\r\n    if (supportsScroll) {\r\n      setupScroll();\r\n    }\r\n\r\n    window.addEventListener(supportsPushState ? 'popstate' : 'hashchange', function () {\r\n      var current = this$1.current;\r\n      if (!ensureSlash()) {\r\n        return\r\n      }\r\n      this$1.transitionTo(getHash(), function (route) {\r\n        if (supportsScroll) {\r\n          handleScroll(this$1.router, route, current, true);\r\n        }\r\n        if (!supportsPushState) {\r\n          replaceHash(route.fullPath);\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  HashHistory.prototype.push = function push (location, onComplete, onAbort) {\r\n    var this$1 = this;\r\n\r\n    var ref = this;\r\n    var fromRoute = ref.current;\r\n    this.transitionTo(location, function (route) {\r\n      pushHash(route.fullPath);\r\n      handleScroll(this$1.router, route, fromRoute, false);\r\n      onComplete && onComplete(route);\r\n    }, onAbort);\r\n  };\r\n\r\n  HashHistory.prototype.replace = function replace (location, onComplete, onAbort) {\r\n    var this$1 = this;\r\n\r\n    var ref = this;\r\n    var fromRoute = ref.current;\r\n    this.transitionTo(location, function (route) {\r\n      replaceHash(route.fullPath);\r\n      handleScroll(this$1.router, route, fromRoute, false);\r\n      onComplete && onComplete(route);\r\n    }, onAbort);\r\n  };\r\n\r\n  HashHistory.prototype.go = function go (n) {\r\n    window.history.go(n);\r\n  };\r\n\r\n  HashHistory.prototype.ensureURL = function ensureURL (push) {\r\n    var current = this.current.fullPath;\r\n    if (getHash() !== current) {\r\n      push ? pushHash(current) : replaceHash(current);\r\n    }\r\n  };\r\n\r\n  HashHistory.prototype.getCurrentLocation = function getCurrentLocation () {\r\n    return getHash()\r\n  };\r\n\r\n  return HashHistory;\r\n}(History));\r\n\r\nfunction checkFallback (base) {\r\n  var location = getLocation(base);\r\n  if (!/^\\/#/.test(location)) {\r\n    window.location.replace(\r\n      cleanPath(base + '/#' + location)\r\n    );\r\n    return true\r\n  }\r\n}\r\n\r\nfunction ensureSlash () {\r\n  var path = getHash();\r\n  if (path.charAt(0) === '/') {\r\n    return true\r\n  }\r\n  replaceHash('/' + path);\r\n  return false\r\n}\r\n\r\nfunction getHash () {\r\n  // We can't use window.location.hash here because it's not\r\n  // consistent across browsers - Firefox will pre-decode it!\r\n  var href = window.location.href;\r\n  var index = href.indexOf('#');\r\n  return index === -1 ? '' : href.slice(index + 1)\r\n}\r\n\r\nfunction getUrl (path) {\r\n  var href = window.location.href;\r\n  var i = href.indexOf('#');\r\n  var base = i >= 0 ? href.slice(0, i) : href;\r\n  return (base + \"#\" + path)\r\n}\r\n\r\nfunction pushHash (path) {\r\n  if (supportsPushState) {\r\n    pushState(getUrl(path));\r\n  } else {\r\n    window.location.hash = path;\r\n  }\r\n}\r\n\r\nfunction replaceHash (path) {\r\n  if (supportsPushState) {\r\n    replaceState(getUrl(path));\r\n  } else {\r\n    window.location.replace(getUrl(path));\r\n  }\r\n}\r\n\r\n/*  */\r\n\r\n\r\nvar AbstractHistory = (function (History$$1) {\r\n  function AbstractHistory (router, base) {\r\n    History$$1.call(this, router, base);\r\n    this.stack = [];\r\n    this.index = -1;\r\n  }\r\n\r\n  if ( History$$1 ) AbstractHistory.__proto__ = History$$1;\r\n  AbstractHistory.prototype = Object.create( History$$1 && History$$1.prototype );\r\n  AbstractHistory.prototype.constructor = AbstractHistory;\r\n\r\n  AbstractHistory.prototype.push = function push (location, onComplete, onAbort) {\r\n    var this$1 = this;\r\n\r\n    this.transitionTo(location, function (route) {\r\n      this$1.stack = this$1.stack.slice(0, this$1.index + 1).concat(route);\r\n      this$1.index++;\r\n      onComplete && onComplete(route);\r\n    }, onAbort);\r\n  };\r\n\r\n  AbstractHistory.prototype.replace = function replace (location, onComplete, onAbort) {\r\n    var this$1 = this;\r\n\r\n    this.transitionTo(location, function (route) {\r\n      this$1.stack = this$1.stack.slice(0, this$1.index).concat(route);\r\n      onComplete && onComplete(route);\r\n    }, onAbort);\r\n  };\r\n\r\n  AbstractHistory.prototype.go = function go (n) {\r\n    var this$1 = this;\r\n\r\n    var targetIndex = this.index + n;\r\n    if (targetIndex < 0 || targetIndex >= this.stack.length) {\r\n      return\r\n    }\r\n    var route = this.stack[targetIndex];\r\n    this.confirmTransition(route, function () {\r\n      this$1.index = targetIndex;\r\n      this$1.updateRoute(route);\r\n    });\r\n  };\r\n\r\n  AbstractHistory.prototype.getCurrentLocation = function getCurrentLocation () {\r\n    var current = this.stack[this.stack.length - 1];\r\n    return current ? current.fullPath : '/'\r\n  };\r\n\r\n  AbstractHistory.prototype.ensureURL = function ensureURL () {\r\n    // noop\r\n  };\r\n\r\n  return AbstractHistory;\r\n}(History));\r\n\r\n/*  */\r\n\r\nvar VueRouter = function VueRouter (options) {\r\n  if ( options === void 0 ) options = {};\r\n\r\n  this.app = null;\r\n  this.apps = [];\r\n  this.options = options;\r\n  this.beforeHooks = [];\r\n  this.resolveHooks = [];\r\n  this.afterHooks = [];\r\n  this.matcher = createMatcher(options.routes || [], this);\r\n\r\n  var mode = options.mode || 'hash';\r\n  this.fallback = mode === 'history' && !supportsPushState && options.fallback !== false;\r\n  if (this.fallback) {\r\n    mode = 'hash';\r\n  }\r\n  if (!inBrowser) {\r\n    mode = 'abstract';\r\n  }\r\n  this.mode = mode;\r\n\r\n  switch (mode) {\r\n    case 'history':\r\n      this.history = new HTML5History(this, options.base);\r\n      break\r\n    case 'hash':\r\n      this.history = new HashHistory(this, options.base, this.fallback);\r\n      break\r\n    case 'abstract':\r\n      this.history = new AbstractHistory(this, options.base);\r\n      break\r\n    default:\r\n      {\r\n        assert(false, (\"invalid mode: \" + mode));\r\n      }\r\n  }\r\n};\r\n\r\nvar prototypeAccessors = { currentRoute: { configurable: true } };\r\n\r\nVueRouter.prototype.match = function match (\r\n  raw,\r\n  current,\r\n  redirectedFrom\r\n) {\r\n  return this.matcher.match(raw, current, redirectedFrom)\r\n};\r\n\r\nprototypeAccessors.currentRoute.get = function () {\r\n  return this.history && this.history.current\r\n};\r\n\r\nVueRouter.prototype.init = function init (app /* Vue component instance */) {\r\n    var this$1 = this;\r\n\r\n  \"development\" !== 'production' && assert(\r\n    install.installed,\r\n    \"not installed. Make sure to call `Vue.use(VueRouter)` \" +\r\n    \"before creating root instance.\"\r\n  );\r\n\r\n  this.apps.push(app);\r\n\r\n  // main app already initialized.\r\n  if (this.app) {\r\n    return\r\n  }\r\n\r\n  this.app = app;\r\n\r\n  var history = this.history;\r\n\r\n  if (history instanceof HTML5History) {\r\n    history.transitionTo(history.getCurrentLocation());\r\n  } else if (history instanceof HashHistory) {\r\n    var setupHashListener = function () {\r\n      history.setupListeners();\r\n    };\r\n    history.transitionTo(\r\n      history.getCurrentLocation(),\r\n      setupHashListener,\r\n      setupHashListener\r\n    );\r\n  }\r\n\r\n  history.listen(function (route) {\r\n    this$1.apps.forEach(function (app) {\r\n      app._route = route;\r\n    });\r\n  });\r\n};\r\n\r\nVueRouter.prototype.beforeEach = function beforeEach (fn) {\r\n  return registerHook(this.beforeHooks, fn)\r\n};\r\n\r\nVueRouter.prototype.beforeResolve = function beforeResolve (fn) {\r\n  return registerHook(this.resolveHooks, fn)\r\n};\r\n\r\nVueRouter.prototype.afterEach = function afterEach (fn) {\r\n  return registerHook(this.afterHooks, fn)\r\n};\r\n\r\nVueRouter.prototype.onReady = function onReady (cb, errorCb) {\r\n  this.history.onReady(cb, errorCb);\r\n};\r\n\r\nVueRouter.prototype.onError = function onError (errorCb) {\r\n  this.history.onError(errorCb);\r\n};\r\n\r\nVueRouter.prototype.push = function push (location, onComplete, onAbort) {\r\n  this.history.push(location, onComplete, onAbort);\r\n};\r\n\r\nVueRouter.prototype.replace = function replace (location, onComplete, onAbort) {\r\n  this.history.replace(location, onComplete, onAbort);\r\n};\r\n\r\nVueRouter.prototype.go = function go (n) {\r\n  this.history.go(n);\r\n};\r\n\r\nVueRouter.prototype.back = function back () {\r\n  this.go(-1);\r\n};\r\n\r\nVueRouter.prototype.forward = function forward () {\r\n  this.go(1);\r\n};\r\n\r\nVueRouter.prototype.getMatchedComponents = function getMatchedComponents (to) {\r\n  var route = to\r\n    ? to.matched\r\n      ? to\r\n      : this.resolve(to).route\r\n    : this.currentRoute;\r\n  if (!route) {\r\n    return []\r\n  }\r\n  return [].concat.apply([], route.matched.map(function (m) {\r\n    return Object.keys(m.components).map(function (key) {\r\n      return m.components[key]\r\n    })\r\n  }))\r\n};\r\n\r\nVueRouter.prototype.resolve = function resolve (\r\n  to,\r\n  current,\r\n  append\r\n) {\r\n  var location = normalizeLocation(\r\n    to,\r\n    current || this.history.current,\r\n    append,\r\n    this\r\n  );\r\n  var route = this.match(location, current);\r\n  var fullPath = route.redirectedFrom || route.fullPath;\r\n  var base = this.history.base;\r\n  var href = createHref(base, fullPath, this.mode);\r\n  return {\r\n    location: location,\r\n    route: route,\r\n    href: href,\r\n    // for backwards compat\r\n    normalizedTo: location,\r\n    resolved: route\r\n  }\r\n};\r\n\r\nVueRouter.prototype.addRoutes = function addRoutes (routes) {\r\n  this.matcher.addRoutes(routes);\r\n  if (this.history.current !== START) {\r\n    this.history.transitionTo(this.history.getCurrentLocation());\r\n  }\r\n};\r\n\r\nObject.defineProperties( VueRouter.prototype, prototypeAccessors );\r\n\r\nfunction registerHook (list, fn) {\r\n  list.push(fn);\r\n  return function () {\r\n    var i = list.indexOf(fn);\r\n    if (i > -1) { list.splice(i, 1); }\r\n  }\r\n}\r\n\r\nfunction createHref (base, fullPath, mode) {\r\n  var path = mode === 'hash' ? '#' + fullPath : fullPath;\r\n  return base ? cleanPath(base + '/' + path) : path\r\n}\r\n\r\nVueRouter.install = install;\r\nVueRouter.version = '3.0.1';\r\n\r\nif (inBrowser && window.Vue) {\r\n  window.Vue.use(VueRouter);\r\n}\r\n\r\nreturn VueRouter;\r\n\r\n})));\r\n"]}]}